<!DOCTYPE html>
<html lang="es">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>DAM_BD06_Contenido_CIDEAD</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Ministerio de Educación y FP" />
<meta name="generator" content="eXeLearning 2.5 - exelearning.net" />
<meta name="description" content="DAM_BD06_Contenido_CIDEAD" />
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_lightbox.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_lightbox.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" /></head>
<body class="exe-single-page"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<header id="header">
<div id="headerContent">
<h1>DAM_BD06_Contenido_CIDEAD</h1>
</div>
</header>
<section id="main">
<article class="node level-1-node" id="exe-node-0">
<header class="nodeDecoration">
<h1 id="exenode_0_Programacindebasesdedatos" class="nodeTitle">Programación de bases de datos.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id0-0">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta0_66" class="block iDevice_content">
<p><strong>Juan</strong> recuerda, de cuando estudió el Ciclo de Desarrollo de Aplicaciones Informáticos, que había muchas tareas que se podían automatizar dentro de la base de datos mediante el uso de un lenguaje de programación, e incluso que se podían programar algunas restricciones a la hora de manipular los datos. <strong>Juan</strong> se lo comenta a <strong>María</strong> y ésta se muestra ilusionada con dicha idea ya que muchas veces repiten el trabajo con la base de datos de juegos <span lang="en">on-line</span> que tienen entre manos (consultas, inserciones, <abbr title="Etcétera.">etc</abbr>. que son muy parecidas y que se podrían automatizar).</p>
<figure class="exe-figure exe-image float-left license-custom" style="width: 200px;"><img src="CASO_PERSONAJES_03.jpg" alt="Imagen en primer plano de una chica joven con una camiseta de manga corta azul." title="María." class="elemento_centrado" width="200" height="132" style="width: 200px; height: 132px;" />
<figcaption class="figcaption"><a href="https://www.educacionyfp.gob.es/portada.html" target="_blank" class="author" title="Acceder a la web del Ministerio de Educación y FP (se abre en una ventana nueva)" rel="noopener">Ministerio de Educación</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="CASO_PERSONAJES_04.jpg" alt="Imagen en primer plano de un chico joven con una camisa de rayas azules y blancas." title="Juan." class="elemento_centrado" width="200" height="132" style="width: 200px; height: 132px;" />
<figcaption class="figcaption"><a href="https://www.educacionyfp.gob.es/portada.html" target="_blank" class="author" title="Acceder a la web del Ministerio de Educación y FP (se abre en una ventana nueva)" rel="noopener">Ministerio de Educación</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br />Para ello hablan con <strong>Ada</strong> y ésta les comenta que claro que se puede hacer y que precisamente eso es lo que les toca hacer ahora. <strong>Ada</strong> les   dice que para ese propósito existe un lenguaje de programación llamado <acronym lang="en" title="Procedural Language/Structured Query Language.">PL/SQL</acronym> que permite hacer lo que ellos quieren, así que les pasa un   manual para que se lo vayan leyendo y se vayan poniendo manos a la obra con la base de datos de juegos <span lang="en">on-line</span>.</p>
<div style="clear: both;"></div>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id1-0">
<div class="iDevice emphasis0">
<div id="ta1_73" class="block iDevice_content">
Ahora que ya dominas el uso de <acronym lang="en" title="Structured Query Language.">SQL</acronym> para la manipulación y consulta de datos, es el momento de dar una vuelta de tuerca adicional para mejorar las aplicaciones que utilicen nuestra base de datos. Para ello nos vamos a centrar en la programación de bases de datos, utilizando el lenguaje PL/SQL. En esta unidad conoceremos qué es PL/SQL, cuál es su sintaxis y veremos cómo podemos sacarle el máximo partido a nuestra base de datos mediante su uso.

</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id2-0">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta2_48" class="block iDevice_content">
<p>La mayor parte de los ejemplos de esta unidad están basados en el modelo de datos extraído del siguiente caso de estudio:</p>
<p class="enlace_centrado"><a href="#exenode_35_AnexoICasodeestudio" title="Acceder al anexo donde se especifica el caso de estudio en el que nos basaremos en esta unidad.">Caso de estudio.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id116-0">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta116_70" class="block iDevice_content">
<figure class="exe-figure exe-image position-center license-pd" style="width: 282px;"><img src="ministerio-de-educacion-y-formacion-profesional-web.jpg" alt="Ilustración del logotipo del Ministerio de Educación y Formación Profesional." title="Logotipo del Ministerio de Educación y Formación Profesional." width="282" height="69" hspace="auto" style="display: block; margin-left: auto; margin-right: auto;" />
<figcaption class="figcaption"><a href="https://www.educacionyfp.gob.es/portada.html" target="_blank" class="author" title="Acceder a la Web del Ministerio de Educación y FP (se abre en una ventana nueva)" rel="noopener">Ministerio de Educación y Formación Profesional.</a> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></figcaption>
</figure>
<p style="text-align: center;"><span style="font-size: 13.5pt; color: #000000;"><strong>Materiales formativos de FP Online propiedad del Ministerio de Educación y Formación Profesional.</strong></span><br /><a href="http://www.educacionyfp.gob.es/fpadistancia/comunes/aviso-legal-materiales.html" target="_blank" title="Acceder a la Web sobre el Aviso legal (se abre en una ventana nueva)" rel="noopener">Aviso Legal</a></p>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-1">
<header class="nodeDecoration">
<h1 id="exenode_1_1Introduccin" class="nodeTitle">1.- Introducción.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id6-1">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta6_66" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 180px;"><img src="BD06_CONT_R02_Cafe.jpg" alt="Ilustración de una taza de café llena." title="Taza de café." class="elemento_derecha" width="180" height="160" />
<figcaption class="figcaption"><span class="author"><a href="https://intef.es/" target="_blank" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE</a> (Miguel Martínez Monasterio)</span> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p><strong>Juan</strong> y <strong>María</strong> se han puesto a repasar el manual de PL/SQL que les ha pasado Ada. Aunque no han avanzado mucho con el mismo, ya saben a qué se van a enfrentar y los beneficios que pueden obtener del uso del mismo para su aplicación de juegos <span lang="en">on-line</span>. Cuando hacen la primera parada de la mañana para tomarse un café, ambos se ponen a comentar las primeras conclusiones que han sacado después de su primer acercamiento a este lenguaje. Ambos están deseosos de seguir avanzando en su aprendizaje y saben que para ello cuentan con la inestimable ayuda de <strong>Ada</strong>.</p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id8-1">
<div class="iDevice emphasis0">
<div id="ta8_73" class="block iDevice_content">
Estarás pensado que si no tenemos bastante con aprender SQL, sino que ahora tenemos que aprender otro lenguaje más que lo único que va a hacer es complicarnos la vida. Verás que eso no es cierto ya que lo más importante, que es el conocimiento de SQL, ya lo tienes. PL/SQL tiene una sintaxis muy sencilla y verás como pronto te acostumbras y luego no podrás vivir sin él.

</div>
</div>
</article>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id9-1">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta9_70" class="block iDevice_content">
<p>Pero, <strong>¿qué es realmente PL/SQL?</strong></p>
<p>PL/SQL es un <a href="#t53f21b5f-be1c-916a-471d-910f20dcf32c" id="link53f21b5f-be1c-916a-471d-910f20dcf32c" class="exe-tooltip definition-tt titled-tt blue-tt" title="Lenguaje procedimental | ">lenguaje procedimental</a> estructurado en bloques que amplía la funcionalidad de SQL. Con PL/SQL podemos usar sentencias SQL para manipular datos y sentencias de control de flujo para procesar los datos. Por tanto, PL/SQL combina la potencia de SQL para la manipulación de datos, con la potencia de los lenguajes procedimentales para procesar los datos.</p>
<div id="t53f21b5f-be1c-916a-471d-910f20dcf32c" class="exe-tooltip-text">
<p>Lenguaje que utiliza los procedimientos y funciones para crear programas y así poder utilizar diferentes grados de abstracción y reutilización del código</p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id10-1">
<div class="iDevice emphasis0">
<div id="ta10_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado">
<figure class="exe-figure exe-image float-right license-custom" style="width: 144px;"><a href="BD06_CONT_R03_MotorPLSQL.png" title="Ampliar imagen." rel="lightbox"><img src="BD06_CONT_R03_MotorPLSQL.png" alt="Esquema en el que se muestra cómo se ejecuta un bloque PL/SQL en la base de datos. El bloque se manda al motor de PL/SQL que reside en la base de datos y éste va mandado las diferentes sentencias SQL al motor de SQL." title="Ejecución de PL/SQL.Pulsar para ampliar" class="imagen_ampliable" width="144" height="192" style="width: 144px; height: 192px;" /></a>
<figcaption class="figcaption"><a href="https://www.educacionyfp.gob.es/portada.html" target="_blank" class="author" title="Acceder a la Web del Ministerio de Educación y FP (se abre en una ventana nueva)" rel="noopener">Ministerio de Educación</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
</div>
</div>
<p>Aunque PL/SQL fue creado por <span lang="en">Oracle</span>, hoy día todos los gestores de bases de datos utilizan un lenguaje procedimental muy parecido al ideado por <span lang="en">Oracle</span> para poder programar las bases de datos.</p>
<p>Como veremos, en PL/SQL podemos definir variables, constantes, funciones, procedimientos, capturar errores en tiempo de ejecución, anidar cualquier número de bloques, etc. como solemos hacer en cualquier otro lenguaje de programación. Además, por medio de PL/SQL programaremos los <a href="#tf43a27db-109f-b80b-9827-6b4b7cd3da09" id="linkf43a27db-109f-b80b-9827-6b4b7cd3da09" class="exe-tooltip definition-tt titled-tt blue-tt" title="Disparador | ">disparadores</a> de nuestra base de datos, tarea que no podríamos hacer sólo con SQL.</p>
<p>El motor de PL/SQL acepta como entrada bloques PL/SQL o subprogramas, ejecuta sentencias procedimentales y envía sentencias SQL al servidor de bases de datos. En el esquema adjunto puedes ver su funcionamiento.</p>
<p>Una de las grandes ventajas que nos ofrece PL/SQL es un mejor rendimiento en entornos de red <a href="#tfd0367fa-311e-103e-8ce9-d396b88eadb5" id="linkfd0367fa-311e-103e-8ce9-d396b88eadb5" class="exe-tooltip definition-tt titled-tt blue-tt" title="cliente-servidor | ">cliente-servidor</a>, ya que permite mandar bloques PL/SQL desde el cliente al servidor a través de la red, reduciendo de esta forma el tráfico y así no tener que mandar una a una las sentencias SQL correspondientes.</p>
<div id="tf43a27db-109f-b80b-9827-6b4b7cd3da09" class="exe-tooltip-text">
<p>Un "trigger" (disparador o desencadenador) es un bloque de código que se ejecuta automáticamente cuando ocurre algún evento (como inserción, actualización o borrado) sobre una determinada tabla (o vista); es decir, cuando se intenta modificar los datos de una tabla (o vista) asociada al disparador. Se crean para conservar la integridad referencial y la coherencia entre los datos entre distintas tablas; para registrar los cambios que se efectúan sobre las tablas y la identidad de quien los realizó; para realizar cualquier acción cuando una tabla es modificada; etc.</p>
</div>
<div id="tfd0367fa-311e-103e-8ce9-d396b88eadb5" class="exe-tooltip-text">
<p>La arquitectura cliente-servidor es un modelo de aplicación distribuida en el que las tareas se reparten entre los proveedores de recursos o servicios, llamados servidores, y los demandantes, llamados clientes. Un cliente realiza peticiones a otro programa, el servidor, que le da respuesta.</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id11-1">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta11_47" class="block iDevice_content">
<p>En el siguiente enlace podrás encontrar una breve historia de PL/SQL.</p>
<p class="enlace_centrado"><a href="https://ventanainformatica.activo.mx/t9-historia-plsql" title="Acceder a una web con la historia de  PL/SQL (se abre en una ventana nueva)" target="_blank" rel="noopener">Breve historia de PL/SQL.</a></p>
<p>En estos enlaces podrás comprobar como los gestores de bases de datos incluyen hoy día un lenguaje procedimental para programar la base de datos muy parecido a PL/SQL.</p>
<p class="enlace_centrado"><a href="http://es.wikipedia.org/wiki/Procedimiento_almacenado" title="Acceder a un artículo de la wikipedia sobre el uso de procedimientos almacenados en MySQL." target="_self">Procedimientos almacenados en <span lang="en">MySQL</span>.</a></p>
<p class="enlace_centrado"><a href="http://es.wikipedia.org/wiki/PL/PgSQL" title="Acceder a un artículo de la wikipedia sobre el lenguaje procedimental utilizado en PostgreSQL." target="_self">Lenguaje procedimental en <span lang="en">PostgreSQL</span>.</a></p>
</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-2">
<header class="nodeDecoration">
<h1 id="exenode_2_2Conceptosbsicos" class="nodeTitle">2.- Conceptos básicos.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id12-2">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta12_66" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="BD06_CONT_R04_Vocales.jpg" alt="Pizarra en la que con tiza rosa se pueden leer las vocales." title="Vocales." class="elemento_derecha" width="200" height="132" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener"><span class="author">ITE</span></a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p></p>
<p><br /><strong>Juan</strong> ha avanzado muy rápido en la lectura del manual que le pasó <strong>Ada</strong>. <strong>Juan</strong> ya sabe programar en otros lenguajes de programación y por tanto la lectura de los primeros capítulos que se centran en cómo se estructura el lenguaje, los tipos de datos, las estructuras de control, etc. le han resultado muy fáciles de comprender. Sabe que lo único que tendrá que tener en cuenta son algunos aspectos en cuanto a las reglas de escritura y demás, pero la lógica es la de cualquier otro lenguaje de programación.</p>
<p>Como <strong>María</strong> está un poco más verde en el tema de la programación, <strong>Juan</strong> se ha ofrecido a darle un repaso rápido a todo lo que él ha visto y a explicarle todo aquello en lo que tenga dudas y a ver si pronto se pueden poner manos a la obra con la base de datos de juegos <span lang="en">on-line</span>.</p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id13-2">
<div class="iDevice emphasis0">
<div id="ta13_73" class="block iDevice_content">
<p>En este apartado nos vamos a ir introduciendo poco a poco en los diferentes conceptos que debemos tener claros para programar en PL/SQL. Como para cualquier otro lenguaje de programación, debemos conocer las reglas de sintaxis que podemos utilizar, los diferentes elementos de que consta, los tipos de datos de los que disponemos, las estructuras de control que nos ofrece (tanto iterativas como condicionales) y cómo se realiza el manejo de los errores.</p>
<p>Como podrás comprobar, es todo muy sencillo y pronto estaremos escribiendo fragmentos de código que realizan alguna tarea particular. ¡Vamos a ello!</p>
</div>
</div>
</article>
<article class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id14-2">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<div id="actitity-14_55">
<form name="multi-select-form-14_55" action="#" class="activity-form multi-select-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion14_55" class="block question iDevice_content">
<strong>Indica cuáles de las siguientes características que nos proporciona PL/SQL son ciertas.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op14_550" class="sr-av"><a href="#answer-14_58">Opción 1</a></label><input type="checkbox" id="op14_550" value="True" />
</p>
<div class="iDevice_answer-content" id="answer-14_58"><div id="taans14_58" class="block iDevice_content">
Permite reducir el tráfico en la red en entornos cliente-servidor.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-14_550" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op14_551" class="sr-av"><a href="#answer-14_82">Opción 2</a></label><input type="checkbox" id="op14_551" value="False" />
</p>
<div class="iDevice_answer-content" id="answer-14_82"><div id="taans14_82" class="block iDevice_content">
No podemos utilizar sentencias SQL dentro de un bloque PL/SQL.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-14_551" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op14_552" class="sr-av"><a href="#answer-14_84">Opción 3</a></label><input type="checkbox" id="op14_552" value="True" />
</p>
<div class="iDevice_answer-content" id="answer-14_84"><div id="taans14_84" class="block iDevice_content">
Nos ofrece las ventajas de SQL y la potencia de un lenguaje procedimental.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-14_552" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op14_553" class="sr-av"><a href="#answer-14_86">Opción 4</a></label><input type="checkbox" id="op14_553" value="False" />
</p>
<div class="iDevice_answer-content" id="answer-14_86"><div id="taans14_86" class="block iDevice_content">
Para utilizar PL/SQL debemos instalar diferentes <span lang="en">drivers</span> en nuestra base de datos <span lang="en">Oracle</span>.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-14_553" style="display:none"></section>
</section>
</section>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-4-14_55" /> 
</p>
</div>
<section id="f14_55" class="js-hidden js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>

<div id="tafeedback14_55" class="feedback iDevice_content">
Cuando utilizamos PL/SQL no debemos instalar nada adicional en nuestra base de datos <span lang="en">Oracle</span> y podemos hacer uso de las sentencias SQL dentro de un bloque PL/SQL.

</div>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-14_58" class="right">Correcto</a></li>
<li><a href="#answer-14_82" class="wrong">Incorrecto</a></li>
<li><a href="#answer-14_84" class="right">Correcto</a></li>
<li><a href="#answer-14_86" class="wrong">Incorrecto</a></li>
</ol>
</section>
</div>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-3">
<header class="nodeDecoration">
<h1 id="exenode_3_21UnidadeslxicasI" class="nodeTitle">2.1.- Unidades léxicas (I).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id15-3">
<div class="iDevice emphasis0">
<div id="ta15_73" class="block iDevice_content">
<p>En este apartado nos vamos a centrar en conocer cuáles son las unidades léxicas que podemos utilizar para escribir código en PL/SQL. Al igual que en nuestra lengua podemos distinguir diferentes unidades léxicas como palabras, signos de puntuación, etc. En los lenguajes de programación también existen diferentes unidades léxicas que definen los elementos más pequeños que tienen sentido propio y que al combinarlos de manera adecuada, siguiendo las reglas de sintaxis, dan lugar a sentencias válidas sintácticamente.</p>
<p>PL/SQL es un lenguaje no sensible a las mayúsculas, por lo que será equivalente escribir en mayúsculas o minúsculas, excepto cuando hablemos de literales de tipo cadena o de tipo carácter.</p>
<p>Cada unidad léxica puede estar separada por espacios (debe estar separada por espacios si se trata de 2 identificadores), por saltos de línea o por tabuladores para aumentar la legibilidad del código escrito.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF A=CLAVE THEN ENCONTRADO:=TRUE;ELSE ENCONTRADO:=FALSE;END IF;</code></pre>
</div>
</div>
</div>
<p>Sería equivalente a escribir la siguiente línea:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>if a=clave then encontrado:=true;else encontrado:=false;end if;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Y también sería equivalente a este otro fragmento que es más legible y facilita su comprensión.</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF a = clave THEN
     encontrado := TRUE;
ELSE
     encontrado := FALSE;
END IF;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Las unidades léxicas se pueden clasificar en:</span></p>
</div>
<ul class="lista_verificacion">
<li>Delimitadores.</li>
<li>Identificadores.</li>
<li>Literales.</li>
<li>Comentarios.</li>
</ul>
<p>Vamos a verlas más detenidamente.</p>
<p><strong>Delimitadores.</strong></p>
<p>PL/SQL tiene un conjunto de símbolos denominados delimitadores utilizados para representar operaciones entre tipos de datos, delimitar comentarios, etc. En la siguiente tabla puedes ver un resumen de los mismos.</p>
<table class="tabla" summary="Tabla en la que se muestran los delimitadores simples y compuestos que se pueden utilizar en PL/SQL acompañados por su significado."><caption>Delimitadores en PL/SQL.</caption>
<thead>
<tr>
<th colspan="2" id="delimitadorsimple">Delimitadores Simples.</th>
<th colspan="2" id="delimitadorcompuestos">Delimitadores Compuestos.</th>
</tr>
</thead>
<tbody>
<tr>
<th headers="delimitadorsimple" id="simbolo01">Símbolo.</th>
<th headers="delimitadorsimple" id="significado01">Significado.</th>
<th headers="delimitadorcompuestos" id="simbolo02">Símbolo.</th>
<th headers="delimitadorcompuestos" id="significado02">Significado.</th>
</tr>
<tr>
<td headers="simbolo01">+</td>
<td headers="significado01">Suma.</td>
<td headers="simbolo02">**</td>
<td headers="significado02">Exponenciación.</td>
</tr>
<tr>
<td headers="simbolo01">%</td>
<td headers="significado01">Indicador de atributo.</td>
<td headers="simbolo02">&lt;&gt;</td>
<td headers="significado02">Distinto.</td>
</tr>
<tr>
<td headers="simbolo01">.</td>
<td headers="significado01">Selector.</td>
<td headers="simbolo02">¡=</td>
<td headers="significado02">Distinto.</td>
</tr>
<tr>
<td headers="simbolo01">/</td>
<td headers="significado01">División.</td>
<td headers="simbolo02">&lt;=</td>
<td headers="significado02">Menor o igual.</td>
</tr>
<tr>
<td headers="simbolo01">(</td>
<td headers="significado01">Delimitador de lista.</td>
<td headers="simbolo02">&gt;=</td>
<td headers="significado02">Mayor o igual.</td>
</tr>
<tr>
<td headers="simbolo01">)</td>
<td headers="significado01">Delimitador de lista.</td>
<td headers="simbolo02">..</td>
<td headers="significado02">Rango.</td>
</tr>
<tr>
<td headers="simbolo01">:</td>
<td headers="significado01">Variable <span lang="en">host</span>.</td>
<td headers="simbolo02">||</td>
<td headers="significado02">Concatenación.</td>
</tr>
<tr>
<td headers="simbolo01">,</td>
<td headers="significado01">Separador de elementos.</td>
<td headers="simbolo02">&lt;&lt;</td>
<td headers="significado02">Delimitador de etiquetas.</td>
</tr>
<tr>
<td headers="simbolo01">*</td>
<td headers="significado01">Producto.</td>
<td headers="simbolo02">&gt;&gt;</td>
<td headers="significado02">Delimitador de etiquetas.</td>
</tr>
<tr>
<td headers="simbolo01">"</td>
<td headers="significado01">Delimitador de identificador acotado.</td>
<td headers="simbolo02">--</td>
<td headers="significado02">Comentario de una línea.</td>
</tr>
<tr>
<td headers="simbolo01">=</td>
<td headers="significado01">Igual relacional.</td>
<td headers="simbolo02">/*</td>
<td headers="significado02">Comentario de varias líneas.</td>
</tr>
<tr>
<td headers="simbolo01">&lt;</td>
<td headers="significado01">Menor.</td>
<td headers="simbolo02">*/</td>
<td headers="significado02">Comentario de varias líneas.</td>
</tr>
<tr>
<td headers="simbolo01">&gt;</td>
<td headers="significado01">Mayor.</td>
<td headers="simbolo02">:=</td>
<td headers="significado02">Asignación.</td>
</tr>
<tr>
<td headers="simbolo01">@</td>
<td headers="significado01">Indicador de acceso remoto.</td>
<td headers="simbolo02">=&gt;</td>
<td headers="significado02">Selector de nombre de parámetro.</td>
</tr>
<tr>
<td headers="simbolo01">;</td>
<td headers="significado01">Terminador de sentencias.</td>
<td headers="simbolo02"></td>
<td headers="significado02"></td>
</tr>
<tr>
<td headers="simbolo01">-</td>
<td headers="significado01">Resta/negación.</td>
<td headers="simbolo02"></td>
<td headers="significado02"></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-4">
<header class="nodeDecoration">
<h1 id="exenode_4_211UnidadeslxicasII" class="nodeTitle">2.1.1.- Unidades léxicas (II).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id16-4">
<div class="iDevice emphasis0">
<div id="ta16_73" class="block iDevice_content">
<p>Ya hemos visto qué son los delimitadores. Ahora vamos a continuar viendo el resto de unidades léxicas que nos podemos encontrar en PL/SQL.</p>
<p><strong>Identificadores.</strong></p>
<p>Los identificadores en PL/SQL, como en cualquier otro lenguaje de programación, son utilizados para nombrar elementos de nuestros programas. A la hora de utilizar los identificadores debemos tener en cuenta los siguientes aspectos:</p>
<ul class="lista_verificacion">
<li>Un identificador es una letra seguida opcionalmente de letras, números, $, _, #.</li>
<li>No podemos utilizar como identificador una palabra reservada.
<ul>
<li>Ejemplos válidos: <code>X</code>, <code>A1</code>, <code>codigo_postal</code>.</li>
<li>Ejemplos no válidos: <code>rock&amp;roll</code>, <code>on/off</code>.</li>
</ul>
</li>
<li>PL/SQL nos permite además definir los identificadores acotados, en los que podemos usar cualquier carácter con una longitud máxima de 30 y deben estar delimitados por ". Ejemplo: <code>"X*Y"</code>.</li>
<li>En PL/SQL existen algunos identificadores predefinidos y que tienen un significado especial ya que nos permitirán darle sentido sintáctico a nuestros programas. Estos identificadores son las palabras reservadas y no las podemos utilizar como identificadores en nuestros programas. Ejemplo: <code>IF</code>, <code>THEN</code>, <code>ELSE</code> ...</li>
<li>Algunas palabras reservadas para PL/SQL no lo son para SQL, por lo que podríamos tener una tabla con una columna llamada '<code>type</code>' por ejemplo, que nos daría un error de compilación al referirnos a ella en PL/SQL. La solución sería acotarlos. <code>SELECT "TYPE" …</code></li>
</ul>
<p><strong>Literales.</strong></p>
<p>Los literales se utilizan en las comparaciones de valores o para asignar valores concretos a los identificadores que actúan como variables o constantes. Para expresar estos literales tendremos en cuenta que:</p>
<ul class="lista_verificacion">
<li>Los literales numéricos se expresarán por medio de notación decimal o de notación exponencial. Ejemplos: 234, +341, 2e3, -2E-3, 7.45, 8.1e3.</li>
<li>Los literales tipo carácter y tipo cadena se deben delimitar con unas comillas simples.</li>
<li>Los literales lógicos son <code>TRUE</code> y <code>FALSE</code>.</li>
<li>El literal <code>NULL</code>  expresa que una variable no tiene ningún valor asignado.</li>
</ul>
<p><strong>Comentarios.</strong></p>
<p>En los lenguajes de programación es muy conveniente utilizar comentarios en el código. Los comentarios no tienen ningún efecto sobre el código pero sí ayudan mucho al programador o la programadora a recordar qué se está intentando hacer en cada caso (más aún cuando el código es compartido entre varias personas que se dedican a mejorarlo o corregirlo o cuando el mismo autor ha de retomarlo tras mucho tiempo).</p>
<p>En PL/SQL podemos utilizar dos tipos de comentarios:</p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;">Los comentarios de una línea se expresaran por medio del delimitador <code>--</code>. Ejemplo:
<div style="text-align: center;">
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>a:=b;  --asignación</code></pre>
</div>
</div>
</div>
</li>
<li>Los comentarios de varias líneas se acotarán por medio de los delimitadores /* y */. Ejemplo:
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>/* Primera línea de comentarios.
    Segunda línea de comentarios. */</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
</ul>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id17-4">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta17_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b17" class="block iDevice_content">
<p>Dada la siguiente línea de código, haz su descomposición en las diferentes unidades léxicas que contenga.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF A &lt;&gt; B 
THEN iguales := FALSE; --No son iguales</code></pre>
</div>
</div>
<pre></pre>
</div>
</section>
<form name="feedback-form-quesFeedback0b17" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b17text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b17" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b17" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<p>
La descomposición en unidades léxicas sería la siguiente:
</p>
<ul class="lista_verificacion">
	<li>Identificadores: <code>A</code>, <code>B</code>, <code>iguales</code>.</li>
	<li>Identificadores (palabras reservadas): <code>IF</code>, <code>THEN</code>.</li>
	<li>Delimitadores: <code>&lt;&gt;</code>, <code>:=</code>, <code>;</code>.</li>
	<li>Comentarios: <code>--No son iguales</code>.</li>
</ul>
</section>
</form>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-5">
<header class="nodeDecoration">
<h1 id="exenode_5_22Tiposdedatossimplesvariablesyconstantes" class="nodeTitle">2.2.- Tipos de datos simples, variables y constantes.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id18-5">
<div class="iDevice emphasis0">
<div id="ta18_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="BD06_CONT_R07_NumeroDecimal.jpg" alt="Cero coma uno." title="Número decimal." class="elemento_derecha" width="200" height="132" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener"> ITE</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p>En cualquier lenguaje de programación, las variables y las constantes tienen un tipo de dato asignado (bien sea explícitamente o implícitamente). Dependiendo del tipo de dato el lenguaje de programación sabrá la estructura que utilizará para su almacenamiento, las restricciones en los valores que puede aceptar, la precisión del mismo, etc.</p>
<p>En PL/SQL contamos con todos los <strong>tipos de datos simples</strong> utilizados en SQL y algunos más. En este apartado vamos a enumerar los más utilizados.</p>
<p><strong>Numéricos.</strong></p>
<ul class="lista_verificacion">
<li><code>BINARY_INTEGER</code>: Tipo de dato numérico cuyo rango es de -2147483647 .. 2147483647. PL/SQL además define algunos subtipos de éste: <code>NATURAL</code>, <code>NATURALN</code>, <code>POSITIVE</code>, <code>POSITIVEN</code>, <code>SIGNTYPE</code>.</li>
<li><code>NUMBER</code>: Tipo de dato numérico para almacenar números racionales. Podemos especificar su escala (-84 .. 127) y su precisión (1 .. 38). La escala indica cuándo se redondea y hacia dónde. Ejemplos. escala=2: 8.234 -&gt; 8.23, escala=-3: 7689 -&gt; 8000. Si se define un NUMBER(6,2) estamos indicando que son 6 dígitos numéricos de los cuales 2 son decimales. PL/SQL también define algunos subtipos como: <code>DEC</code>, <code>DECIMAL</code>, <code>DOUBLE</code> <code>PRECISION</code>, <code>FLOAT</code>, <code>INTEGER</code>, <code>INT</code>, <code>NUMERIC</code>, <code>REAL</code>, <code>SMALLINT</code>.</li>
<li><code>PLS_INTEGER</code>: Tipo de datos numérico cuyo rango es el mismo que el del tipo de dato <code>BINARY_INTEGER</code>, pero que su representación es distinta por lo que las operaciones aritméticas llevadas a cabo con los mismos serán más eficientes que en los dos casos anteriores.</li>
</ul>
<p><strong>Alfanuméricos.</strong></p>
<ul class="lista_verificacion">
<li><code>CHAR(n)</code>: <span lang="en">Array</span> de n caracteres, máximo 2000 <span lang="en">bytes</span>. Si no especificamos longitud sería 1. Ocupa en memoria n caracteres.</li>
<li><code>LONG</code>: <span lang="en">Array</span> de caracteres con un máximo de 32760 <span lang="en">bytes</span>.</li>
<li><code>RAW</code>: <span lang="en">Array</span> de <span lang="en">bytes</span> con un número máximo de 2000.</li>
<li><code>LONG RAW</code>: <span lang="en">Array</span> de <span lang="en">bytes</span> con un máximo de 32760.</li>
<li><code>VARCHAR2(n)</code>: Tipo de dato para almacenar cadenas de longitud variable con un máximo de 32760. Ocupa en memoria hasta n caracteres.</li>
</ul>
<p><strong>Grandes objetos.</strong></p>
<ul class="lista_verificacion">
<li><code>BFILE</code>: <a href="#t50bca256-dd7d-8156-bc69-b261110d1b7e" id="link50bca256-dd7d-8156-bc69-b261110d1b7e" class="exe-tooltip definition-tt titled-tt blue-tt" title="Puntero | ">Puntero</a> a un fichero del Sistema Operativo.</li>
<li><code>BLOB</code>: Objeto binario con una capacidad de 4 <abbr title="GigaByte.">GB</abbr>.</li>
<li><code>CLOB</code>: Objeto carácter con una capacidad de 2 GB.</li>
</ul>
<p><strong>Otros.</strong></p>
<ul class="lista_verificacion">
<li><code>BOOLEAN</code>: <code>TRUE</code>/<code>FALSE</code>.</li>
<li><code>DATE</code>: Tipo de dato para almacenar valores día/hora desde el 1 enero de 4712 <acronym title="Antes de Cristo.">a.c.</acronym> hasta el 31 diciembre de 4712 <acronym title="Después de Cristo.">d.c.</acronym></li>
</ul>
<p>Hemos visto los tipos de datos simples más usuales. Los tipos de datos compuestos los dejaremos para posteriores apartados.</p>
<p><strong>Atributo %TYPE.</strong></p>
<p><span face="quot"><span color="#2a3744">Las variables PL/SQL</span></span><span face="quot"><span color="#2a3744"><span> </span>se suelen declar</span></span><span face="quot"><span color="#2a3744">ar para sostener y manipular los datos almacenados en una Base de Datos. Cuando declares variables<span> </span></span></span><span face="quot"><span color="#2a3744">PL/SQL para guardar los valores de columnas, debes asegurarte de que la variable tenga la precisión (tamaño) y el tipo de dato correcto. Si no es así se puede producir un error durante la ejecución.</span></span></p>
<p><span face="quot"><span color="#2a3744">Cuando se utiliza el atributo<span> </span><span color="#0000ff">%TYPE<span> </span></span>para declarar una variable  estamos indicando que tiene el mismo tipo de datos que la variable especificada. Normalmente se relaciona con una columna de la BD indicando el nombre de la tabla de base de datos y el nombre de la columna. Si se hace referencia a una variable declarada anteriormente, se indicará el nombre de la variable previamente declarada a la variable por declarar.</span></span></p>
<p><span face="quot"><span color="#2a3744">Una ventaja del uso de este atributo, es que si cambia la definición de una columna de la BD, no será necesario cambiar la declaración de la variable.</span></span></p>
<p><strong><span face="quot"><span color="#2a3744">Ejemplos:</span></span></strong></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE

                  nombre_oficina oficinas.nombre%type; -- la variable nombre_oficina tomará el mismo tipo de dato que la columna nombre de  la tabla oficinas

                  vx number(5,2); -- Variable numérica de 5 dígitos, dos de los cuales son decimales

                  vy vx%type; -- la variable vy tomará el mismo tipo de dato que tenga la variable vx</code></pre>
</div>
</div>
<p>Hemos visto los tipos de datos simples más usuales. Los tipos de datos compuestos los dejaremos para posteriores apartados.</p>
<p></p>
<div id="t50bca256-dd7d-8156-bc69-b261110d1b7e" class="exe-tooltip-text">
<p>Un puntero o apuntador es una variable que referencia una región de memoria; en otras palabras es una variable cuyo valor es una dirección de memoria.</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id19-5">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta19_47" class="block iDevice_content">
<p>En el siguiente enlace podrás ampliar información sobre los tipos de datos de los que disponemos en PL/SQL.</p>
<p class="enlace_centrado"><a href="https://www.mundoracle.com/pl-sql.html?Pg=sql_plsql_11.htm" title="Acceder a los tipos de datos en un tutorial de PL/SQL  (se abre en una ventana nueva)" target="_blank" rel="noopener">Tipos de datos en PL/SQL.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id20-5">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-20_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion20_60" class="block question iDevice_content">
<strong>En PL/SQL cuando vamos a trabajar con enteros es preferible utilizar el tipo de dato <code>BINARY_INTEGER</code>, en vez de <code>PLS_INTEGER</code>.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i20_63" class="sr-av"><a href="#answer-20_63">Opción 1</a></label><input type="radio" name="option20_60" id="i20_63" class="exe-radio-option exe-radio-option-0-2-20_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-20_63"><div id="taans20_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i20_90" class="sr-av"><a href="#answer-20_90">Opción 2</a></label><input type="radio" name="option20_60" id="i20_90" class="exe-radio-option exe-radio-option-1-2-20_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-20_90"><div id="taans20_90" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b20_60" class="feedback js-hidden">
<div id="taf20_63" class=" iDevice_content">
No es correcto, ya que el tipo de dato <code>PLS_INTEGER</code> hace que nuestros programas sean más eficientes debido a la representación interna del mismo.

</div>
</section>
<section id="sa1b20_60" class="feedback js-hidden">
<div id="taf20_90" class=" iDevice_content">
Efectivamente, nuestros programas serán más eficientes al utilizar este tipo de dato debido a su representación interna.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-20_63">Incorrecto</a><span> (<a href="#sa0b20_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-20_90">Opción correcta</a><span> (<a href="#sa1b20_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-6">
<header class="nodeDecoration">
<h1 id="exenode_6_221Subtipos" class="nodeTitle">2.2.1.- Subtipos.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id21-6">
<div class="iDevice emphasis0">
<div id="ta21_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="BD06_CONT_R08_HoyManana.jpg" alt="Se ven dos palabras escritas “Hoy” y “Mañana”. La primera está tachada en rojo." title="Renombrar." class="elemento_derecha" width="200" height="132" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p>Cuántas veces no has deseado cambiarle el nombre a las cosas por alguno más común para ti. Precisamente, esa es la posibilidad que nos ofrece PL/SQL con la utilización de los subtipos.</p>
<p>PL/SQL nos permite definir subtipos de tipos de datos para darles un nombre diferente y así aumentar la legibilidad de nuestros programas. Los tipos de operaciones aplicables a estos subtipos serán las mismas que los tipos de datos de los que proceden. La sintaxis será:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>SUBTYPE subtipo IS tipo_base;</code></pre>
</div>
</div>
</div>
<p>Donde subtipo será el <code>nombre</code> que le demos a nuestro subtipo y <code>tipo_base</code> será cualquier tipo de dato en PL/SQL.</p>
<p>A la hora de especificar el tipo base, podemos utilizar el modificador <code>%TYPE</code> para indicar el tipo de dato de una variable o de una columna de la base de datos y <code>%ROWTYPE</code> para especificar el tipo de un <a href="#td3261f42-f2d2-b503-7605-728aaec86624" id="linkd3261f42-f2d2-b503-7605-728aaec86624" class="exe-tooltip definition-tt titled-tt blue-tt" title="Cursores | ">cursor</a> o tabla de una base de datos.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>SUBTYPE id_familia IS familias.identificador%TYPE; -- Permite nombrar a la columna identificador de la tabla famiias con el nombre id_familia.
SUBTYPE agente IS agentes%ROWTYPE; -- Permite nombrar a las filas de la tabla agentes con el nombre agente</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Los subtipos no podemos restringirlos, pero podemos usar un truco para conseguir el mismo efecto y es por medio de una variable auxiliar:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>SUBTYPE apodo IS varchar2(20);          --ilegal
aux varchar2(20);
SUBTYPE apodo IS aux%TYPE;               --legal</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Los subtipos son intercambiables con su tipo base. También son intercambiables si tienen el mismo tipo base o si su tipo base pertenece a la misma familia:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     SUBTYPE numero IS NUMBER;
     numero_tres_digitos NUMBER(3);
     mi_numero_de_la_suerte numero;
     SUBTYPE encontrado IS BOOLEAN;
     SUBTYPE resultado IS BOOLEAN;
     lo_he_encontrado encontrado;
     resultado_busqueda resultado;
     SUBTYPE literal IS CHAR;
     SUBTYPE sentencia IS VARCHAR2;
     literal_nulo literal;
     sentencia_vacia sentencia;
BEGIN
     ...
     numero_tres_digitos := mi_numero_de_la_suerte;     --legal
     ...
     lo_he_encontrado := resultado_busqueda;               --legal
     ...
     sentencia_vacia := literal_nulo;                    --legal
     ...
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
<div id="td3261f42-f2d2-b503-7605-728aaec86624" class="exe-tooltip-text">
<p>Los cursores permiten recorrer los registros que devuelve una consulta SQL almacenados en memoria.</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id22-6">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-22_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion22_60" class="block question iDevice_content">
<strong>Indica la afirmación correcta.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i22_63" class="sr-av"><a href="#answer-22_63">Opción 1</a></label><input type="radio" name="option22_60" id="i22_63" class="exe-radio-option exe-radio-option-0-4-22_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-22_63"><div id="taans22_63" class="block iDevice_content">
Los subtipos lo único que hacen es añadir complejidad a nuestros programas.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i22_93" class="sr-av"><a href="#answer-22_93">Opción 2</a></label><input type="radio" name="option22_60" id="i22_93" class="exe-radio-option exe-radio-option-1-4-22_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-22_93"><div id="taans22_93" class="block iDevice_content">
No hay manera de restringir los subtipos con respecto a su tipo base.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i22_96" class="sr-av"><a href="#answer-22_96">Opción 3</a></label><input type="radio" name="option22_60" id="i22_96" class="exe-radio-option exe-radio-option-2-4-22_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-22_96"><div id="taans22_96" class="block iDevice_content">
Podemos definir un subtipo cuyo tipo base sea una tabla de la base de datos.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i22_99" class="sr-av"><a href="#answer-22_99">Opción 4</a></label><input type="radio" name="option22_60" id="i22_99" class="exe-radio-option exe-radio-option-3-4-22_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-22_99"><div id="taans22_99" class="block iDevice_content">
Podemos definir un subtipo de una variable pero no de una columna de la base de datos.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b22_60" class="feedback js-hidden">
<div id="taf22_63" class=" iDevice_content">
Incorrecto. Los subtipos añaden legibilidad y no complejidad.

</div>
</section>
<section id="sa1b22_60" class="feedback js-hidden">
<div id="taf22_93" class=" iDevice_content">
No es cierto. Los subtipos  podemos restringirlos con respecto a su tipo base de forma indirecta.

</div>
</section>
<section id="sa2b22_60" class="feedback js-hidden">
<div id="taf22_96" class=" iDevice_content">
Efectivamente, veo que lo estás entendiendo.

</div>
</section>
<section id="sa3b22_60" class="feedback js-hidden">
<div id="taf22_99" class=" iDevice_content">
No es correcto. Los subtipos pueden ser de una variable y también de una columna de la base de datos.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-22_63">Incorrecto</a><span> (<a href="#sa0b22_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-22_93">Incorrecto</a><span> (<a href="#sa1b22_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-22_96">Opción correcta</a><span> (<a href="#sa2b22_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-22_99">Incorrecto</a><span> (<a href="#sa3b22_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-7">
<header class="nodeDecoration">
<h1 id="exenode_7_222Variablesyconstantes" class="nodeTitle">2.2.2.- Variables y constantes.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id23-7">
<div class="iDevice emphasis0">
<div id="ta23_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="BD06_CONT_R09_Pi.jpg" alt="Pizarra en la que se puede leer “π=3'1416”." title="Constante." class="elemento_derecha" width="200" height="132" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br />Llevamos un buen rato hablando de tipos de datos, variables e incluso de constantes y te estarás preguntando cuál es la forma adecuada de definirlas. En este apartado vamos a ver las diferentes posibilidades a la hora de definirlas y dejaremos para el apartado siguiente ver cuál es el lugar adecuado para hacerlo dentro de un bloque PL/SQL.</p>
<p>Para declarar variables o constantes pondremos el nombre de la variable, seguido del tipo de datos y opcionalmente una asignación con el operador<code> :=</code>. Si es una constante antepondremos la palabra <code>CONSTANT</code> al tipo de dato (lo que querrá decir que no podemos cambiar su valor). Podremos sustituir el operador de asignación en las declaraciones por la palabra reservada <code>DEFAULT</code>. También podremos forzar a que no sea nula utilizando la palabra <code>NOT NULL</code> después del tipo y antes de la asignación. Si restringimos una variable con <code>NOT NULL</code> deberemos asignarle un valor al declararla, de lo contrario PL/SQL lanzará la excepción <code>VALUE_ERROR</code> (no te asustes que más adelante veremos lo que son las excepciones, pero como adelanto te diré que es un error en tiempo de ejecución).</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>id SMALLINT;
hoy DATE := sysdate;
pi CONSTANT REAL:= 3.1415;
id SMALLINT NOT NULL; --ilegal, no está inicializada
id SMALLINT NOT NULL := 9999; --legal
nombre varchar2(30):= ;'Alejandro Magno';
num INTEGER DEFAULT 4; -- también se puede utilizar DEFAULT para inicializar una variable</code></pre>
</div>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<pre></pre>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">El alcance y la visibilidad de las variables en PL/SQL será el típico de los lenguajes estructurados basados en bloques, aunque eso lo veremos más adelante.</span></p>
</div>
<p><strong>Conversión de tipos.</strong></p>
<p>Aunque en PL/SQL existe la <a href="#tbaf4024b-2321-38d1-10fa-99ce5a1ed6d3" id="linkbaf4024b-2321-38d1-10fa-99ce5a1ed6d3" class="exe-tooltip definition-tt titled-tt blue-tt" title="Conversión de tipos | ">conversión</a> implícita de tipos para tipos parecidos, siempre es aconsejable utilizar la conversión explícita de tipos por medio de funciones de conversión (<code>TO_CHAR</code>, <code>TO_DATE</code>, <code>TO_NUMBER</code>, …) y así evitar resultados inesperados.</p>
<p><strong>Precedencia de operadores.</strong></p>
<p>Al igual que en nuestro lenguaje matemático se utiliza una precedencia entre operadores a la hora de realizar las operaciones aritméticas, en PL/SQL también se establece dicha precedencia para evitar confusiones. Si dos operadores tienen la misma precedencia, se evalúa de izquierda a derecha, pero lo aconsejable es utilizar los paréntesis (al igual que hacemos en nuestro lenguaje matemático) para alterar la precedencia de los mismos ya que las operaciones encerradas entre paréntesis tienen mayor precedencia. En la tabla siguiente se muestra la precedencia de los operadores de mayor a menor.</p>
<table class="tabla" summary="Tabla en la que se muestra la precedencia de operadores de mayor a menor y se acompaña de la operación asociada a dicho operador."><caption>Precedencia de operadores.</caption>
<thead>
<tr>
<th scope="col">Operador.</th>
<th scope="col">Operación.</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>**</code>, <code>NOT</code></td>
<td>Exponenciación, negación lógica.</td>
</tr>
<tr>
<td><code>+</code>, <code>-</code></td>
<td>Identidad, negación.</td>
</tr>
<tr>
<td><code>*</code>, <code>/</code></td>
<td>Multiplicación, división.</td>
</tr>
<tr>
<td><code>+</code>, <code>-</code>, <code>||</code></td>
<td>Suma, resta y concatenación.</td>
</tr>
<tr>
<td><code>=</code>, <code>¡=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>IS NULL</code>, <code>LIKE</code>, <code>BETWEEN</code>, <code>IN</code></td>
<td>Comparaciones.</td>
</tr>
<tr>
<td><code>AND</code></td>
<td>Conjunción lógica</td>
</tr>
<tr>
<td><code>OR</code></td>
<td>Disyunción lógica.</td>
</tr>
</tbody>
</table>
<div id="tbaf4024b-2321-38d1-10fa-99ce5a1ed6d3" class="exe-tooltip-text">
<p>En ciencias de la computación la conversión de tipos (type casting en inglés) se refiere a la transformación de un tipo de dato en otro. Esto se hace para tomar las ventajas que pueda ofrecer el tipo a que se va a convertir. Por ejemplo, los valores de un conjunto más limitado, como números enteros, se pueden almacenar en un formato más compacto y más tarde convertidos a un formato diferente que permita las operaciones que anteriormente no eran posibles, tales como la división con decimales.</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper ClozefpdIdevice em_iDevice" id="id24-7">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta24_41" class="block instructions iDevice_content">
<strong>Rellena el hueco con el resultado de las siguientes operaciones.</strong>

</section>
<section class="activity" id="activity-24_42">
<form name="cloze-form-24_42" action="#" class="activity-form cloze-activity-form">
<div id="cloze24_42">
<input type="hidden" name="clozeFlag24_42.strictMarking" id="clozeFlag24_42.strictMarking" value="false"/>

<input type="hidden" name="clozeFlag24_42.checkCaps" id="clozeFlag24_42.checkCaps" value="false"/>

<input type="hidden" name="clozeFlag24_42.instantMarking" id="clozeFlag24_42.instantMarking" value="false"/>

<ul class="lista_verificacion">
	<li>5+3*2**2 es igual a: 
<label for="clozeBlank24_42.0" class="sr-av">Rellenar huecos (1):</label>
<input class="autocomplete-off" type="text" value="" id="clozeBlank24_42.0" style="width:2em" />
<span style="display:none" id="clozeAnswer24_42.0">JXUwMDY5JXUwMDA2
</span>
.</li>
	<li>2**3+6/3 es igual a: 
<label for="clozeBlank24_42.1" class="sr-av">Rellenar huecos (2):</label>
<input class="autocomplete-off" type="text" value="" id="clozeBlank24_42.1" style="width:2em" />
<span style="display:none" id="clozeAnswer24_42.1">JXUwMDY5JXUwMDAx
</span>
.</li>
	<li>2**(3+6/3) es igual a: 
<label for="clozeBlank24_42.2" class="sr-av">Rellenar huecos (3):</label>
<input class="autocomplete-off" type="text" value="" id="clozeBlank24_42.2" style="width:2em" />
<span style="display:none" id="clozeAnswer24_42.2">JXUwMDZiJXUwMDAx
</span>
.</li>
</ul>

<div class="block iDevice_buttons">
<p>
<input class="button" type="submit" name="submit24_42" value="Enviar"  id="submit24_42" />

<input type="button" name="restart24_42" value="Reiniciar" style="display:none" id="restart24_42" onclick="$exe.cloze.restart('24_42')" />

 
<input type="button" name="24_42showAnswersButton" value="Mostrar las respuestas" style="display:none" id="showAnswersButton24_42" onclick="$exe.cloze.fillInputs('24_42')" />

<span class="js-hidden js-warning">Habilitar JavaScript</span>
</p>
</div>
<div id="clozeScore24_42"></div>
</div>
</form>
</section></div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-8">
<header class="nodeDecoration">
<h1 id="exenode_8_23ElbloquePLSQL" class="nodeTitle">2.3.- El bloque PL/SQL.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id26-8">
<div class="iDevice emphasis0">
<div id="ta26_73" class="block iDevice_content">
<p>Ya hemos visto las unidades léxicas que componen PL/SQL, los tipos de datos que podemos utilizar y cómo se definen las variables y las constantes. Ahora vamos a ver la unidad básica en PL/SQL que es el bloque.</p>
<p>Un bloque PL/SQL consta de tres zonas:</p>
<ul class="lista_verificacion">
<li><strong>Declaraciones</strong>: definiciones de variables, constantes, cursores y excepciones.</li>
<li><strong>Proceso</strong>: zona donde se realizará el proceso en sí, conteniendo las sentencias ejecutables.</li>
<li><strong>Excepciones</strong>: zona de manejo de errores en tiempo de ejecución.</li>
</ul>
<p>La sintaxis es la siguiente:</p>
<div>
<div>
<pre></pre>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>[DECLARE
     [Declaración de variables, constantes, cursores y excepciones]]
BEGIN
     [Sentencias ejecutables]
[EXCEPTION
     Manejadores de excepciones]
END;</code></pre>
</div>
</div>
</div>
</div>
<p>Los bloques PL/SQL pueden anidarse a cualquier nivel. Como hemos comentado anteriormente el <a href="#tc1fb0813-3248-4569-5dab-f292d8b2dd93" id="linkc1fb0813-3248-4569-5dab-f292d8b2dd93" class="exe-tooltip definition-tt titled-tt blue-tt" title="Ambito y visibilidad | ">ámbito y la visibilidad</a> de las variables es la normal en un lenguaje procedimental. Por ejemplo, en el siguiente fragmento de código se declara la variable <code>aux</code> en ambos bloques, pero en el bloque anidado <code>aux</code> con valor igual a 10 actúa de variable global y <code>aux</code> con valor igual a 5 actúa como variable local, por lo que en la comparación evaluaría a <code>FALSE</code>, ya que al tener el mismo nombre la visibilidad dominante sería la de la variable local.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     aux number := 10;-- Variable global
BEGIN
     DECLARE
          aux number := 5;    -- Variable local al bloque donde es definida      
     BEGIN
          ...
          IF aux = 10 THEN     --evalúa a FALSE, no entraría
          ...
     END;
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
<div id="tc1fb0813-3248-4569-5dab-f292d8b2dd93" class="exe-tooltip-text">
<p>La "visibilidad" de un identificador determina las partes del programa en las que se puede hacer referencia a él (su "ámbito"). Un identificador está visible (es decir, se puede utilizar) solo en las partes de un programa enmarcado por su "ámbito", que se puede limitar (en orden de restricción creciente) al archivo, función, bloque o prototipo de función en que aparece. El ámbito de un identificador es la parte del programa en que se puede usar el nombre. Esto a veces se denomina "ámbito léxico"</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id27-8">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta27_47" class="block iDevice_content">
<p>En el siguiente enlace podrás ampliar información sobre el ámbito y la visibilidad de las variables en PL/SQL.</p>
<p class="enlace_centrado"><a href="https://plsql-tutorial.com/es/plsql-variables.htm#:~:text=%C3%81mbito%20de%20variables%20PS%20%2F%20SQL,exterior%20puede%20contener%20bloques%20interiores.&amp;text=Local%20las%20variables%20%2D%20Estos%20se,referenciados%20por%20los%20bloques%20externos." title="Acceder al capítulo de un tutorial de PL/SQL donde se habla del ámbito y la visibilidad de las variables.(se abre en una ventana nueva)" target="_blank" rel="noopener">Ámbito y visibilidad en PL/SQL.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id28-8">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-28_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion28_60" class="block question iDevice_content">
<strong>En PL/SQL el bloque es la unidad básica, por lo que éstos no pueden anidarse.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i28_63" class="sr-av"><a href="#answer-28_63">Opción 1</a></label><input type="radio" name="option28_60" id="i28_63" class="exe-radio-option exe-radio-option-0-2-28_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-28_63"><div id="taans28_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i28_104" class="sr-av"><a href="#answer-28_104">Opción 2</a></label><input type="radio" name="option28_60" id="i28_104" class="exe-radio-option exe-radio-option-1-2-28_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-28_104"><div id="taans28_104" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b28_60" class="feedback js-hidden">
<div id="taf28_63" class=" iDevice_content">
No, los bloques se pueden anidar según nos convenga.

</div>
</section>
<section id="sa1b28_60" class="feedback js-hidden">
<div id="taf28_104" class=" iDevice_content">
Efectivamente, veo que lo vas entendiendo.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-28_63">Incorrecto</a><span> (<a href="#sa0b28_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-28_104">Opción correcta</a><span> (<a href="#sa1b28_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-9">
<header class="nodeDecoration">
<h1 id="exenode_9_24EstructurasdecontrolI" class="nodeTitle">2.4.- Estructuras de control (I).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id29-9">
<div class="iDevice emphasis0">
<div id="ta29_73" class="block iDevice_content">
<p>En la vida constantemente tenemos que tomar decisiones que hacen que llevemos a cabo unas acciones u otras dependiendo de unas circunstancias o repetir una serie de acciones un número dado de veces o hasta que se cumpla una condición. En PL/SQL también podemos imitar estas situaciones por medio de las estructuras de control que son sentencias que nos permiten manejar el <a href="#t161e3aac-5b46-7c32-5357-c50c03b8e464" id="link161e3aac-5b46-7c32-5357-c50c03b8e464" class="exe-tooltip definition-tt titled-tt blue-tt" title="Flujo de control | ">flujo de control </a>de nuestro programa, y éstas son dos: condicionales e iterativas.</p>
<h6><strong>Control condicional.</strong></h6>
<p>Las estructuras de control condicional nos permiten llevar a cabo una acción u otra dependiendo de una condición. Prueba los ejemplos para entender bien el funcionamiento. El caracter / que aparece al final se utiliza para ejecutar el bloque desde SQLPlus.</p>
<p><strong><span style="background-color: #ffffff;">SENTENCIA IF.</span></strong>  Sus variantes son: </p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;"><span style="background-color: #ffffff;"><code>Sentencia IF-THEN</code>:</span> Forma más simple de las sentencias de control condicional. Si la evaluación de la condición es <code>TRUE</code>, entonces se ejecuta la secuencia de sentencias encerradas entre el <code>THEN</code> y el final de la sentencia.</li>
</ul>
<p style="padding-left: 30px;">Sintaxis:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF condicion THEN
secuencia_de_sentencias;
END IF;</code></pre>
</div>
</div>
<p style="padding-left: 30px;">Ejemplo:<b style="font-size: x-small; font-family: 'DejaVu Sans Mono';"><span color="#2a3744"></span></b></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>SET SERVEROUTPUT ON
DECLARE a integer:=10; 
B integer:=7; 
BEGIN 
IF a&gt;b
 THEN dbms_output.put_line(a || ' es mayor'); -- Como la función put_line solo imprime un valor utilizamos la concatenación || para que sea un único valor
 END IF; 
END;
/
</code></pre>
</div>
</div>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;"><code><span style="background-color: #ffffff;">Sentencia IF-THEN-ELSE</span></code><span style="background-color: #ffffff;">:</span> Con esta forma de la sentencia ejecutaremos la primera secuencia de sentencias si la condición se evalúa a <code>TRUE</code> y en caso contrario ejecutaremos la segunda secuencia de sentencias.</li>
</ul>
<p style="padding-left: 30px;">Sintaxis:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF condicion 
THEN Secuencia_de_sentencias1;
 ELSE Secuencia_de_sentencias2; 
END IF;
</code></pre>
</div>
</div>
<p style="padding-left: 30px;">Ejemplo:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
a integer:=10;
b integer:=17;
BEGIN
IF a&gt;b THEN
  dbms_output.put_line(a || ' es mayor');
ELSE
  dbms_output.put_line(b || ' es mayor o iguales');
END IF;
END;
/ </code></pre>
</div>
</div>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;"><span style="background-color: #ffffff;"><code>Sentencia IF-THEN-ELSIF</code></span>: Con esta última forma de la sentencia condicional podemos hacer una selección múltiple. Si la evaluación de la condición 1 da <code>TRUE</code>, ejecutamos la secuencia de sentencias 1, sino evaluamos la condición 2. Si esta evalúa a <code>TRUE</code> ejecutamos la secuencia de sentencias 2 y así para todos los <code>ELSIF</code> que haya. El último <code>ELSE</code> es opcional y es por si no se cumple ninguna de las condiciones anteriores.</li>
</ul>
<p style="padding-left: 30px;">Sintaxis:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF condicion1 THEN
     Secuencia_de_sentencias1;
ELSIF condicion2 THEN
     Secuencia_de_sentencias2;
     ...
[ELSE
     Secuencia_de_sentencias;]
END IF;</code></pre>
</div>
</div>
<p style="padding-left: 30px;">Ejemplo:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF (operacion = ‘SUMA’) THEN
     resultado := arg1 + arg2;
ELSIF (operacion = ‘RESTA’) THEN
     resultado := arg1 – arg2;
ELSIF (operacion = ‘PRODUCTO’) THEN
     resultado := arg1 * arg2;
ELSIF (arg2 &lt;&gt; 0) AND (operacion = ‘DIVISION’) THEN
     resultado := arg1 / arg2;
ELSE
     RAISE operacion_no_permitida; -- Lanza un error de ejecución
END IF;
/</code></pre>
</div>
</div>
<div id="t161e3aac-5b46-7c32-5357-c50c03b8e464" class="exe-tooltip-text">
<p>Se llama flujo de control al orden en el que se ejecutan las instrucciones de un programa, siendo las propias instrucciones las que determinan o controlan dicho flujo. En un programa, a menos que el flujo de control se vea modificado por una instrucción de control, las instrucciones siempre se ejecutan secuencialmente, una detrás de otra</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper textIdevice" id="id119-9">
<div class="iDevice emphasis0" >
<div id="ta119_119_2" class="block iDevice_content">
<div class="exe-text"><div class="box generalbox book_content">
<p><strong>SENTENCIA CASE</strong></p>
<div class="no-overflow">
<p align="left">Permite representar n sentencias <code>IF</code> anidadas, y es más fácil de interpretar cuando se compara con varios valores permitendo sustituir a las sentencias <code>IF</code> encadenadas.</p>
<p align="left">Se puede utilizar de dos formas:</p>
<ul>
<li align="left" class="lista_verificacion">Utilizando un selector y un manejador<code> WHEN</code> para cada posible valor de ese selector</li>
</ul>
<p align="left"><span face="quot"><b><span color="#2a3744"></span> </b> </span></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>CASE  selector 
                    WHEN  expression1  THEN 
                    ordenes; 
                    [ WHEN  expression2 THEN 
                    ordenes; 
                    ... 
                    [WHEN  expression  THEN 
                    ordenes;] 
                    [ ELSE 
                    ordenes;] 
                    END CASE ;</code></pre>
</div>
</div>
<ul>
<li align="left" class="lista_verificacion">Utilizando condiciones de búsqueda:</li>
</ul>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>CASE 
WHEN  condición1  THEN 
ordenes; 
[ WHEN  condición2  THEN 
ordenes; 
... 
WHEN  condiciónN  THEN 
ordenes;] 
[ ELSE 
ordenes;] 
END CASE ;</code></pre>
</div>
</div>
<p><span face="quot"><span color="#2a3744"><span face="quot" color="#002000">En cualquiera de las dos formas, antes de terminar la sentencia <code>CASE</code> se puede especificar <code>ELSE</code> por si no se ha cumplido ninguna de las condiciones o el valor del selector no ha coincidido con ninguno de los evaluados. <span>Las </span><span>condiciones</span><span>, </span><span>condicion1</span><span> a </span><span>condicionN</span><span>, son analizadas en el mismo orden en que aparecen listadas y, en el momento en que una de estas condiciones se cumple como verdadera, la sentencia CASE devuelve el resultado correspondiente y deja de analizar el resto de condiciones.</span></span></span></span></p>
<p><span face="quot"><span color="#2a3744"><span face="quot" color="#002000">Ejemplo:</span> </span> </span></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
    nota INTEGER:=8; -- Se podría especificar nota INTEGER:=&amp;nota
BEGIN
    CASE
       WHEN nota in(1,2) THEN
            DBMS_OUTPUT.PUT_LINE('Muy deficiente');
       WHEN nota in (3,4) THEN
            DBMS_OUTPUT.PUT_LINE('Insuficiente');
       WHEN nota = 5 THEN
            DBMS_OUTPUT.PUT_LINE('Suficiente');
       WHEN nota=6 THEN
            DBMS_OUTPUT.PUT_LINE('Bien');
        WHEN nota in(7,8) THEN
            DBMS_OUTPUT.PUT_LINE('Notable');
        WHEN nota in (9,10) THEN
            DBMS_OUTPUT.PUT_LINE('Sobresaliente');
      ELSE
            DBMS_OUTPUT.PUT_LINE('Error, no es una nota');
    END CASE;
END;
/</code></pre>
</div>
</div>
<p><span>Para pedir datos por teclado en PL/SQL se utilizarán variables de sustitución escribiendo el caracter especial '&amp;' y a continuación un identificador.  Si el dato que se va a recibir es una cadena formada por caracteres alfanuméricos, se deben incluir las comillas al definir la expresión. </span></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
cadena varchar2(25) :='&amp;cad';
BEGIN
    DBMS_OUTPUT.PUT_LINE(cadena);
END;<br />/</code></pre>
</div>
</div>
<p></p>
<p></p>
</div>
</div></div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id30-9">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-30_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion30_60" class="block question iDevice_content">
<strong>En PL/SQL no existen sentencias que nos permitan tomar una acción u otra dependiendo de una condición.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i30_63" class="sr-av"><a href="#answer-30_63">Opción 1</a></label><input type="radio" name="option30_60" id="i30_63" class="exe-radio-option exe-radio-option-0-2-30_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-30_63"><div id="taans30_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i30_107" class="sr-av"><a href="#answer-30_107">Opción 2</a></label><input type="radio" name="option30_60" id="i30_107" class="exe-radio-option exe-radio-option-1-2-30_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-30_107"><div id="taans30_107" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b30_60" class="feedback js-hidden">
<div id="taf30_63" class=" iDevice_content">
Incorrecto, deberías volver a leerte este apartado ya que es de lo que trata.

</div>
</section>
<section id="sa1b30_60" class="feedback js-hidden">
<div id="taf30_107" class=" iDevice_content">
Efectivamente, para eso existen las sentencias de control condicional.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-30_63">Incorrecto</a><span> (<a href="#sa0b30_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-30_107">Opción correcta</a><span> (<a href="#sa1b30_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper textIdevice" id="id118-9">
<div class="iDevice emphasis0" >
<div id="ta118_118_2" class="block iDevice_content">

</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-10">
<header class="nodeDecoration">
<h1 id="exenode_10_241EstructurasdecontrolIIBucles" class="nodeTitle">2.4.1.- Estructuras de control (II). Bucles</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id31-10">
<div class="iDevice emphasis0">
<div id="ta31_73" class="block iDevice_content">
<p>Ya que hemos visto las estructuras de control condicional, veamos ahora las estructuras de <strong>control iterativo</strong>.</p>
<h6><strong>Control iterativo.</strong></h6>
<p>Estas estructuras nos permiten ejecutar una secuencia de sentencias un determinado número de veces.</p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;"><code>LOOP</code>: La forma más simple es el <a href="#t6177b746-a72d-2152-852a-e20c66704acd" id="link6177b746-a72d-2152-852a-e20c66704acd" class="exe-tooltip definition-tt titled-tt blue-tt" title="Bucle infinito | ">bucle infinito</a>, cuya sintaxis es:
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>LOOP
     secuencia_de_sentencias;
END LOOP;</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;"><code>EXIT</code>: Con esta sentencia forzamos a un bucle a terminar y pasa el control a la siguiente sentencia después del bucle. Un <code>EXIT</code> no fuerza la salida de un bloque PL/SQL, sólo la salida del bucle.
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>LOOP
     ...
     IF encontrado = TRUE THEN
          EXIT;
     END IF;
END LOOP;</code></pre>
</div>
</div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
  a integer :=1;
BEGIN
  LOOP
    dbms_output.put_line(a);
    IF a&gt;9 THEN
       EXIT;
    END IF;
    a:=a+1;
  END LOOP;
END;
/     </code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
<li style="margin-bottom: 20px;"><code>EXIT WHEN condicion</code>: Fuerza a salir del bucle cuando se cumple una determinada condición.
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>LOOP
     ...
     EXIT WHEN encontrado;
END LOOP;</code></pre>
</div>
</div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
  a integer :=1;
BEGIN
  LOOP
    dbms_output.put_line(a);
    EXIT WHEN a&gt;9;
    a:=a+1;
  END LOOP;
END;
/      
</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;"><code>WHILE LOOP</code>: Este tipo de bucle ejecuta la secuencia de sentencias mientras la condición sea cierta.</li>
</ul>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>WHILE condicion LOOP
     Secuencia_de_sentencias;
END LOOP;</code></pre>
</div>
</div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
  a integer :=1;
BEGIN
  WHILE a&lt;10 LOOP 
    dbms_output.put_line(a);  
    a:=a+1;
  END LOOP;
END;<br />/</code></pre>
</div>
</div>
<p></p>
<ul class="lista_verificacion">
<li><code>FOR LOOP</code>: Este bucle itera mientras el contador se encuentre en el rango definido.</li>
</ul>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>FOR contador IN [REVERSE] limite_inferior..limite_superior LOOP
     Secuencia_de_sentencias;
END LOOP;</code></pre>
</div>
</div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
  a NUMBER;
BEGIN
FOR a IN 1..10 LOOP -- ascendente de uno en uno
  dbms_output.put_line(a);
END LOOP;
FOR a IN REVERSE 1..10 LOOP -- descendente de uno en uno
  dbms_output.put_line(a);
END LOOP;
END;
/</code></pre>
</div>
</div>
<p></p>
<div id="t6177b746-a72d-2152-852a-e20c66704acd" class="exe-tooltip-text">
<p>Bucle infinito es aquel ciclo que se repite de forma indefinida, ya que su condición para finalizar nunca se cumple o no tiene dicha condición</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id32-10">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-32_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion32_60" class="block question iDevice_content">
<strong>Al utilizar <code>REVERSE</code> en un bucle <code>FOR</code>, en el rango debemos poner el número mayor el primero y el menor el último.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i32_63" class="sr-av"><a href="#answer-32_63">Opción 1</a></label><input type="radio" name="option32_60" id="i32_63" class="exe-radio-option exe-radio-option-0-2-32_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-32_63"><div id="taans32_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i32_111" class="sr-av"><a href="#answer-32_111">Opción 2</a></label><input type="radio" name="option32_60" id="i32_111" class="exe-radio-option exe-radio-option-1-2-32_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-32_111"><div id="taans32_111" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b32_60" class="feedback js-hidden">
<div id="taf32_63" class=" iDevice_content">
No, el rango lo especificamos de misma forma, el menor el primero y el mayor el último, aunque luego se itere del mayor al menor.

</div>
</section>
<section id="sa1b32_60" class="feedback js-hidden">
<div id="taf32_111" class=" iDevice_content">
Efectivamente, vas por buen camino.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-32_63">Incorrecto</a><span> (<a href="#sa0b32_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-32_111">Opción correcta</a><span> (<a href="#sa1b32_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-11">
<header class="nodeDecoration">
<h1 id="exenode_11_25ManejodeerroresI" class="nodeTitle">2.5.- Manejo de errores (I).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id33-11">
<div class="iDevice emphasis0">
<div id="ta33_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 156px;"><img src="BD06_CONT_R13_Sorpresa.jpg" alt="Dibujo de una cara de un chico sorprendido." title="Sorpresa." class="elemento_derecha" width="156" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE (Félix Vallés Calvo)</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p>Muchas veces te habrá pasado que surgen situaciones inesperadas con las que no contabas y a las que tienes que hacer frente. Pues cuando programamos con PL/SQL pasa lo mismo, que a veces tenemos que manejar errores debidos a situaciones diversas. Vamos a ver cómo tratarlos.</p>
<p>Cualquier situación de error es llamada <strong>excepción</strong> en PL/SQL. Cuando se detecta un error, una excepción es lanzada, es decir, la ejecución normal se para y el control se transfiere a la parte de manejo de excepciones. La parte de manejo de excepciones es la parte etiquetada como <code>EXCEPTION</code> y constará de sentencias para el manejo de dichas excepciones, llamadas <strong>manejadores de excepciones</strong>.</p>
<p><span style="font-size: 14pt;"><strong>Manejadores de excepciones</strong></span></p>
<p><span style="font-size: 12pt;">Sintaxis:</span></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>WHEN nombre_excepcion THEN
     &lt;sentencias para su manejo&gt;
     ....
WHEN OTHERS THEN
     &lt;sentencias para su manejo&gt;</code></pre>
</div>
</div>
<p>Ejemplo:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     supervisor agentes%ROWTYPE;
BEGIN
     SELECT * INTO supervisor FROM agentes
     WHERE categoria = 2 AND oficina = 3;
          ...
EXCEPTION
     WHEN NO_DATA_FOUND THEN
     --Manejamos el no haber encontrado datos
WHEN OTHERS THEN
     --Manejamos cualquier error inesperado
END;
/
</code></pre>
</div>
</div>
<p>La parte <code>OTHERS</code> captura cualquier excepción no considerada.</p>
<p>Las excepciones pueden estar definidas por el usuario o definidas internamente. Las excepciones predefinidas se lanzarán automáticamente asociadas a un error de <span lang="en">Oracle</span>. Las excepciones definidas por el usuario deberán definirse y lanzarse explícitamente.</p>
<p>En PL/SQL nosotros podemos definir nuestras propias excepciones en la parte <code>DECLARE</code> de cualquier bloque. Estas excepciones podemos lanzarlas explícitamente por medio de la sentencia <code>RAISE nombre_excepción</code>.</p>
<p><span style="font-size: 14pt;"><strong>Excepciones definidas por el usuario</strong></span></p>
<p><span style="font-size: 12pt;">Sintaxis:</span></p>
<pre><code></code></pre>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     nombre_excepcion EXCEPTION;
BEGIN
     ...
     RAISE nombre_excepcion;
     ...
END;</code></pre>
</div>
</div>
<p>Ejemplo:</p>
<pre><code></code></pre>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     categoria_erronea EXCEPTION;
BEGIN
     ...
     IF categoria&lt;0 OR categoria&gt;3 THEN
          RAISE categoria_erronea;
     END IF;
     ...
EXCEPTION
     WHEN categoria_erronea THEN
          --manejamos la categoria errónea
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id34-11">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta34_48" class="block iDevice_content">
<p>En el siguiente enlace podrás ver las diferentes excepciones predefinidas en Oracle, junto a su código de error asociado (que luego veremos lo que es) y una explicación de cuándo son lanzadas.</p>
<p class="enlace_centrado"><a href="#exenode_36_AnexoIIExcepcionespredefinidasenOracle" title="Acceder al anexo donde se detallan las excepciones predefinidas en Oracle, su código de error y una explicación de cuándo es lanzada cada una (se abre en una ventana nueva)." target="_blank" rel="noopener">Excepciones predefinidas en <span lang="en">Oracle</span>.</a></p>
</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-12">
<header class="nodeDecoration">
<h1 id="exenode_12_251ManejodeerroresII" class="nodeTitle">2.5.1.- Manejo de errores (II).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id36-12">
<div class="iDevice emphasis0">
<div id="ta36_73" class="block iDevice_content">
<p>Ahora que ya sabemos lo que son las excepciones, cómo capturarlas y manejarlas y cómo definir y lanzar las nuestras propias. Es la hora de comentar algunos detalles sobre el uso de las mismas.</p>
<ul class="lista_verificacion">
<li>El alcance de una excepción sigue las mismas reglas que el de una variable, por lo que si nosotros redefinimos una excepción que ya es global para el bloque, la definición local prevalecerá y no podremos capturar esa excepción a menos que el bloque en la que estaba definida esa excepción fuese un bloque nombrado, y podremos capturarla usando la sintaxis: <code>nombre_bloque.nombre_excepcion</code>.</li>
<li style="margin-bottom: 20px;">Las excepciones predefinidas están definidas globalmente. No necesitamos (ni debemos) redefinir las excepciones predefinidas.
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     no_data_found EXCEPTION;
BEGIN
     SELECT * INTO ...
EXCEPTION
     WHEN no_data_found THEN     --captura la excepción local, no 
                         --la global
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Cuando manejamos una excepción no podemos continuar por la siguiente sentencia a la que la lanzó.
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     ...
BEGIN
     ...
     INSERT INTO familias VALUES 
(id_fam, nom_fam, NULL, oficina);
     INSERT INTO agentes VALUES 
(id_ag, nom_ag, login, password, 0, 0, id_fam, NULL);
     ...
EXCEPTION
     WHEN DUP_VAL_ON_INDEX THEN
          --manejamos la excepción debida a que el nombre de
          --la familia ya existe, pero no podemos continuar por 
          --el INSERT INTO agentes, a no ser que lo pongamos 
          --explícitamente en el manejador
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
<li>Pero sí podemos encerrar la sentencia dentro de un bloque, y ahí capturar las posibles excepciones, para continuar con las siguientes sentencias.
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     id_fam NUMBER;
     nom_fam VARCHAR2(40);
     oficina NUMBER;
     id_ag NUMBER;
     nom_ag VARCHAR2(60);
     usuario VARCHAR2(20);
     clave VARCHAR2(20);
BEGIN
     ...
     BEGIN
          INSERT INTO familias VALUES (id_fam, nom_fam, NULL, oficina);
     EXCEPTION
          WHEN DUP_VAL_ON_INDEX THEN
SELECT identificador INTO id_fam FROM familias WHERE nombre = nom_fam;
     END;
     INSERT INTO agentes VALUES (id_ag, nom_ag, login, password, 1, 1, id_fam, null);
     ...
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
</ul>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id37-12">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta37_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b37" class="block iDevice_content">
Supongamos que queremos reintentar una transacción hasta que no nos dé ningún error. Para ello deberemos encapsular la transacción en un bloque y capturar en éste las posibles excepciones. El bloque lo metemos en un bucle y así se reintentará la transacción hasta que sea posible llevarla a cabo.

</section>
<form name="feedback-form-quesFeedback0b37" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b37text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b37" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b37" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     id_fam NUMBER;
     nombre VARCHAR2(40);
     oficina NUMBER;
BEGIN
     ...
     LOOP
          BEGIN
               SAVEPOINT inicio;
               INSERT INTO familias VALUES 
(id_fam, nombre, NULL, oficina);
               ...
               COMMIT;
               EXIT;
          EXCEPTION
               WHEN DUP_VAL_ON_INDEX THEN
                    ROLLBACK TO inicio;
                    id_fam := id_fam + 1;
          END;
     END LOOP;
     ...
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre></section>
</form>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-13">
<header class="nodeDecoration">
<h1 id="exenode_13_252ManejodeerroresIII" class="nodeTitle">2.5.2.- Manejo de errores (III).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id38-13">
<div class="iDevice emphasis0">
<div id="ta38_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 132px;"><img src="BD06_CONT_R16_Ojo.jpg" alt="Escultura en la que se ve un ojo pinchado en un tenedor." title="Ojo." class="elemento_derecha" width="132" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Acceder a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE (Elena Hervás)</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p>Continuemos viendo algunos detalles a tener en cuenta, relativos al uso de las excepciones.</p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;">Cuando ejecutamos varias sentencias seguidas del mismo tipo y queremos capturar alguna posible excepción debida al tipo de sentencia, podemos encapsular cada sentencia en un bloque y manejar en cada bloque la excepción, o podemos utilizar una variable localizadora para saber qué sentencia ha sido la que ha lanzado la excepción (aunque de esta manera no podremos continuar por la siguiente sentencia).
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     sentencia NUMBER := 0;
BEGIN
     ...
     SELECT * FROM agentes ...
     sentencia := 1;
     SELECT * FROM familias ...
     sentencia := 2;
     SELECT * FROM oficinas ...
     ...
EXCEPTION
     WHEN NO_DATA_FOUND THEN
          IF sentencia = 0 THEN
               RAISE agente_no_encontrado;
          ELSIF sentencia = 1 THEN
               RAISE familia_no_encontrada;
          ELSIF sentencia = 2 THEN
               RAISE oficina_no_encontrada;
          END IF;
END;<br />/</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li>Si la excepción es capturada por un manejador de excepción apropiado, ésta es tratada y posteriormente el control es devuelto al bloque superior. Si la excepción no es capturada y no existe bloque superior, el control se devolverá al entorno. También puede darse que la excepción sea manejada en un bloque superior a falta de manejadores para ella en los bloques internos, la excepción se propaga de un bloque al superior y así hasta que sea manejada o no queden bloques superiores con lo que el control se devuelve al entorno. Una excepción también puede ser relanzada en un manejador. En la siguiente presentación puedes ver cómo se propagan diferentes excepciones entre diferentes bloques.</li>
</ul>
<div class="elemento_centrado">
<div class="elemento_centrado"><a href="BD06_CONT_R17_PropagacionExcepciones.odp" title="Propagación de excepciones en PL/SQL. [odp - 17,90 KB]">Propagación de excepciones en PL/SQL.</a><span class="exe-link-data file-size"> (odp - 17,90 <abbr title="KiloBytes" lang="en">KB</abbr>)</span></div>
<div class="credenciales elemento_centrado"><a href="BD06_Descripcion_Presentacion_Propagacion_excepciones_plsql.html" title="Resumen textual alternativo para &quot;propagación de excepciones en PL/SQL&quot;.">Resumen textual alternativo</a></div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id39-13">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-39_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion39_60" class="block question iDevice_content">
<strong>Todas las excepciones están predefinidas y nosotros no podemos definir nuevas excepciones.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i39_63" class="sr-av"><a href="#answer-39_63">Opción 1</a></label><input type="radio" name="option39_60" id="i39_63" class="exe-radio-option exe-radio-option-0-2-39_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-39_63"><div id="taans39_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i39_119" class="sr-av"><a href="#answer-39_119">Opción 2</a></label><input type="radio" name="option39_60" id="i39_119" class="exe-radio-option exe-radio-option-1-2-39_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-39_119"><div id="taans39_119" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b39_60" class="feedback js-hidden">
<div id="taf39_63" class=" iDevice_content">
No, también podemos definir nuestras propias excepciones.

</div>
</section>
<section id="sa1b39_60" class="feedback js-hidden">
<div id="taf39_119" class=" iDevice_content">
Efectivamente, esta afirmación es falsa.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-39_63">Incorrecto</a><span> (<a href="#sa0b39_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-39_119">Opción correcta</a><span> (<a href="#sa1b39_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-39_122" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion39_122" class="block question iDevice_content">
<strong>Las excepciones definidas por el usuario deben ser lanzadas explícitamente.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i39_125" class="sr-av"><a href="#answer-39_125">Opción 1</a></label><input type="radio" name="option39_122" id="i39_125" class="exe-radio-option exe-radio-option-0-2-39_122-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-39_125"><div id="taans39_125" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i39_128" class="sr-av"><a href="#answer-39_128">Opción 2</a></label><input type="radio" name="option39_122" id="i39_128" class="exe-radio-option exe-radio-option-1-2-39_122-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-39_128"><div id="taans39_128" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b39_122" class="feedback js-hidden">
<div id="taf39_125" class=" iDevice_content">
Efectivamente, las lanzamos explícitamente usando la sentencia <code>RAISE</code>.

</div>
</section>
<section id="sa1b39_122" class="feedback js-hidden">
<div id="taf39_128" class=" iDevice_content">
No, deberías repasar los contenidos.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-39_125">Opción correcta</a><span> (<a href="#sa0b39_122">Retroalimentación</a>)</span></li>
<li><a href="#answer-39_128">Incorrecto</a><span> (<a href="#sa1b39_122">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-39_131" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion39_131" class="block question iDevice_content">
<strong>Es obligatorio declarar todas las excepciones predefinidas que vamos a usar en nuestros bloques.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i39_134" class="sr-av"><a href="#answer-39_134">Opción 1</a></label><input type="radio" name="option39_131" id="i39_134" class="exe-radio-option exe-radio-option-0-2-39_131-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-39_134"><div id="taans39_134" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i39_137" class="sr-av"><a href="#answer-39_137">Opción 2</a></label><input type="radio" name="option39_131" id="i39_137" class="exe-radio-option exe-radio-option-1-2-39_131-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-39_137"><div id="taans39_137" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b39_131" class="feedback js-hidden">
<div id="taf39_134" class=" iDevice_content">
No y además no es aconsejable hacerlo.

</div>
</section>
<section id="sa1b39_131" class="feedback js-hidden">
<div id="taf39_137" class=" iDevice_content">
Efectivamente, ni es obligatorio ni debemos hacerlo.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-39_134">Incorrecto</a><span> (<a href="#sa0b39_131">Retroalimentación</a>)</span></li>
<li><a href="#answer-39_137">Opción correcta</a><span> (<a href="#sa1b39_131">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-14">
<header class="nodeDecoration">
<h1 id="exenode_14_253ManejodeerroresIV" class="nodeTitle">2.5.3.- Manejo de errores (IV).</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id40-14">
<div class="iDevice emphasis0">
<div id="ta40_73" class="block iDevice_content">
<p><span lang="en">Oracle</span> también permite que nosotros lancemos nuestros propios mensajes de error a las aplicaciones y asociarlos a un código de error que <span lang="en">Oracle</span> reserva, para no interferir con los demás códigos de error. Lo hacemos por medio del procedimiento:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>RAISE_APPLICATION_ERROR(error_number, message [, (TRUE|FALSE)]);</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Donde </span><code>error_number</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> es un entero negativo comprendido entre –20000..-20999 y </span><code>message</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> es una cadena que devolvemos a la aplicación. El tercer parámetro especifica si el error se coloca en la pila de errores (</span><code>TRUE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">) o se vacía la pila y se coloca únicamente el nuestro (</span><code>FALSE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">). Sólo podemos llamar a este procedimiento desde un subprograma.</span></p>
</div>
<p>No hay excepciones predefinidas asociadas a todos los posibles errores de <span lang="en">Oracle</span>, por lo que nosotros podremos asociar excepciones definidas por nosotros a errores <span lang="en">Oracle</span>, por medio de la directiva al compilador (o pseudoinstrucción):</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>PRAGMA_INIT( nombre_excepcion, error_Oracle )</code></pre>
</div>
</div>
<pre></pre>
</div>
<p>Donde <code>nombre_excepcion</code> es el nombre de una excepción definida anteriormente, y <code>error_Oracle</code> es el número negativo asociado al error.</p>
<div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     no_null EXCEPTION;
     PRAGMA EXCEPTION_INIT(no_null, -1400);
     id familias.identificador%TYPE;
     nombre familias.nombre%TYPE;
BEGIN
     ...
     nombre := NULL;
     ...          
     INSERT INTO familias VALUES (id, nombre, null, null);
EXCEPTION
     WHEN no_null THEN
          ...
END;
</code></pre>
</div>
</div>
<p><span lang="en" style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Oracle</span><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> asocia 2 funciones para comprobar la ejecución de cualquier sentencia. </span><code>SQLCODE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> nos devuelve el código de error y </span><code>SQLERRM</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> devuelve el mensaje de error asociado. Si una sentencia es ejecutada correctamente, </span><code>SQLCODE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> nos devuelve 0 y en caso contrario devolverá un número negativo asociado al error (excepto </span><code>NO_DATA_FOUND</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> que tiene asociado el +100).</span></p>
</div>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
cod number;
msg varchar2(100);
BEGIN
...
EXCEPTION
WHEN OTHERS THEN
     cod := SQLCODE;
     msg := SUBSTR(SQLERRM, 1, 1000);
     INSERT INTO errores VALUES (cod, msg);
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id42-14">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<div id="actitity-42_55">
<form name="multi-select-form-42_55" action="#" class="activity-form multi-select-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion42_55" class="block question iDevice_content">
<strong>De las siguientes afirmaciones marca las que creas que son correctas.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op42_550" class="sr-av"><a href="#answer-42_58">Opción 1</a></label><input type="checkbox" id="op42_550" value="True" />
</p>
<div class="iDevice_answer-content" id="answer-42_58"><div id="taans42_58" class="block iDevice_content">
Podemos lanzar nuestros propios mensajes de error a las aplicaciones.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-42_550" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op42_551" class="sr-av"><a href="#answer-42_140">Opción 2</a></label><input type="checkbox" id="op42_551" value="False" />
</p>
<div class="iDevice_answer-content" id="answer-42_140"><div id="taans42_140" class="block iDevice_content">
Podemos acceder al código de error generado por la ejecución de una sentencia pero no a su mensaje asociado.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-42_551" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op42_552" class="sr-av"><a href="#answer-42_142">Opción 3</a></label><input type="checkbox" id="op42_552" value="True" />
</p>
<div class="iDevice_answer-content" id="answer-42_142"><div id="taans42_142" class="block iDevice_content">
Podemos asociar excepciones definidas por nosotros a códigos de error de <span lang="en">Oracle</span>.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-42_552" style="display:none"></section>
</section>
</section>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-3-42_55" /> 
</p>
</div>
<section id="f42_55" class="js-hidden js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>

<div id="tafeedback42_55" class="feedback iDevice_content">
Podemos lanzar nuestros propios mensajes de error a las aplicaciones, acceder al código de error y al mensaje asociado al mismo generado por la ejecución de una sentencia y asociar excepciones definidas por nosotros a códigos de error de <span lang="en">Oracle</span>.

</div>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-42_58" class="right">Correcto</a></li>
<li><a href="#answer-42_140" class="wrong">Incorrecto</a></li>
<li><a href="#answer-42_142" class="right">Correcto</a></li>
</ol>
</section>
</div>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-45">
<header class="nodeDecoration">
<h1 id="exenode_45_26SentenciasSQLenprogramasPLSQL" class="nodeTitle">2.6.- Sentencias SQL en programas PL/SQL</h1>
</header>
<article class="iDevice_wrapper textIdevice" id="id120-45">
<div class="iDevice emphasis0" >
<div id="ta120_120_2" class="block iDevice_content">
<div class="exe-text"><p align="justify">En un bloque PL/SQL, se utilizan sentencias SQL para recuperar y modificar los datos de tablas de una BD. </p>
<p align="justify">Hasta ahora hemos trabajado con SQL de forma interactiva, escribíamos la sentencia y obteníamos los resultados en pantalla. Para trabajar con SQL dentro de un programa trabajaremos con SQL embebido o incrustado. Los datos devueltos de la consulta los guardaremos en variables y estructuras definidas en el lenguaje anfitrión, en nuestro caso PLSQL,  para utilizarlas como convenga. Para ello añadiremos alguna cláusula a la sentencia <code>SELECT</code>.</p>
<p align="justify">PL/SQL soporta el<span> </span>Lenguaje de Manipulación de Datos (DML) y los comandos de control de transacciones. Se pueden utilizar los comandos DML para modificar los datos de una tabla de Base de Datos. </p>
<p align="justify">PL/SQL no soporta directamente el Lenguaje de Definición de Datos (DDL) como<span> </span><code><span color="#0000ff">CREATE TABLE</span>, <span color="#0000ff">ALTER TABLE</span>, <span color="#0000ff">DROP TABLE</span></code>, etc... Lo cual no puede suceder si las aplicaciones tienen que crear objetos de Base de Datos en tiempo de ejecución mediante el paso de valores. Las sentencias DDL no pueden ser ejecutadas directamente. Estas instrucciones son sentencias dinámicas de<span> </span>SQL. Las sentencias dinámicas de<span> </span>SQLse construyen como cadenas de caracteres en tiempo de ejecución y pueden contener marcadores de posición para parámetros. Por lo tanto, puede utilizar SQL dinámico para ejecutar sus sentencias DDL en<span> </span>PL/SQL.</p>
<p align="justify">PL/SQL no soporta directamente las sentencias de<span> </span>Lenguaje de Control de Datos (DCL), tales como<span> </span><code><span color="#0000ff">GRANT </span></code>o<span> </span><code><span color="#0000ff">REVOKE</span></code>. Puede utilizar SQL dinámico para ejecutarlas.</p>
<p align="justify">Si queremos recuperar datos de la BD utilizaremos la  instrucción<span> </span><span color="#0000ff"><code>SELECT</code> utilizaremos este formato. </span></p>
<p align="justify"><b>Sintaxis</b>:</p>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>SELECT  lista_campos INTO {nombre_variable[, nombre_variable]...| nombre_registro}  
FROM tabla
[WHERE condición];</code></pre>
</div>
</div>
<p align="justify">donde</p>
<p align="justify">- la lista_campos, contendrá al menos una columna y puede incluir expresiones SQL,  funciones de fila, o funciones de grupo.</p>
<p align="justify">- la cláusula <code><span color="#0000ff">INTO </span></code>es obligatoria y se especifica entre <code> <span color="#0000ff">SELECT </span></code>y cláusula <code><span color="#0000ff">FROM</span></code>.</p>
<p align="justify">- nombre_variable, variable donde se guardará  el valor recuperado. Deben especificarse tantas variables como campos se indiquen en la lista de campos, debe haber correspondencia en posición y en tipo de datos.</p>
<p align="justify">- nombre_registro, un dato compuesto de PL/SQL donde se guardarán los valores recuperados</p>
<p align="justify">Las instrucciones<span> </span><code><span color="#0000ff">SELECT </span></code><span> </span>dentro de un programa PLSQL deben devolver una sola fila. Una consulta que devuelve más de una fila o ninguna fila genera un error de tipo, respectivamente <code>TOO_MANY_ROWS o NO_DATA_FOUND.</code> Si queremos recuperar más de una fila necesitaremos una estructura de datos llamada cursor que se verá más adelante.</p>
<p align="justify">Las instrucciones DML, <code>INSERT, UPDATE</code> y <code>DELETE</code>, se ejecutan utilizando la misma sintaxis que en SQL.</p></div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-15">
<header class="nodeDecoration">
<h1 id="exenode_15_3Tiposdedatoscompuestos" class="nodeTitle">3.- Tipos de datos compuestos.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id43-15">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta43_66" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 132px;"><img src="CASO_PERSONAJES_24.png" alt="Chica de mediana edad con el pelo corto y una chaqueta." title="Ada." class="elemento_derecha" width="132" height="200" />
<figcaption class="figcaption"><a href="https://www.educacionyfp.gob.es/portada.html" target="_blank" class="author" title="Acceder a la web del Ministerio de Educación y FP (se abre en una ventana nueva)" rel="noopener">Ministerio de Educación</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p><strong>María</strong>, gracias a la ayuda de Juan, ha comprendido muy bien el manejo básico de PL/SQL. <strong>Juan</strong> le comenta que en la mayoría de los lenguajes de programación, además de los tipos de datos simples, existen tipos de datos compuestos que le dan mucha más versatibilidad a los mismos y una gran potencia. <strong>Juan</strong> no conoce bien si PL/SQL dispone de estos tipos de datos y si dispone de ellos ¿de cuáles?</p>
<p><strong>María</strong> y <strong>Juan</strong> van a hablar con <strong>Ada</strong> para ver si les puede aclarar un poco la situación y dar unas pequeñas pautas para empezar. <strong>Ada</strong> les comenta que claro que PL/SQL cuenta con este tipo de datos, pero que hoy tiene una reunión importantísima y que tiene que terminar de preparársela, por lo que los remite al capítulo sobre tipos de datos compuestos del manual que les pasó. <strong>Juan</strong> y <strong>María</strong> le dicen que no se preocupe y que ya verá como a la vuelta de esa reunión son capaces de saber cuáles son e incluso de dominarlos. <strong>Ada</strong>, para motivarlos, les dice que si es así los invita a un aperitivo a su vuelta. Así que <strong>Juan</strong> y <strong>María</strong> se ponen con el capítulo de tipos de datos compuestos del manual para ver si pueden sorprender a <strong>Ada</strong> a su vuelta.</p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id44-15">
<div class="iDevice emphasis0">
<div id="ta44_73" class="block iDevice_content">
En el capítulo anterior, entre otras cosas, hemos conocido los tipos de datos simples con los que cuenta PL/SQL. Pero dependiendo de la complejidad de los problemas, necesitamos disponer de otras estructuras en las que apoyarnos para poder modelar nuestro problema. En este capítulo nos vamos a centrar en conocer los tipos de datos complejos que nos ofrece PL/SQL y cómo utilizarlos para así poder sacarle el mayor partido posible.

</div>
</div>
</article>
<article class="iDevice_wrapper CitasparapensarfpdIdevice em_iDevice" id="id45-15">
<div class="iDevice emphasis_citasparapensarfpd" >
<header class="iDevice_header" style="background-image:url(icon_citasparapensarfpd.png)"><h2 class="iDeviceTitle">Citas para pensar</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta45_49" class="block iDevice_content">
<blockquote>
	&quot;Todo lo complejo puede dividirse en partes simples&quot;.<cite class="elemento_derecha"><span lang="fr">René Descartes</span>.</cite>
</blockquote>

</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-16">
<header class="nodeDecoration">
<h1 id="exenode_16_31Registros" class="nodeTitle">3.1.- Registros.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id46-16">
<div class="iDevice emphasis0">
<div id="ta46_73" class="block iDevice_content">
<p>El uso de los registros es algo muy común en los lenguajes de programación. PL/SQL también nos ofrece este tipo de datos. En este apartado veremos qué son y cómo definirlos y utilizarlos.</p>
<p><span>Un <strong>registro</strong> es un grupo de elementos relacionados, referenciados por un único nombre, almacenados en campos, cada uno de los cuales tiene su propio nombre y tipo de dato.</span></p>
<p></p>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id48-16">
<div class="iDevice emphasis0">
<div id="ta48_73" class="block iDevice_content">
<p>Por ejemplo, una dirección podría ser un registro con campos como calle, número, piso, puerta, código postal, ciudad, provincia y país. Los registros hacen que la información sea más fácil de organizar y representar. Para declarar un registro seguiremos la siguiente sintaxis:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>TYPE nombre_tipo IS RECORD (decl_campo[, decl_campo] ...);</code></pre>
</div>
</div>
<pre><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> </span></pre>
</div>
<p>donde:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>decl_campo := nombre tipo [[NOT NULL] {:=|DEFAULT} expresion]</code></pre>
</div>
</div>
<pre></pre>
</div>
<p>El tipo del campo será cualquier tipo de dato válido en PL/SQL excepto <code>REF CURSOR</code>. La expresión será cualquier expresión que evalúe al tipo de dato del campo.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>TYPE direccion IS RECORD
(
calle          VARCHAR2(50),
numero          INTEGER(4),
piso          INTEGER(4),
puerta          VARCHAR2(2),
codigo_postal     INTEGER(5),
ciudad          VARCHAR2(30),
provincia     VARCHAR2(20),
pais          VARCHAR2(20) := ‘España’
);
mi_direccion direccion;</code></pre>
</div>
</div>
<pre><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> </span></pre>
</div>
<p>Para acceder a los campos usaremos el operador punto.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>...
mi_direccion.calle := ‘Ramirez Arellano’;

mi_direccion.numero := 15;

...</code></pre>
</div>
</div>
<pre></pre>
</div>
<p>Para asignar un registro a otro, éstos deben ser del mismo tipo, no basta que tengan el mismo número de campos y éstos emparejen uno a uno. Tampoco podemos comparar registros aunque sean del mismo tipo, ni tampoco comprobar si éstos son nulos. Podemos hacer<code> SELECT </code>en registros, pero no podemos hacer<code> INSERT</code> desde registros.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
TYPE familia IS RECORD
(
     identificador     NUMBER,
     nombre          VARCHAR2(40),
     padre          NUMBER,
     oficina          NUMBER
);
TYPE familia_aux IS RECORD
(
     identificador     NUMBER,
     nombre          VARCHAR2(40),
     padre          NUMBER,
     oficina          NUMBER
     );
     SUBTYPE familia_fila IS familias%ROWTYPE; -- tendrá los mismos campos que tenga la tabla familias
     mi_fam familia;
     mi_fam_aux familia_aux;
     mi_fam_fila familia_fila;
BEGIN
...
mi_fam := mi_fam_aux;                         --ilegal
mi_fam := mi_fam_fila;                         --legal
IF mi_fam IS NULL THEN ...                    --ilegal
IF mi_fam = mi_fam_fila THEN ...               --ilegal
SELECT * INTO mi_fam FROM familias ...          --legal
INSERT INTO familias VALUES (mi_fam_fila);          --ilegal
...
END;<br />/</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
<p> </p>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id49-16">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-49_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion49_60" class="block question iDevice_content">
<strong>Un registro se puede asignar a otro siempre que tenga el mismo número de campos y éstos emparejen uno a uno.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i49_63" class="sr-av"><a href="#answer-49_63">Opción 1</a></label><input type="radio" name="option49_60" id="i49_63" class="exe-radio-option exe-radio-option-0-2-49_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-49_63"><div id="taans49_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i49_146" class="sr-av"><a href="#answer-49_146">Opción 2</a></label><input type="radio" name="option49_60" id="i49_146" class="exe-radio-option exe-radio-option-1-2-49_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-49_146"><div id="taans49_146" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b49_60" class="feedback js-hidden">
<div id="taf49_63" class=" iDevice_content">
No, deben ser del mismo tipo para poder asignarlos.

</div>
</section>
<section id="sa1b49_60" class="feedback js-hidden">
<div id="taf49_146" class=" iDevice_content">
Efectivamente, veo que lo vas entendiendo.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-49_63">Incorrecto</a><span> (<a href="#sa0b49_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-49_146">Opción correcta</a><span> (<a href="#sa1b49_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-17">
<header class="nodeDecoration">
<h1 id="exenode_17_32ColeccionesArraysdelongitudvariable" class="nodeTitle">3.2.- Colecciones. Arrays de longitud variable.</h1>
</header>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id50-17">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta50_70" class="block iDevice_content">
Una colección es un grupo ordenado de elementos, todos del mismo tipo. Cada elemento tiene un subíndice único que determina su posición en la colección. 

</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id51-17">
<div class="iDevice emphasis0">
<div id="ta51_73" class="block iDevice_content">
<p><span>Una colección es un grupo ordenado de elementos, todos del mismo tipo. Cada elemento tiene un subíndice único que determina su posición en la colección.</span></p>
<p>En PL/SQL las colecciones sólo pueden tener una dimensión. PL/SQL ofrece 2 clases de colecciones: <span lang="en">arrays</span> de longitud variable y tablas anidadas.</p>
<p><span style="font-size: 14pt;"><strong><span lang="en">Arrays</span> de longitud variable. </strong> </span></p>
<p>Los elementos del tipo <code>VARRAY</code> son los llamados <span lang="en">arrays</span> de longitud variable. Son como los <span lang="en">arrays</span> de cualquier otro lenguaje de programación, pero con la salvedad de que a la hora de declararlos, nosotros indicamos su tamaño máximo y el <span lang="en">array</span> podrá ir creciendo dinámicamente hasta alcanzar ese tamaño. Un <code>VARRAY</code> siempre tiene un límite inferior igual a 1 y un límite superior igual al tamaño máximo.</p>
<p>Para declarar un <code>VARRAY</code> usaremos la sintaxis:</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>TYPE nombre IS {VARRAY | VARYING} (tamaño_máximo) OF tipo_elementos [NOT NULL];</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Donde </span><code>tamaño_máximo</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> será un entero positivo y </span><code>tipo_elementos</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> será cualquier tipo de dato válido en PL/SQL, excepto </span> <code>BINARY_INTEGER</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>BOOLEAN</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>LONG</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>LONG RAW</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>NATURAL</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>NATURALN</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>NCHAR</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>NCLOB</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>NVARCHAR2</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, objetos que tengan como atributos </span><code>TABLE</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> o </span> <code>VARRAY</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>PLS_INTEGER</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>POSITIVE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>POSITIVEN</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>SIGNTYPE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>STRING</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> , </span> <code>TABLE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, </span><code>VARRAY</code> <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> . Si </span> <code>tipo_elementos</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> es un registro, todos los campos deberían ser de un tipo escalar.</span></p>
</div>
<p>Cuando definimos un <code>VARRAY</code>, éste es automáticamente nulo, por lo que para empezar a utilizarlo deberemos inicializarlo. Para ello podemos usar un <a href="#t29c43acf-68c2-d0ec-99f0-021b2de61149" id="link29c43acf-68c2-d0ec-99f0-021b2de61149" class="exe-tooltip definition-tt titled-tt blue-tt" title="Constructor | ">constructor</a>:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>TYPE familias_hijas IS VARRAY(100) OF familia;
                familias_hijas1 familias_hijas := familias_hijas( familia(100, ’Fam100’, 10, null), ..., familia(105, ’Fam105’, 10, null));</code></pre>
</div>
</div>
<pre>        <span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> </span>
    </pre>
</div>
<p>También podemos usar constructores vacíos.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>familias_hijas2 familias_hijas := familias_hijas();</code></pre>
</div>
</div>
<pre>    </pre>
</div>
<p>Para referenciar elementos en un <code>VARRAY</code> utilizaremos la sintaxis <code>nombre_colección(subíndice)</code>. Si una función devuelve un <code>VARRAY</code>, podemos usar la sintaxis: <code>nombre_funcion(lista_parametros)(subindice)</code>.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>IF familias_hijas1(i).identificador = 100 THEN ...
                IF dame_familias_hijas(10)(i).identificador = 100 THEN ...</code></pre>
</div>
</div>
<pre>    </pre>
</div>
<p>Un <code>VARRAY</code> puede ser asignado a otro si ambos son del mismo tipo.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
                TYPE tabla1 IS VARRAY(10) OF NUMBER;
                TYPE tabla2 IS VARRAY(10) OF NUMBER;
                mi_tabla1 tabla1 := tabla1();
                mi_tabla2 tabla2 := tabla2();
                mi_tabla tabla1 := tabla1();
                BEGIN
                ...
                mi_tabla := mi_tabla1;          --legal
                mi_tabla1 := mi_tabla2;     --ilegal
                ...
                END;</code></pre>
</div>
</div>
<pre>    </pre>
</div>
<p>Para extender un <code>VARRAY</code> usaremos el método <code>EXTEND</code>. Sin parámetros, extendemos en 1 elemento nulo el <code>VARRAY</code>. <code>EXTEND(n)</code> añade n elementos nulos al <code>VARRAY</code> y <code>EXTEND(n,i)</code> añade n copias del i-ésimo elemento.</p>
<p><code>COUNT</code> nos dirá el número de elementos del <code>VARRAY</code>. <code>LIMIT</code> nos dice el tamaño máximo del <code>VARRAY. FIRST</code> siempre será 1. <code>LAST</code> siempre será igual a <code>COUNT</code>. <code>PRIOR</code> y <code>NEXT</code> devolverá el antecesor y el sucesor del elemento.</p>
<p>Al trabajar con <code>VARRAY</code> podemos hacer que salte alguna de las siguientes excepciones, debidas a un mal uso de los mismos: <code>COLECTION_IS_NULL</code>, <code>SUBSCRIPT_BEYOND_COUNT</code>, <code>SUBSCRIPT_OUTSIDE_LIMIT</code> y <code>VALUE_ERROR</code>.</p>
<p><span style="font-size: 14pt;"><strong>Ejemplos de uso de los <code>VARRAY</code>.</strong></span></p>
<ul>
<li class="lista_verificacion">Extender un <code>VARRAY</code>.</li>
</ul>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
           TYPE tab_num IS VARRAY(10) OF NUMBER;
           mi_tab tab_num;
BEGIN
            mi_tab := tab_num();
            FOR i IN 1..10 LOOP
                    mi_tab.EXTEND;
                     mi_tab(i) := calcular_elemento(i);
            END LOOP;
                      ...
END;</code></pre>
</div>
</div>
<ul>
<li>Consultar propiedades <code>VARRAY</code>.</li>
</ul>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE 
   TYPE numeros IS VARRAY(20) OF NUMBER;
   tabla_numeros numeros := numeros(); 
   num NUMBER;
BEGIN
    num := tabla_numeros.COUNT; --num := 0 
    FOR i IN 1..10 LOOP 
             tabla_numeros.EXTEND; 
             tabla_numeros(i) := i;
    END LOOP;
    num := tabla_numeros.COUNT; --num := 10 
    num := tabla_numeros.LIMIT; --num := 20
    num := tabla_numeros.FIRST; --num := 1;
    num := tabla_numeros.LAST; --num := 10; 
...
END;</code></pre>
</div>
</div>
<ul>
<li>Posibles excepciones.</li>
</ul>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
  TYPE numeros IS VARRAY(20) OF INTEGER; 
  v_numeros numeros := numeros( 10, 20, 30, 40 ); 
  v_enteros numeros;
BEGIN
   v_enteros(1) := 15; --lanzaría COLECTION_IS_NULL
   v_numeros(5) := 20; --lanzaría SUBSCRIPT_BEYOND_COUNT
   v_numeros(-1) := 5; --lanzaría SUBSCRIPT_OUTSIDE_LIMIT v_numeros(‘A’) := 25; -- 
 lanzaría VALUE_ERROR 
....
END;</code></pre>
</div>
</div>
<div id="t29c43acf-68c2-d0ec-99f0-021b2de61149" class="exe-tooltip-text">
<p>Los constructores son funciones o métodos cuyo nombre es igual al nombre de su objeto. Se utilizan para inicializar un objeto. En la mayoría de los casos, esta inicialización asigna valores a los miembros del objeto.</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id52-17">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-52_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion52_60" class="block question iDevice_content">
<strong>Indica, de entre las siguientes, cuál es la afirmación correcta referida a <code>VARRAY</code>.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i52_63" class="sr-av"><a href="#answer-52_63">Opción 1</a></label><input type="radio" name="option52_60" id="i52_63" class="exe-radio-option exe-radio-option-0-3-52_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-52_63"><div id="taans52_63" class="block iDevice_content">
Un <code>VARRAY</code> no hace falta inicializarlo.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i52_150" class="sr-av"><a href="#answer-52_150">Opción 2</a></label><input type="radio" name="option52_60" id="i52_150" class="exe-radio-option exe-radio-option-1-3-52_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-52_150"><div id="taans52_150" class="block iDevice_content">
<code>COUNT</code> y <code>LIMIT</code> siempre nos devolverán el mismo valor.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i52_153" class="sr-av"><a href="#answer-52_153">Opción 3</a></label><input type="radio" name="option52_60" id="i52_153" class="exe-radio-option exe-radio-option-2-3-52_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-52_153"><div id="taans52_153" class="block iDevice_content">
<code>LAST</code> y <code>COUNT</code> siempre nos devolverán el mismo valor.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b52_60" class="feedback js-hidden">
<div id="taf52_63" class=" iDevice_content">
Incorrecto, sí es necesario inicializar un <code>VARRAY</code> para poder empezar a utilizarlo.

</div>
</section>
<section id="sa1b52_60" class="feedback js-hidden">
<div id="taf52_150" class=" iDevice_content">
No, esta afirmación será cierta en el caso en el que el <code>VARRAY</code> esté lleno totalmente.

</div>
</section>
<section id="sa2b52_60" class="feedback js-hidden">
<div id="taf52_153" class=" iDevice_content">
Efectivamente, estás en lo cierto.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-52_63">Incorrecto</a><span> (<a href="#sa0b52_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-52_150">Incorrecto</a><span> (<a href="#sa1b52_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-52_153">Opción correcta</a><span> (<a href="#sa2b52_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-18">
<header class="nodeDecoration">
<h1 id="exenode_18_321ColeccionesTablasanidadas" class="nodeTitle">3.2.1.- Colecciones. Tablas anidadas.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id54-18">
<div class="iDevice emphasis0">
<div id="ta54_73" class="block iDevice_content">
<p>Las tablas anidadas son colecciones de elementos, que no tienen límite superior fijo, y pueden aumentar dinámicamente su tamaño. Además podemos borrar elementos individuales.</p>
<p>Para declararlos utilizaremos la siguiente sintaxis:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>TYPE nombre IS TABLE OF tipo_elementos [NOT NULL];</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Donde </span><code>tipo_elementos</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> tendrá las mismas restricciones que para los </span><code>VARRAY</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">.</span></p>
</div>
<p>Al igual que pasaba con los <code>VARRAY</code>, al declarar una tabla anidada, ésta es automáticamente nula, por lo que deberemos inicializarla antes de usarla.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>TYPE hijos IS TABLE OF agente;
hijos_fam hijos := hijos( agente(...) ...);</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">También podemos usar un constructor nulo.</span></p>
</div>
<p>Para referenciar elementos usamos la misma sintaxis que para los <code>VARRAY</code>.</p>
<p>Para extender una tabla usamos <code>EXTEND</code> exactamente igual que para los <code>VARRAY</code>. <code>COUNT</code> nos dirá el número de elementos, que no tiene por qué coincidir con <code>LAST</code>. <code>LIMIT</code> no tiene sentido y devuelve <code>NULL</code>. <code>EXISTS(n)</code> devuelve <code>TRUE</code> si el elemento existe, y <code>FALSE</code> en otro caso (el elemento ha sido borrado). <code>FIRST</code> devuelve el primer elemento que no siempre será 1, ya que hemos podido borrar elementos del principio. <code>LAST</code> devuelve el último elemento. <code>PRIOR</code> y <code>NEXT</code> nos dicen el antecesor y sucesor del elemento (ignorando elementos borrados). <code>TRIM</code> sin argumentos borra un elemento del final de la tabla. <code>TRIM(n)</code> borra n elementos del final de la tabla. <code>TRIM</code> opera en el tamaño interno, por lo que si encuentra un elemento borrado con <code>DELETE</code>, lo incluye para ser eliminado de la colección. <code>DELETE(n)</code> borra el n-ésimo elemento. <code>DELETE(n, m)</code> borra del elemento n al m. Si después de hacer <code>DELETE</code>, consultamos si el elemento existe nos devolverá <code>FALSE</code>.</p>
<p>Al trabajar con tablas anidadas podemos hacer que salte alguna de las siguientes excepciones, debidas a un mal uso de las mismas: <code>COLECTION_IS_NULL</code>, <code>NO_DATA_FOUND</code>, <code>SUBSCRIPT_BEYOND_COUNT</code> y <code>VALUE_ERROR</code>.</p>
<p><span style="font-size: 14pt;"><strong>Ejemplos de uso de las tablas anidadas.</strong></span></p>
<p><strong>Diferentes operaciones sobre tablas anidadas.</strong></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
TYPE numeros IS TABLE OF NUMBER;
tabla_numeros numeros := numeros();
num NUMBER;
BEGIN
num := tabla_numeros.COUNT;     --num := 0
FOR i IN 1..10 LOOP
     tabla_numeros.EXTEND;
     tabla_numeros(i) := i;
END LOOP;
num := tabla_numeros.COUNT;     --num := 10
tabla_numeros.DELETE(10);
num := tabla_numeros.LAST;     --num := 9
num := tabla_numeros.FIRST;     --num := 1
tabla_numeros.DELETE(1);
num := tabla_numeros.FIRST;     --num := 2
FOR i IN 1..4 LOOP
     tabla_numeros.DELETE(2*i);
END LOOP;
num := tabla_numeros.COUNT;     --num := 4
num := tabla_numeros.LAST;     --num := 9
...
END;</code></pre>
</div>
</div>
<p><strong>Posibles excepciones en su uso.</strong></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
TYPE numeros IS TABLE OF NUMBER;
tabla_num numeros := numeros();
tabla1 numeros;
BEGIN
tabla1(5) := 0;     --lanzaría COLECTION_IS_NULL
tabla_num.EXTEND(5);
tabla_num.DELETE(4);
tabla_num(4) := 3;     --lanzaría NO_DATA_FOUND
tabla_num(6) := 10;     --lanzaría SUBSCRIPT_BEYOND_COUNT
tabla_num(-1) := 0;     --lanzaría SUBSCRIPT_OUTSIDE_LIMIT
tabla_num(‘y’) := 5;--lanzaría VALUE_ERROR
END;</code></pre>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id55-18">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-55_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion55_60" class="block question iDevice_content">
<strong>Las tablas anidadas podemos hacer que crezcan dinámicamente, pero no podemos borrar elementos.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i55_63" class="sr-av"><a href="#answer-55_63">Opción 1</a></label><input type="radio" name="option55_60" id="i55_63" class="exe-radio-option exe-radio-option-0-2-55_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-55_63"><div id="taans55_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i55_157" class="sr-av"><a href="#answer-55_157">Opción 2</a></label><input type="radio" name="option55_60" id="i55_157" class="exe-radio-option exe-radio-option-1-2-55_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-55_157"><div id="taans55_157" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b55_60" class="feedback js-hidden">
<div id="taf55_63" class=" iDevice_content">
No, en las tablas anidadas también podemos borrar elementos.

</div>
</section>
<section id="sa1b55_60" class="feedback js-hidden">
<div id="taf55_157" class=" iDevice_content">
¡Muy bien!

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-55_63">Incorrecto</a><span> (<a href="#sa0b55_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-55_157">Opción correcta</a><span> (<a href="#sa1b55_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-19">
<header class="nodeDecoration">
<h1 id="exenode_19_33Cursores" class="nodeTitle">3.3.- Cursores.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id56-19">
<div class="iDevice emphasis0">
<div id="ta56_73" class="block iDevice_content">
<p>En los apartados anteriores hemos visto algunos tipos de datos compuestos cuyo uso es común en otros lenguajes de programación. Sin embargo, en este apartado vamos a ver un tipo de dato, que aunque se puede asemejar a otros que ya conozcas, su uso es exclusivo en la programación de las bases de datos y que es el <strong>cursor</strong>.</p>
<p><span>Un <strong>cursor</strong> no es más que una estructura que almacena el conjunto de filas devuelto por una consulta a la base de datos.</span></p>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id58-19">
<div class="iDevice emphasis0">
<div id="ta58_73" class="block iDevice_content">
<p><span lang="en">Oracle</span> usa áreas de trabajo para ejecutar sentencias SQL y almacenar la información procesada. Hay 2 clases de cursores: <strong>implícitos</strong> y <strong>explícitos</strong>. PL/SQL declara implícitamente un cursor para todas las sentencias SQL de manipulación de datos, incluyendo consultas que devuelven una sola fila. Para las consultas que devuelven más de una fila, se debe declarar explícitamente un cursor para procesar las filas individualmente.</p>
<p>En este primer apartado vamos a hablar de los cursores implícitos y de los atributos de un cursor (estos atributos tienen sentido con los cursores explícitos, pero los introducimos aquí para ir abriendo boca), para luego pasar a ver los cursores explícitos y terminaremos hablando de los cursores variables.</p>
<p><strong>Cursores implícitos.</strong></p>
<p><span lang="en">Oracle</span> abre implícitamente un cursor para procesar cada sentencia SQL que no esté asociada con un cursor declarado explícitamente.</p>
<p>Con un cursor implícito no podemos usar las sentencias <code>OPEN</code>, <code>FETCH</code> y <code>CLOSE</code> para controlar el cursor. Pero sí podemos usar los atributos del cursor para obtener información sobre las sentencias SQL más recientemente ejecutadas.</p>
<p><strong>Atributos de un cursor.</strong></p>
<p>Cada cursor tiene 4 atributos que podemos usar para obtener información sobre la ejecución del mismo o sobre los datos. Estos atributos pueden ser usados en PL/SQL, pero no en SQL. Aunque estos atributos se refieren en general a cursores explícitos y tienen que ver con las operaciones que hayamos realizado con el cursor, es deseable comentarlas aquí y en el siguiente apartado tomarán pleno sentido.</p>
<ul class="lista_verificacion">
<li>%<code>FOUND</code>: Después de que el cursor esté abierto y antes del primer <code>FETCH</code>, <code>%FOUND</code> devuelve <code>NULL</code>. Después del primer <code>FETCH</code>, <code>%FOUND</code> devolverá <code>TRUE</code> si el último <code>FETCH</code> ha devuelto una fila y <code>FALSE</code> en caso contrario. Para cursores implícitos <code>%FOUND</code> devuelve <code>TRUE</code> si un <code>INSERT</code>, <code>UPDATE</code> o <code>DELETE</code> afectan a una o más de una fila, o un <code>SELECT ... INTO ...</code> devuelve una o más filas. En otro caso <code>%FOUND</code> devuelve <code>FALSE</code>.</li>
<li><code>%NOTFOUND</code>: Es lógicamente lo contrario a <code>%FOUND</code>.</li>
<li><code>%ISOPEN</code>: Evalúa a <code>TRUE</code> si el cursor está abierto y <code>FALSE</code> en caso contrario. Para cursores implícitos, como <span lang="en">Oracle</span> los cierra automáticamente, <code>%ISOPEN</code> evalúa siempre a <code>FALSE</code>.</li>
<li><code>%ROWCOUNT</code>: Para un cursor abierto y antes del primer <code>FETCH</code>, <code>%ROWCOUNT</code> evalúa a 0. Después de cada <code>FETCH</code>, <code>%ROWCOUNT</code> es incrementado y evalúa al número de filas que hemos procesado. Para cursores implícitos <code>%ROWCOUNT</code> evalúa al número de filas afectadas por un <code>INSERT</code>, <code>UPDATE</code> o <code>DELETE</code> o el número de filas devueltas por un <code>SELECT ... INTO ...</code></li>
</ul>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id59-19">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta59_48" class="block iDevice_content">
<p>Aunque todavía no hemos visto las operaciones que se pueden realizar con un cursor explícito, es conveniente que te vayas familiarizando con la evaluación de sus atributos según las operaciones que hayamos realizado con el cursor y que tomarán pleno sentido cuando veamos el siguiente apartado.</p>
<p class="enlace_centrado"><a href="#exenode_37_AnexoIIIEvaluacindelosatributosdeuncursorexplcito" title="Acceder al anexo donde se muestra el resultado de la evaluación de los atributos de un cursor explícito según las operaciones que hayamos realizado con él.">Evaluación de los atributos de un cursor explícito.</a></p>
</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-20">
<header class="nodeDecoration">
<h1 id="exenode_20_331Cursoresexplcitos" class="nodeTitle">3.3.1.- Cursores explícitos.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id61-20">
<div class="iDevice emphasis0">
<div id="ta61_73" class="block iDevice_content">
<p>Cuando una consulta devuelve múltiples filas, debemos declarar explícitamente un cursor para procesar las filas devueltas. Cuando declaramos un cursor, lo que hacemos es darle un nombre y asociarle una consulta usando la siguiente sintaxis:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>CURSOR nombre_cursor [(parametro [, parametro] ...)] [RETURN tipo_devuelto] IS sentencia_select;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Donde </span><code>tipo_devuelto</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> debe representar un registro o una fila de una tabla de la base de datos, y </span><code>parámetro</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> sigue la siguiente sintaxis:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>parametro := nombre_parametro [IN] tipo_dato [{:= | DEFAULT} expresion]</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Ejemplos:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>CURSOR cAgentes IS SELECT * FROM agentes;
CURSOR cFamilias RETURN familias%ROWTYPE IS SELECT * FROM familias WHERE ...</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Además, como hemos visto en la declaración, un cursor puede tomar parámetros, los cuales pueden aparecer en la consulta asociada como si fuesen constantes. Los parámetros serán de entrada, un cursor no puede devolver valores en los parámetros actuales. A un parámetro de un cursor no podemos imponerle la restricción </span><code>NOT NULL</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">.</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>CURSOR c1 (cat INTEGER DEFAULT 0) IS SELECT * FROM agentes WHERE categoria = cat;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Cuando abrimos un cursor, lo que se hace es ejecutar la consulta asociada e identificar el conjunto resultado, que serán todas las filas que emparejen con el criterio de búsqueda de la consulta. Para abrir un cursor usamos la sintaxis:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>OPEN nombre_cursor [(parametro [, parametro] ...)];</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Ejemplos:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>OPEN cAgentes;
OPEN c1(1);
OPEN c1;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">La sentencia </span><code>FETCH</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> devuelve una fila del conjunto resultado. Después de cada </span><code>FETCH</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, el cursor avanza a la próxima fila en el conjunto resultado.</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>FETCH cFamilias INTO mi_id, mi_nom, mi_fam, mi_ofi;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Para cada valor de columna devuelto por la consulta <code>SELECT</code> asociada al cursor, debe haber una variable que se corresponda en la lista de variables después del </span><code>INTO</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">.</span></p>
</div>
<p>Para procesar un cursor entero deberemos hacerlo por medio de un bucle.</p>
<p>Hay varias formas de hacerlo. En el formato del ejemplo siguiente es necesario abrir el cursor previamente y tras recorrerlo cerrarlo.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>BEGIN
...
OPEN cFamilias;
LOOP
     FETCH cFamilias INTO mi_id, mi_nom, mi_fam, mi_ofi;
     EXIT WHEN cFamilias%NOTFOUND;
     ...
END LOOP;
CLOSE cFamilias;
...
END;</code></pre>
</div>
</div>
</div>
<p>Una vez cerrado el cursor podemos reabrirlo, pero cualquier otra operación que hagamos con el cursor cerrado lanzará la excepción <code>INVALID_CURSOR</code>.</p>
<p>Otra forma más sencilla es utilizar los bucles para cursores, los cuales declaran implícitamente una variable índice definida como <code>%ROWTYPE</code> para el cursor, abren el cursor, extraen los valores de cada fila del cursor, almacenándolas en la variable índice, y finalmente cierran el cursor.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>BEGIN
     ...
     FOR cFamilias_rec IN cFamilias LOOP
          --Procesamos las filas accediendo a 
          --cFamilias_rec.identificador, cFamilias_rec.nombre,
          --cFamilias_rec.familia, ...
     END LOOP;
     ...
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id62-20">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-62_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion62_60" class="block question iDevice_content">
<strong>En PL/SQL los cursores son abiertos al definirlos.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i62_63" class="sr-av"><a href="#answer-62_63">Opción 1</a></label><input type="radio" name="option62_60" id="i62_63" class="exe-radio-option exe-radio-option-0-2-62_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-62_63"><div id="taans62_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i62_74" class="sr-av"><a href="#answer-62_74">Opción 2</a></label><input type="radio" name="option62_60" id="i62_74" class="exe-radio-option exe-radio-option-1-2-62_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-62_74"><div id="taans62_74" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b62_60" class="feedback js-hidden">
<div id="taf62_63" class=" iDevice_content">
No, un cursor se debe abrir por medio de la sentencia <code>OPEN</code>.

</div>
</section>
<section id="sa1b62_60" class="feedback js-hidden">
<div id="taf62_74" class=" iDevice_content">
Efectivamente, debemos abrirlos por medio de la sentencia <code>OPEN</code>.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-62_63">Incorrecto</a><span> (<a href="#sa0b62_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-62_74">Opción correcta</a><span> (<a href="#sa1b62_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-21">
<header class="nodeDecoration">
<h1 id="exenode_21_332Cursoresvariables" class="nodeTitle">3.3.2.- Cursores variables.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id63-21">
<div class="iDevice emphasis0">
<div id="ta63_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="BD06_CONT_R25_Senalar.jpg" alt="Ilustración en la que se ven tres monos en primer plano y uno de ellos está señalando con el dedo." title="Apuntar." class="elemento_derecha" width="200" height="132" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la Web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE (Abraham Pérez Pérez)</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p><span lang="en">Oracle</span>, además de los cursores vistos anteriormente, nos permite definir cursores variables que son como punteros a cursores, por lo que podemos usarlos para referirnos a cualquier tipo de consulta. Los cursores serían estáticos y los cursores variables serían dinámicos.</p>
<p>Para declarar un cursor variable debemos seguir 2 pasos:</p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;">Definir un tipo <code>REF CURSOR</code> y entonces declarar una variable de ese tipo.
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>TYPE tipo_cursor IS REF CURSOR RETURN agentes%ROWTYPE;
cAgentes tipo_cursor;</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li>Una vez definido el cursor variable debemos asociarlo a una consulta (notar que esto no se hace en la parte declarativa, sino dinámicamente en la parte de ejecución) y esto lo hacemos con la sentencia <code>OPEN-FOR</code> utilizando la siguiente sintaxis:
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>OPEN nombre_variable_cursor FOR sentencia_select;
OPEN cAgentes FOR SELECT * FROM agentes WHERE oficina = 1;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Un cursor variable no puede tomar parámetros. Podemos usar los atributos de los cursores para cursores variables.</span></p>
</div>
</li>
</ul>
<p style="padding-left: 30px;">Además, podemos usar varios <code>OPEN-FOR</code> para abrir el mismo cursor variable para diferentes consultas. No necesitamos cerrarlo antes de reabrirlo. Cuando abrimos un cursor variable para una consulta diferente, la consulta previa se pierde.</p>
<p style="padding-left: 30px;">Una vez abierto el cursor variable, su manejo es idéntico a un cursor. Usaremos <code>FETCH</code> para traernos las filas, usaremos sus atributos para hacer comprobaciones y lo cerraremos cuando dejemos de usarlo.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
TYPE cursor_Agentes IS REF CURSOR RETURN agentes%ROWTYPE;
cAgentes cursor_Agentes;
agente cAgentes%ROWTYPE;
BEGIN
...
OPEN cAgentes FOR SELECT * FROM agentes WHERE oficina = 1;
LOOP
     FETCH cAgentes INTO agente;
     EXIT WHEN cAgentes%NOTFOUND;
     ...
END LOOP;
CLOSE cAgentes;
...
END;</code></pre>
</div>
</div>
<div>También puede utilizarse el bucle<code> FOR</code> con cursores variable definidos dentro del mismo bucle:</div>
<div></div>
<div><code><code></code></code>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>for va_cursor in (select ...) loop
...
end loop;
</code></pre>
</div>
</div>
</div>
<pre></pre>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id64-21">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-64_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion64_60" class="block question iDevice_content">
<strong>A los cursores variables no podemos pasarles parámetros al abrirlos.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i64_63" class="sr-av"><a href="#answer-64_63">Opción 1</a></label><input type="radio" name="option64_60" id="i64_63" class="exe-radio-option exe-radio-option-0-2-64_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-64_63"><div id="taans64_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i64_77" class="sr-av"><a href="#answer-64_77">Opción 2</a></label><input type="radio" name="option64_60" id="i64_77" class="exe-radio-option exe-radio-option-1-2-64_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-64_77"><div id="taans64_77" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b64_60" class="feedback js-hidden">
<div id="taf64_63" class=" iDevice_content">
Correcto, veo que lo vas entendiendo.

</div>
</section>
<section id="sa1b64_60" class="feedback js-hidden">
<div id="taf64_77" class=" iDevice_content">
No, a este tipo de cursores no podemos pasarles parámetros al abrirlos.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-64_63">Opción correcta</a><span> (<a href="#sa0b64_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-64_77">Incorrecto</a><span> (<a href="#sa1b64_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-64_80" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion64_80" class="block question iDevice_content">
<strong>Los cursores variables se abren exactamente igual que los cursores explícitos.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i64_83" class="sr-av"><a href="#answer-64_83">Opción 1</a></label><input type="radio" name="option64_80" id="i64_83" class="exe-radio-option exe-radio-option-0-2-64_80-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-64_83"><div id="taans64_83" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i64_86" class="sr-av"><a href="#answer-64_86">Opción 2</a></label><input type="radio" name="option64_80" id="i64_86" class="exe-radio-option exe-radio-option-1-2-64_80-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-64_86"><div id="taans64_86" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b64_80" class="feedback js-hidden">
<div id="taf64_83" class=" iDevice_content">
No, al abrir un cursor variable debemos asociarle la consulta por medio de la sentencia <code>OPEN-FOR</code>.

</div>
</section>
<section id="sa1b64_80" class="feedback js-hidden">
<div id="taf64_86" class=" iDevice_content">
Correcto, ya que debemos abrirlo por medio de la sentencia <code>OPEN-FOR</code> con la que le asociamos la consulta.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-64_83">Incorrecto</a><span> (<a href="#sa0b64_80">Retroalimentación</a>)</span></li>
<li><a href="#answer-64_86">Opción correcta</a><span> (<a href="#sa1b64_80">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-22">
<header class="nodeDecoration">
<h1 id="exenode_22_4AbstraccinenPLSQL" class="nodeTitle">4.- Abstracción en PL/SQL.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id65-22">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta65_66" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 132px;"><img src="BD06_CONT_R26_Abstracto.jpg" alt="Cuadro abstracto de Joan Miró." title="Abstracto." class="elemento_derecha" width="132" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Acceder a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><strong>María</strong>, gracias a la ayuda de <strong>Juan</strong>, tiene bastante claro cómo programar en PL/SQL pero no entiende muy bien cómo integrar todo esto con la base de datos de juegos <span lang="en">on-line</span>. Sabe que puede utilizar unos tipos de datos, que hay unas estructuras de control y que se pueden manejar los errores que surjan, pero lo que no sabe es cómo y donde utilizar todo eso.</p>
<p><strong>Juan</strong> le explica que lo que hasta ahora ha aprendido es el comienzo, pero que ahora viene lo bueno y que será donde le va a encontrar pleno sentido a lo aprendido anteriormente. Le explica que PL/SQL permite crear funciones y procedimientos y además agruparlos en paquetes y que eso será lo que realmente van a hacer con la base de datos de juegos <span lang="en">on-line</span>. Deberán ver qué es lo que utilizan más comúnmente e implementarlo en PL/SQL utilizando funciones y procedimientos según convenga. <strong>Juan</strong> la tranquiliza y le dice que lo primero que va a hacer es explicarle cómo se escriben dichas funciones y procedimientos y luego pasarán a implementar alguno y que así verá la potencia real de PL/SQL. <strong>María</strong> se queda más tranquila y está deseando implementar esa primera función o procedimiento que le resolverá la gran duda que tiene.</p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id66-22">
<div class="iDevice emphasis0">
<div id="ta66_73" class="block iDevice_content">
<p>
Hoy día cualquier lenguaje de programación permite definir diferentes grados de abstracción en sus programas. La abstracción permite a los programadores crear unidades lógicas y posteriormente utilizarlas pensando en qué hace y no en cómo lo hace. La abstracción se consigue utilizando funciones, procedimientos, librerías, objetos, etc.
</p>
<p>
PL/SQL nos permite definir funciones y procedimientos. Además nos permite agrupar todas aquellas que tengan relación en paquetes. También permite la utilización de objetos. Todo esto es lo que veremos en este apartado y conseguiremos darle modularidad a nuestras aplicaciones, aumentar la reusabilidad y mantenimiento del código y añadir grados de abstracción a los problemas.
</p>

</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id67-22">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta67_47" class="block iDevice_content">
<p>En los siguientes enlaces puedes ampliar información sobre la abstracción en programación.</p>
<p class="enlace_centrado"><a href="http://es.wikipedia.org/wiki/Abstracci%C3%B3n_%28inform%C3%A1tica%29" title="Acceder a un artículo de la wikipedia que habla de la abstracción en programación." target="_self">Abstracción en los lenguajes de programación.</a></p>
<p class="enlace_centrado"><a href="http://es.wikipedia.org/wiki/Programaci%C3%B3n_orientada_a_objetos" title="Acceder a un artículo de la wikipedia que habla trata la programación orientada a objetos.">Programación orientada a objetos.</a></p>
</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-23">
<header class="nodeDecoration">
<h1 id="exenode_23_41Subprogramas" class="nodeTitle">4.1.- Subprogramas.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id70-23">
<div class="iDevice emphasis0">
<div id="ta70_73" class="block iDevice_content">
<p>Los <strong>subprogramas</strong> son bloques de código PLSQL, referenciados bajo un nombre, que realizan una acción determinada. Les podemos pasar parámetros y los podemos invocar. Además, los subprogramas pueden estar almacenados en la base de datos o estar encerrados en otros bloques. Si el programa está almacenado en la base de datos, podremos invocarlo si tenemos permisos suficientes y si está encerrado en otro bloque lo podremos invocar si tenemos visibilidad sobre el mismo.</p>
<p>Hay dos clases de subprogramas: las funciones y los procedimientos. Las funciones devuelven un valor y los procedimientos no.</p>
<p>Para declarar un subprograma utilizamos la siguiente sintaxis:</p>
<p><strong>Sintaxis de Funciones.</strong></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>FUNCTION nombre [(parametro [, parametro] ...)]
   RETURN tipo_dato IS
   [declaraciones_locales]
BEGIN
   sentencias_ejecutables
[EXCEPTION
   manejadores_de_excepciones]
END [nombre];</code></pre>
</div>
</div>
<p><strong>Sintaxis de Procedimientos.</strong></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>PROCEDURE nombre [( parametro [, parametro] ... )] IS
   [declaraciones_locales]
BEGIN
   sentencias_ejecutables
[EXCEPTION manejadores_de_excepciones]
END [nombre];</code></pre>
</div>
</div>
<p><br />Donde:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>parametro := nombre_parametro [IN|OUT|IN OUT] tipo_dato [{:=|DEFAULT} expresion]</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Algunas consideraciones que debes tener en cuenta son las siguientes:</span></p>
</div>
<ul class="lista_verificacion">
<li>No podemos imponer una restricción <code>NOT NULL</code> a un parámetro.</li>
<li>No podemos especificar una restricción del tipo:
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>PROCEDURE KK(a NUMBER(10)) IS ...           --ilegal</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li>Una función siempre debe acabar con la sentencia <code>RETURN.</code></li>
</ul>
<p>Podemos definir subprogramas al final de la parte declarativa de cualquier bloque. En <span lang="en">Oracle</span>, cualquier identificador debe estar declarado antes de usarse, y eso mismo pasa con los subprogramas, por lo que deberemos declararlos antes de usarlos.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
hijos NUMBER;
FUNCTION hijos_familia( id_familia NUMBER ) 
     RETURN NUMBER IS
     hijos NUMBER;
BEGIN
     SELECT COUNT(*) INTO hijos FROM agentes 
          WHERE familia = id_familia;
     RETURN hijos;
END hijos_familia;
BEGIN
...
END;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Si quisiéramos definir subprogramas en orden alfabético o lógico, o necesitamos definir subprogramas mutuamente recursivos (uno llama a otro, y éste a su vez llama al anterior), deberemos usar la definición hacia delante, para evitar errores de compilación.</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>DECLARE
     PROCEDURE calculo(...);          --declaración hacia delante
     --Definimos subprogramas agrupados lógicamente
     PROCEDURE inicio(...) IS
     BEGIN
          ...
          calculo(...);
          ...
     END;
     ...
BEGIN
     ...
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id71-23">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-71_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion71_60" class="block question iDevice_content">
<p><strong>Una función siempre debe devolver un valor.</strong></p>
</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i71_63" class="sr-av"><a href="#answer-71_63">Opción 1</a></label><input type="radio" name="option71_60" id="i71_63" class="exe-radio-option exe-radio-option-0-2-71_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-71_63"><div id="taans71_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i71_92" class="sr-av"><a href="#answer-71_92">Opción 2</a></label><input type="radio" name="option71_60" id="i71_92" class="exe-radio-option exe-radio-option-1-2-71_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-71_92"><div id="taans71_92" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b71_60" class="feedback js-hidden">
<div id="taf71_63" class=" iDevice_content">
Efectivamente, una función obligatoriamente debe devolver un valor.

</div>
</section>
<section id="sa1b71_60" class="feedback js-hidden">
<div id="taf71_92" class=" iDevice_content">
Incorrecto, creo que debería repasar este apartado.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-71_63">Opción correcta</a><span> (<a href="#sa0b71_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-71_92">Incorrecto</a><span> (<a href="#sa1b71_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-71_95" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion71_95" class="block question iDevice_content">
<strong>En PL/SQL no podemos definir subprogramas mutuamente recursivos.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i71_98" class="sr-av"><a href="#answer-71_98">Opción 1</a></label><input type="radio" name="option71_95" id="i71_98" class="exe-radio-option exe-radio-option-0-2-71_95-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-71_98"><div id="taans71_98" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i71_101" class="sr-av"><a href="#answer-71_101">Opción 2</a></label><input type="radio" name="option71_95" id="i71_101" class="exe-radio-option exe-radio-option-1-2-71_95-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-71_101"><div id="taans71_101" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b71_95" class="feedback js-hidden">
<div id="taf71_98" class=" iDevice_content">
Incorrecto ya que podemos hacerlo usando la definición hacia delante.

</div>
</section>
<section id="sa1b71_95" class="feedback js-hidden">
<div id="taf71_101" class=" iDevice_content">
¡Muy bien!

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-71_98">Incorrecto</a><span> (<a href="#sa0b71_95">Retroalimentación</a>)</span></li>
<li><a href="#answer-71_101">Opción correcta</a><span> (<a href="#sa1b71_95">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-24">
<header class="nodeDecoration">
<h1 id="exenode_24_411Almacenarsubprogramasenlabasededatos" class="nodeTitle">4.1.1.- Almacenar subprogramas en la base de datos.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id72-24">
<div class="iDevice emphasis0">
<div id="ta72_73" class="block iDevice_content">
<p>Para almacenar un subprograma en la base de datos utilizaremos la misma sintaxis que para declararlo, anteponiendo <code>CREATE [OR REPLACE]</code> a <code>PROCEDURE</code> o <code>FUNCTION</code>, y finalizando el subprograma con una línea que simplemente contendrá el carácter '/' para indicarle a <span lang="en">Oracle</span> que termina ahí. Si especificamos <code>OR REPLACE</code> y el subprograma ya existía, éste será reemplazado. Si no lo especificamos y el subprograma ya existe, <span lang="en">Oracle</span> nos devolverá un error indicando que el nombre ya está siendo utilizado por otro objeto de la base de datos.</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>CREATE OR REPLACE FUNCTION hijos_familia(id_familia NUMBER) 
   RETURN NUMBER IS hijos NUMBER;
BEGIN
  SELECT COUNT(*) INTO hijos FROM agentes
       WHERE familia = id_familia;
RETURN hijos;
END;
/</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Cuando los subprogramas son almacenados en la base de datos, para ellos no podemos utilizar las declaraciones hacia delante, por lo que cualquier subprograma almacenado en la base de datos deberá conocer todos los subprogramas que utilice.</span></p>
</div>
<p>Para invocar un subprograma usaremos la sintaxis:</p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>nombre_procedimiento [(parametro [,parametro] ...)];
variable := nombre_funcion [(parametro [, parametro] ...)];
BEGIN
...
  hijos := hijos_familia(10);
...
END;</code></pre>
</div>
</div>
<p>Si el subprograma está almacenado en la base de datos y queremos invocarlo desde <span lang="en">SQL*Plus</span> usaremos la sintaxis:</p>
<div>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>EXECUTE nombre_procedimiento [(parametros)];
EXECUTE :variable_sql := nombre_funcion [(parametros)];</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Cuando almacenamos un subprograma en la base de datos éste es compilado antes. Si hay algún error se nos informará de los mismos y deberemos corregirlos creándolo de nuevo por medio de la cláusula </span><code>OR REPLACE</code><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">, antes de que el subprograma pueda ser utilizado.</span></p>
</div>
<p>Hay varias vistas del <a href="#td5e08d94-553a-2f81-0f1e-b86bd00bf847" id="linkd5e08d94-553a-2f81-0f1e-b86bd00bf847" class="exe-tooltip definition-tt titled-tt blue-tt" title="Diccionario de datos  | ">diccionario de datos</a> que nos ayudan a llevar un control de los subprogramas, tanto para ver su código, como los errores de compilación. También hay algunos comandos de <span lang="en">SQL*Plus</span> que nos ayudan a hacer lo mismo pero de forma algo menos engorrosa.</p>
<p>El comando SQLPlus <code>show errors</code> tras la compilación de un procedimiento o función nos muestra los errores si los hay.</p>
<p></p>
<table class="tabla" summary="Tabla en la que se muestran las vistas del diccionario de datos y los comandos SQL*Plus relacionadas con los subprogramas."><caption>Vistas y comandos asociados a los subprogramas.</caption>
<thead>
<tr>
<th scope="col">Información almacenada.</th>
<th scope="col">Vista del diccionario.</th>
<th scope="col">Comando.</th>
</tr>
</thead>
<tbody>
<tr>
<td>Código fuente.</td>
<td><code>USER_SOURCE</code></td>
<td><code>DESCRIBE
			</code></td>
</tr>
<tr>
<td>Errores de compilación.</td>
<td><code>USER_ERRORS</code></td>
<td><code>SHOW ERRORS
			</code></td>
</tr>
<tr>
<td>Ocupación de memoria.</td>
<td><code>USER_OBJECT_SIZE</code></td>
<td> </td>
</tr>
</tbody>
</table>
<p></p>
<p>También existe la vista <code>USER_OBJECTS</code> de la cual podemos obtener los nombres de todos los subprogramas almacenados.</p>
<div id="td5e08d94-553a-2f81-0f1e-b86bd00bf847" class="exe-tooltip-text">
<p>El diccionario de datos es un conjunto de tablas gestionadas por el SGBD, que dan información sobre el contenido de una base de datos: las estructuras de almacenamiento; las usuarios y sus derechos; los objetos (tablas, vistas, índices, procedimientos, funciones, etc.).</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id73-24">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta73_48" class="block iDevice_content">
<p>En la siguiente presentación te mostramos las vistas relacionadas con los subprogramas, la compilación de un subprograma con errores y cómo mostrar los mismos, la compilación de un subprograma correctamente y cómo mostrar su código fuente y la ejecución de un subprograma desde <span lang="en">SQL*Plus y desde SQLDeveloper</span></p>
<div class="elemento_centrado">
<div class="elemento_centrado"><a href="BD06_CONT_R29_Subprogramas.odp" title="Descarga una Presentación sobre los Subprogramas [odp - 315,90 KB]">Presentación Subprogramas</a><span class="exe-link-data file-size"> (odp - 315,90 <abbr title="KiloBytes" lang="en">KB</abbr>)</span></div>
<div class="credenciales elemento_centrado"><a href="BD06_Descripcion_Presentacion_Subprogramas_plsql.html" title="Resumen textual alternativo para &quot;subprogramas en PL/SQL&quot;.">Resumen textual alternativo</a></div>
</div>
<p> </p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id74-24">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-74_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion74_60" class="block question iDevice_content">
<strong>Una vez que hemos almacenado un subprograma en la base de datos podemos consultar su código mediante la vista <code>USER_OBJECTS</code>.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i74_63" class="sr-av"><a href="#answer-74_63">Opción 1</a></label><input type="radio" name="option74_60" id="i74_63" class="exe-radio-option exe-radio-option-0-2-74_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-74_63"><div id="taans74_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i74_108" class="sr-av"><a href="#answer-74_108">Opción 2</a></label><input type="radio" name="option74_60" id="i74_108" class="exe-radio-option exe-radio-option-1-2-74_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-74_108"><div id="taans74_108" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b74_60" class="feedback js-hidden">
<div id="taf74_63" class=" iDevice_content">
No, podemos hacerlo mediante la vista <code>USER_SOURCE</code>.

</div>
</section>
<section id="sa1b74_60" class="feedback js-hidden">
<div id="taf74_108" class=" iDevice_content">
Sí, lo estás captando a la primera.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-74_63">Incorrecto</a><span> (<a href="#sa0b74_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-74_108">Opción correcta</a><span> (<a href="#sa1b74_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-25">
<header class="nodeDecoration">
<h1 id="exenode_25_412Parmetrosdelossubprogramas" class="nodeTitle">4.1.2.- Parámetros de los subprogramas.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id75-25">
<div class="iDevice emphasis0">
<div id="ta75_73" class="block iDevice_content">
<p>Ahora vamos a profundizar un poco más en los parámetros que aceptan los subprogramas y cómo se los podemos pasar a la hora de invocarlos.</p>
<p><span>Las variables pasadas como parámetros a un subprograma son llamadas </span><strong>parámetros actuales</strong><span>. Las variables referenciadas en la especificación del subprograma como parámetros, son llamadas </span><strong>parámetros formales</strong><span>.</span></p>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id77-25">
<div class="iDevice emphasis0">
<div id="ta77_73" class="block iDevice_content">
<p>Cuando llamamos a un subprograma, los parámetros actuales podemos escribirlos utilizando notación posicional o notación nombrada, es decir, la asociación entre parámetros actuales y formales podemos hacerla por posición o por nombre.</p>
<p>En la notación posicional, el primer parámetro actual se asocia con el primer parámetro formal, el segundo con el segundo, y así para el resto. En la notación nombrada usamos el operador <code><span title="Igual y mayor.">=&gt;</span></code> para asociar el parámetro actual al parámetro formal. También podemos usar notación mixta.</p>
<p>Los parámetros pueden ser de <strong>entrada</strong> al subprograma, de <strong>salida</strong>, o de <strong>entrada/salida</strong>. Por defecto si a un parámetro no le especificamos el modo, éste será de entrada. Si el parámetro es de salida o de entrada/salida, el parámetro actual debe ser una variable.</p>
<p>Un parámetro de entrada permite que pasemos valores al subprograma y no puede ser modificado en el cuerpo del subprograma. El parámetro actual pasado a un subprograma como parámetro formal de entrada puede ser una constante o una variable.</p>
<p>Un parámetro de salida permite devolver valores y dentro del subprograma actúa como variable no inicializada. El parámetro formal debe ser siempre una variable.</p>
<p>Un parámetro de entrada-salida se utiliza para pasar valores al subprograma y/o para recibirlos, por lo que un parámetro formal que actúe como parámetro actual de entrada-salida siempre deberá ser una variable.</p>
<p>Los parámetros de entrada los podemos inicializar a un valor por defecto. Si un subprograma tiene un parámetro inicializado con un valor por defecto, podemos invocarlo prescindiendo del parámetro y aceptando el valor por defecto o pasando el parámetro y sobreescribiendo el valor por defecto. Si queremos prescindir de un parámetro colocado entre medias de otros, deberemos usar notación nombrada o si los parámetros restantes también tienen valor por defecto, omitirlos todos.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id78-25">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta78_48" class="block iDevice_content">
<p>En el siguiente enlace puedes encontrar ejemplos sobre el paso de parámetros a nuestros subprogramas.</p>
<p class="enlace_centrado"><a href="#exenode_38_AnexoIVPasodeparmetrosasubprogramas" title="Acceder al anexo donde se muestran ejemplos del paso de parámetros a nuestros subprogramas.">Paso de parámetros a subprogramas.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id80-25">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<div id="actitity-80_55">
<form name="multi-select-form-80_55" action="#" class="activity-form multi-select-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion80_55" class="block question iDevice_content">
<strong>Indica de entre las siguientes afirmaciones las que creas que son correctas.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op80_550" class="sr-av"><a href="#answer-80_58">Opción 1</a></label><input type="checkbox" id="op80_550" value="True" />
</p>
<div class="iDevice_answer-content" id="answer-80_58"><div id="taans80_58" class="block iDevice_content">
En PL/SQL podemos usar la notación posicional para pasar parámetros.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-80_550" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op80_551" class="sr-av"><a href="#answer-80_112">Opción 2</a></label><input type="checkbox" id="op80_551" value="False" />
</p>
<div class="iDevice_answer-content" id="answer-80_112"><div id="taans80_112" class="block iDevice_content">
No existen los parámetros de salida ya que para eso existen las funciones.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-80_551" style="display:none"></section>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op80_552" class="sr-av"><a href="#answer-80_114">Opción 3</a></label><input type="checkbox" id="op80_552" value="True" />
</p>
<div class="iDevice_answer-content" id="answer-80_114"><div id="taans80_114" class="block iDevice_content">
Los parámetros de entrada los podemos inicializar a un valor por defecto.

</div>
</div>
<section class="iDevice_answer-feedback feedback" id="feedback-80_552" style="display:none"></section>
</section>
</section>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-3-80_55" /> 
</p>
</div>
<section id="f80_55" class="js-hidden js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>

<div id="tafeedback80_55" class="feedback iDevice_content">
En PL/SQL podemos usar la notación posicional para pasar parámetros, los parámetros de entrada podemos inicializarlos a un valor por defecto y también podemos utilizar los parámetros de salida.

</div>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-80_58" class="right">Correcto</a></li>
<li><a href="#answer-80_112" class="wrong">Incorrecto</a></li>
<li><a href="#answer-80_114" class="right">Correcto</a></li>
</ol>
</section>
</div>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-26">
<header class="nodeDecoration">
<h1 id="exenode_26_413Sobrecargadesubprogramasyrecursividad" class="nodeTitle">4.1.3.- Sobrecarga de subprogramas y recursividad.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id81-26">
<div class="iDevice emphasis0">
<div id="ta81_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 132px;"><img src="BD06_CONT_R32_Sobrecarga.jpg" alt="Vehículo con muchas maletas sobre el techo." title="Sobrecarga." class="elemento_derecha" width="132" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la Web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p></p>
<p><br />PL/SQL también nos ofrece la posibilidad de sobrecargar funciones o procedimientos, es decir, llamar con el mismo nombre subprogramas que realizan el mismo cometido y que aceptan distinto número y/o tipo de parámetros. No podemos sobrecargar subprogramas que aceptan el mismo número y tipo de parámetros y sólo difieren en el modo. Tampoco podemos sobrecargar subprogramas con el mismo número de parámetros y que los tipos de los parámetros sean diferentes, pero de la misma familia, o sean subtipos basados en la misma familia.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id82-26">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta82_48" class="block iDevice_content">
<p>En el siguiente enlace podrás ver un ejemplo de una función que es sobrecargada tres veces dependiendo del tipo de parámetros que acepta.</p>
<p class="enlace_centrado"><a href="#exenode_39_AnexoVSobrecargadesubprogramas" title="Acceder al anexo donde se muestra un ejemplo de una función sobrecargada tres veces.">Sobrecarga de subprogramas.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id84-26">
<div class="iDevice emphasis0">
<div id="ta84_73" class="block iDevice_content">
<p>PL/SQL también nos ofrece la posibilidad de utilizar la recursividad en nuestros subprogramas. Un subprograma es recursivo si éste se invoca a él mismo.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id85-26">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta85_48" class="block iDevice_content">
<p>En el siguiente enlace podrás ampliar información sobre la recursividad.</p>
<p class="enlace_centrado"><a href="http://es.wikipedia.org/wiki/Recursi%C3%B3n" title="Acceder a un artículo de la wikipedia que trata sobre recursividad." target="_self">Recursividad.</a></p>
<p>En el siguiente enlace podrás ver un ejemplo del uso de la recursividad en nuestros subprogramas.</p>
<p class="enlace_centrado"><a href="#exenode_40_AnexoVIEjemploderecursividad" title="Acceder al anexo donde se muestra un ejemplo del uso de la recursividad en un procedimiento.">Ejemplo del uso de la recursividad.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id87-26">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-87_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion87_60" class="block question iDevice_content">
<strong>En PL/SQL no podemos sobrecargar subprogramas que aceptan el mismo número y tipo de parámetros, pero sólo difieren en el modo.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i87_63" class="sr-av"><a href="#answer-87_63">Opción 1</a></label><input type="radio" name="option87_60" id="i87_63" class="exe-radio-option exe-radio-option-0-2-87_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-87_63"><div id="taans87_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i87_117" class="sr-av"><a href="#answer-87_117">Opción 2</a></label><input type="radio" name="option87_60" id="i87_117" class="exe-radio-option exe-radio-option-1-2-87_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-87_117"><div id="taans87_117" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b87_60" class="feedback js-hidden">
<div id="taf87_63" class=" iDevice_content">
Correcto, veo que lo has entendido.

</div>
</section>
<section id="sa1b87_60" class="feedback js-hidden">
<div id="taf87_117" class=" iDevice_content">
No, no podemos hacerlo.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-87_63">Opción correcta</a><span> (<a href="#sa0b87_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-87_117">Incorrecto</a><span> (<a href="#sa1b87_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-87_120" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion87_120" class="block question iDevice_content">
<strong>En PL/SQL no podemos utilizar la recursión y tenemos que imitarla mediante la iteración.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i87_123" class="sr-av"><a href="#answer-87_123">Opción 1</a></label><input type="radio" name="option87_120" id="i87_123" class="exe-radio-option exe-radio-option-0-2-87_120-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-87_123"><div id="taans87_123" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i87_126" class="sr-av"><a href="#answer-87_126">Opción 2</a></label><input type="radio" name="option87_120" id="i87_126" class="exe-radio-option exe-radio-option-1-2-87_120-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-87_126"><div id="taans87_126" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b87_120" class="feedback js-hidden">
<div id="taf87_123" class=" iDevice_content">
Incorrecto, creo que deberías mirar otra vez el segundo enlace del segundo &quot;Debes conocer&quot;.

</div>
</section>
<section id="sa1b87_120" class="feedback js-hidden">
<div id="taf87_126" class=" iDevice_content">
¡Muy bien!

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-87_123">Incorrecto</a><span> (<a href="#sa0b87_120">Retroalimentación</a>)</span></li>
<li><a href="#answer-87_126">Opción correcta</a><span> (<a href="#sa1b87_120">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-27">
<header class="nodeDecoration">
<h1 id="exenode_27_42Paquetes" class="nodeTitle">4.2.- Paquetes.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id88-27">
<div class="iDevice emphasis0">
<div id="ta88_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 200px;"><img src="BD06_CONT_R32_Paquete.jpg" alt="Paquete envuelto en papel de regalo rojo y con una cinta rosa." title="Paquete." class="elemento_derecha" width="200" height="132" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Acceder a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p>Un paquete es un objeto que agrupa tipos, elementos y subprogramas. Suelen tener dos partes: la especificación y el cuerpo, aunque algunas veces el cuerpo no es necesario.</p>
<p>En la parte de especificación declararemos la interfaz del paquete con nuestra aplicación y en el cuerpo es donde implementaremos esa interfaz.</p>
<p>Para crear un paquete usaremos la siguiente sintaxis:</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE [OR REPLACE] PACKAGE nombre AS
     [declaraciones públicas y especificación  subprogramas]
END [nombre]
CREATE [OR REPLACE] PACKAGE BODY nombre AS
     [declaraciones privadas y cuerpo  subprogramas especificados]
[BEGIN
     sentencias inicialización]
END [nombre];</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">La parte de inicialización sólo se ejecuta una vez, la primera vez que el paquete es referenciado.</span></p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id89-27">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta89_48" class="block iDevice_content">
<p>En el siguiente enlace te mostramos un ejemplo de un paquete que agrupa las principales tareas que realizamos con nuestra base de datos de ejemplo.</p>
<p class="enlace_centrado"><a href="#exenode_41_AnexoVIIEjemplodepaquete" title="Acceder al anexo donde se muestra un ejemplo de un paquete sobre nuestra base de datos de ejemplo.">Ejemplo de paquete.</a></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id91-27">
<div class="iDevice emphasis0">
<div id="ta91_73" class="block iDevice_content">
<p>Para referenciar las partes visibles de un paquete, lo haremos por medio de la notación del punto.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>BEGIN
     ...
     call_center.borra_agente( 10 );
     ...
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
<p> </p>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id92-27">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta92_47" class="block iDevice_content">
<p><span lang="en">Oracle</span> nos suministra varios paquetes para simplificarnos algunas tareas. En el siguiente enlace puedes encontrar más información sobre los mismos.</p>
<p class="enlace_centrado"><a href="http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/toc.htm" title="Acceder a la documentación de Oracle donde puedes ampliar información sobre los paquetes que suministra (se abre en una ventana nueva)." target="_blank" rel="noopener">Paquetes suministrados por <span lang="en">Oracle</span>.</a></p>
</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-28">
<header class="nodeDecoration">
<h1 id="exenode_28_421EjemplosdeutilizacindelpaqueteDBMS_OUTPUT" class="nodeTitle">4.2.1.- Ejemplos de utilización del paquete DBMS_OUTPUT.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id93-28">
<div class="iDevice emphasis0">
<div id="ta93_73" class="block iDevice_content">
<p><span lang="en">Oracle</span> nos suministra un paquete público con el cual podemos enviar mensajes desde subprogramas almacenados, paquetes y disparadores, colocarlos en un <span lang="en">buffer</span> y leerlos desde otros subprogramas almacenados, paquetes o disparadores.</p>
<p><span lang="en">SQL*Plus</span> permite visualizar los mensajes que hay en el <span lang="en">buffer</span>, por medio del comando <code>SET SERVEROUTPUT ON</code>. La utilización fundamental de este paquete es para la depuración de nuestros subprogramas.</p>
<p>Veamos uno a uno los subprogramas que nos suministra este paquete:</p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;">Habilita las llamadas a los demás subprogramas. No es necesario cuando está activada la opción <code>SERVEROUTPUT</code>. Podemos pasarle un parámetro indicando el tamaño del <span lang="en">buffer</span>.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>ENABLE
ENABLE( buffer_size IN INTEGER DEFAULT 2000);</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Deshabilita las llamadas a los demás subprogramas y purga el <span lang="en">buffer</span>. Como con <code>ENABLE</code> no es necesario si estamos usando la opción <code>SERVEROUTPUT</code>.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>DISABLE
DISABLE();</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Coloca elementos en el <span lang="en">buffer</span>, los cuales son convertidos a <code>VARCHAR2</code>.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>PUT
PUT(item IN NUMBER);
PUT(item IN VARCHAR2);
PUT(item IN DATE);</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Coloca elementos en el <span lang="en">buffer</span> y los termina con un salto de línea.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>PUT_LINE
PUT_LINE(item IN NUMBER);
PUT_LINE(item IN VARCHAR2);
PUT_LINE(item IN DATE);</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Coloca un salto de línea en el <span lang="en">buffer</span>. Utilizado cuando componemos una línea usando varios <code>PUT</code>.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>NEW_LINE
NEW_LINE();</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Lee una línea del <span lang="en">buffer</span> colocándola en el parámetro <code>line</code> y obviando el salto de línea. El parámetro <code>status</code> devolverá 0 si nos hemos traído alguna línea y 1 en caso contrario.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>GET_LINE
GET_LINE(line OUT VARCHAR2, status OUT VARCHAR2);</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li>Intenta leer el número de líneas indicado en <code>numlines</code>. Una vez ejecutado, <code>numlines</code> contendrá el número de líneas que se ha traído. Las líneas traídas las coloca en el parámetro <code>lines</code> del tipo <code>CHARARR</code>, tipo definido el paquete <code>DBMS_OUTPUT</code> como una tabla de <code>VARCHAR2(255)</code>.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>GET_LINES
GET_LINES(lines OUT CHARARR, numlines IN OUT INTEGER);</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
</ul>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id94-28">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta94_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b94" class="block iDevice_content">
Debes crear un procedimiento que visualice todos los agentes, su nombre, nombre de la familia y/o nombre de la oficina a la que pertenece.

</section>
<form name="feedback-form-quesFeedback0b94" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b94text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b94" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b94" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE OR  REPLACE PROCEDURE lista_agentes IS
     CURSOR cAgentes IS SELECT identificador, nombre,familia, oficina FROM agentes;
     fam familias.nombre%TYPE;
     ofi oficinas.nombre%TYPE;
     num_ag INTEGER := 0;
BEGIN
     DBMS_OUTPUT.ENABLE( 1000000 );
     DBMS_OUTPUT.PUT_LINE('Agente              |Familia             |Oficina             ');
     DBMS_OUTPUT.PUT_LINE('---------------------------------------------------------------');
     FOR ag_rec IN cAgentes LOOP
          IF (ag_rec.familia IS NOT NULL) THEN
               SELECT nombre INTO fam FROM familias WHERE identificador = ag_rec.familia;
               ofi := NULL;
               DBMS_OUTPUT.PUT_LINE(rpad(ag_rec.nombre,20) || '|' || rpad(fam,20) || '|' || rpad(ofi,20));
               num_ag := num_ag + 1;
          ELSIF (ag_rec.oficina IS NOT NULL) THEN
               SELECT nombre INTO ofi FROM oficinas WHERE identificador = ag_rec.oficina;
               fam := NULL;
               DBMS_OUTPUT.PUT_LINE(rpad(ag_rec.nombre,20) || '|' || rpad(fam,20) || '|' || rpad(ofi,20));
               num_ag := num_ag + 1;
          END IF;
     END LOOP;
DBMS_OUTPUT.PUT_LINE('---------------------------------------------------------------');
     DBMS_OUTPUT.PUT_LINE('Número de agentes: ' || num_ag);
END lista_agentes;
/</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Recuerda que para ejecutarlo desde </span><span lang="en" style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">SQL*Plus</span><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;"> debes ejecutar las siguientes sentencias:</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>SQL&gt;SET SERVEROUTPUT ON;
SQL&gt;EXEC lista_agentes;</code></pre>
</div>
</div>
<pre></pre>
</div>
<p> </p></section>
</form>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-29">
<header class="nodeDecoration">
<h1 id="exenode_29_43Objetos" class="nodeTitle">4.3.- Objetos.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id95-29">
<div class="iDevice emphasis0">
<div id="ta95_73" class="block iDevice_content">
<p>Hoy día, la programación orientada a objetos es uno de los <a href="#t4e2b394b-f687-e78f-8521-ffbe8ebeb3cc" id="link4e2b394b-f687-e78f-8521-ffbe8ebeb3cc" class="exe-tooltip definition-tt titled-tt blue-tt" title="Paradigma | ">paradigmas</a> más utilizados y casi todos los lenguajes de programación la soportan. En este apartado vamos a dar unas pequeñas pinceladas de su uso en PL/SQL que serán ampliados en la siguiente unidad de trabajo.</p>
<p>Un tipo de objeto es un tipo de dato compuesto, que encapsula unos datos y las funciones y procedimientos necesarios para manipular esos datos. Las variables son los atributos y los subprogramas son llamados métodos. Podemos pensar en un tipo de objeto como en una entidad que posee unos atributos y un comportamiento (que viene dado por los métodos).</p>
<ul class="lista_verificacion">
<li>Cuando creamos un tipo de objeto, lo que estamos creando es una entidad abstracta que especifica los atributos que tendrán los objetos de ese tipo y define su comportamiento.</li>
<li>Cuando instanciamos un objeto estamos particularizando la entidad abstracta a una en particular, con los atributos que tiene el tipo de objeto, pero con un valor dado y con el mismo comportamiento.</li>
</ul>
<p>Los tipos de objetos tiene 2 partes: una <strong>especificación</strong> y un <strong>cuerpo</strong>. La parte de especificación declara los atributos y los métodos que harán de interfaz de nuestro tipo de objeto. En el cuerpo se implementa la parte de especificación. En la parte de especificación debemos declarar primero los atributos y después los métodos. Todos los atributos son públicos (visibles). No podemos declarar atributos en el cuerpo, pero sí podemos declarar subprogramas locales que serán visibles en el cuerpo del objeto y que nos ayudarán a implementar nuestros métodos.</p>
<p>Los atributos pueden ser de cualquier tipo de datos <span lang="en">Oracle</span>, excepto:</p>
<ul class="lista_verificacion">
<li><code>LONG</code> y <code>LONG RAW</code>.</li>
<li><code>NCHAR</code>, <code>NCLOB</code> y <code>NVARCHAR2</code>.</li>
<li><code>MLSLABEL</code> y <code>ROWID</code>.</li>
<li>Tipos específicos de PL/SQL: <code>BINARY_INTEGER</code>, <code>BOOLEAN</code>, <code>PLS_INTEGER</code>, <code>RECORD</code>, <code>REF CURSOR</code>, <code>%TYPE</code> y <code>%ROWTYPE</code>.</li>
<li>Tipos definidos dentro de un paquete PL/SQL.</li>
</ul>
<p>No podemos inicializar un atributo en la declaración. Tampoco podemos imponerle la restricción <code>NOT NULL</code>.</p>
<p>Un <strong>método</strong> es un subprograma declarado en la parte de especificación de un tipo de objeto por medio de: <code>MEMBER</code>. Un método no puede llamarse igual que el tipo de objeto o que cualquier atributo. Para cada método en la parte de especificación, debe haber un método implementado en el cuerpo con la misma cabecera.</p>
<p>Todos los métodos en un tipo de objeto aceptan como primer parámetro una instancia de su tipo. Este parámetro es <code>SELF</code> y siempre está accesible a un método. Si lo declaramos explícitamente debe ser el primer parámetro, con el nombre <code>SELF</code> y del tipo del tipo de objeto. Si <code>SELF</code> no está declarado explícitamente, por defecto será <code>IN</code> para las funciones e <code>IN OUT</code> para los procedimientos.</p>
<p>Los métodos dentro de un tipo de objeto pueden sobrecargarse. No podemos sobrecargarlos si los parámetros formales sólo difieren en el modo o pertenecen a la misma familia. Tampoco podremos sobrecargar una función miembro si sólo difiere en el tipo devuelto.</p>
<p>Una vez que tenemos creado el objeto, podemos usarlo en cualquier declaración. Un objeto cuando se declara sigue las mismas reglas de alcance y visibilidad que cualquier otra variable.</p>
<p>Cuando un objeto se declara éste es automáticamente <code>NULL</code>. Dejará de ser nulo cuando lo inicialicemos por medio de su constructor o cuando le asignemos otro. Si intentamos acceder a los atributos de un objeto <code>NULL</code> saltará la excepción <code>ACCES_INTO_NULL</code>.</p>
<p>Todos los objetos tienen constructores por defecto con el mismo nombre que el tipo de objeto y acepta tantos parámetros como atributos del tipo de objeto y con el mismo tipo. PL/SQL no llama implícitamente a los constructores, deberemos hacerlo nosotros explícitamente.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>DECLARE
     familia1 Familia;
BEGIN
     ...
     familia1 := Familia( 10, ‘Fam10’, 1, NULL );
     ...
END;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Un tipo de objeto puede tener a otro tipo de objeto entre sus atributos. El tipo de objeto que hace de atributo debe ser conocido por </span><span lang="en" style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Oracle</span><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">. Si 2 tipos de objetos son mutuamente dependientes, podemos usar una declaración hacia delante para evitar errores de compilación.</span></p>
</div>
<div id="t4e2b394b-f687-e78f-8521-ffbe8ebeb3cc" class="exe-tooltip-text">Un paradigma o modelo de programación es una propuesta tecnológica que es adoptada por una comunidad de programadores cuyo núcleo central es incuestionable en cuanto a que unívocamente trata de resolver uno o varios problemas claramente delimitados. La resolución de estos problemas debe suponer consecuentemente un avance significativo en al menos un parámetro que afecte a la ingeniería de software. Probablemente, el paradigma de programación que actualmente es el más usado a todos los niveles es la orientación a objeto. El núcleo central de este paradigma es la unión de datos y procesamiento en una entidad llamada objeto relacionable a su vez con otras entidades objeto ;
<p></p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id96-29">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta96_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b96" class="block iDevice_content">
Cómo declararías los objetos para nuestra base de datos de ejemplo.

</section>
<form name="feedback-form-quesFeedback0b96" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b96text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b96" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b96" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE OBJECT Oficina;     --Definición hacia delante
CREATE OBJECT Familia AS OBJECT (
     identificador     NUMBER,
     nombre          VARCHAR2(20),
     familia_     Familia,
     oficina_     Oficina,
     ...
);
CREATE OBJECT Agente AS OBJECT (
     identificador     NUMBER,
     nombre          VARCHAR2(20),
     familia_     Familia,
     oficina_     Oficina,
     ...
);
CREATE OBJECT Oficina AS OBJECT (
     identificador     NUMBER,
     nombre          VARCHAR2(20),
     jefe          Agente,
     ...
);</code></pre>
</div>
</div>
<pre><br /><br /></pre></section>
</form>
</div>
</div>
</div>
</article>
</article>
<article class="node level-4-node" id="exe-node-30">
<header class="nodeDecoration">
<h1 id="exenode_30_431ObjetosFuncionesmapayfuncionesdeorden" class="nodeTitle">4.3.1.- Objetos. Funciones mapa y funciones de orden.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id97-30">
<div class="iDevice emphasis0">
<div id="ta97_73" class="block iDevice_content">
<p>En la mayoría de los problemas es necesario hacer comparaciones entre tipos de datos, ordenarlos, etc. Sin embargo, los tipos de objetos no tienen orden predefinido por lo que no podrán ser comparados ni ordenados (<code>x&gt;y</code>, <code>DISTINCT</code>, <code>ORDER BY</code>, ...). Nosotros podemos definir el orden que seguirá un tipo de objeto por medio de las funciones mapa y las funciones de orden.</p>
<p>Una función miembro mapa es una función sin parámetros que devuelve un tipo de dato: <code>DATE</code>, <code>NUMBER</code> o <code>VARCHAR2</code> y sería similar a una función <span lang="en">hash</span>. Se definen anteponiendo la palabra clave <code>MAP</code> y sólo puede haber una para el tipo de objeto.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE TYPE Familia AS OBJECT (
identificador      NUMBER,
nombre           VARCHAR2(20),
familia_          NUMBER,
oficina_          NUMBER,
MAP MEMBER FUNCTION orden RETURN NUMBER,
...
);
     
CREATE TYPE BODY Familia AS
MAP MEMBER FUNCTION orden RETURN NUMBER IS
BEGIN
     RETURN identificador;
END;
...
END;</code></pre>
</div>
</div>
<p><span style="font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 1em;">Una función miembro de orden es una función que acepta un parámetro del mismo tipo del tipo de objeto y que devuelve un número negativo si el objeto pasado es menor, cero si son iguales y un número positivo si el objeto pasado es mayor.</span></p>
</div>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE TYPE Oficina AS OBJECT (
     identificador          NUMBER,
     nombre               VARCHAR2(20),
     ...
     ORDER MEMBER FUNCTION igual ( ofi Oficina ) RETURN INTEGER,
     ...
);
     
CREATE TYPE BODY Oficina AS
     ORDER MEMBER FUNCTION igual ( ofi Oficina ) RETURN INTEGER IS
     BEGIN
          IF (identificador &lt; ofi.identificador) THEN
               RETURN –1;
          ELSIF (identificador = ofi.identificador) THEN
               RETURN 0;
          ELSE
               RETURN 1;
          END IF;
     END;
     ...
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id98-30">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-98_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion98_60" class="block question iDevice_content">
<strong>Los métodos de un objeto sólo pueden ser procedimientos.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i98_63" class="sr-av"><a href="#answer-98_63">Opción 1</a></label><input type="radio" name="option98_60" id="i98_63" class="exe-radio-option exe-radio-option-0-2-98_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-98_63"><div id="taans98_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i98_133" class="sr-av"><a href="#answer-98_133">Opción 2</a></label><input type="radio" name="option98_60" id="i98_133" class="exe-radio-option exe-radio-option-1-2-98_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-98_133"><div id="taans98_133" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b98_60" class="feedback js-hidden">
<div id="taf98_63" class=" iDevice_content">
Incorrecto, creo que deberías dar un repaso a este apartado.

</div>
</section>
<section id="sa1b98_60" class="feedback js-hidden">
<div id="taf98_133" class=" iDevice_content">
Efectivamente, ya que las funciones también pueden ser métodos.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-98_63">Incorrecto</a><span> (<a href="#sa0b98_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-98_133">Opción correcta</a><span> (<a href="#sa1b98_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-98_136" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion98_136" class="block question iDevice_content">
<strong>El orden de un objeto se consigue:</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i98_139" class="sr-av"><a href="#answer-98_139">Opción 1</a></label><input type="radio" name="option98_136" id="i98_139" class="exe-radio-option exe-radio-option-0-3-98_136-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-98_139"><div id="taans98_139" class="block iDevice_content">
Al crearlo.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i98_142" class="sr-av"><a href="#answer-98_142">Opción 2</a></label><input type="radio" name="option98_136" id="i98_142" class="exe-radio-option exe-radio-option-1-3-98_136-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-98_142"><div id="taans98_142" class="block iDevice_content">
En PL/SQL los objetos no pueden ser ordenados.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i98_151" class="sr-av"><a href="#answer-98_151">Opción 3</a></label><input type="radio" name="option98_136" id="i98_151" class="exe-radio-option exe-radio-option-2-3-98_136-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-98_151"><div id="taans98_151" class="block iDevice_content">
Mediante las funciones mapa y las funciones de orden.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b98_136" class="feedback js-hidden">
<div id="taf98_139" class=" iDevice_content">
No, los objetos no tienen ningún orden predefinido.

</div>
</section>
<section id="sa1b98_136" class="feedback js-hidden">
<div id="taf98_142" class=" iDevice_content">
No es cierto, el orden lo podemos conseguir mediante el uso de funciones mapa y funciones de orden.

</div>
</section>
<section id="sa2b98_136" class="feedback js-hidden">
<div id="taf98_151" class=" iDevice_content">
¡Muy bien!

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-98_139">Incorrecto</a><span> (<a href="#sa0b98_136">Retroalimentación</a>)</span></li>
<li><a href="#answer-98_142">Incorrecto</a><span> (<a href="#sa1b98_136">Retroalimentación</a>)</span></li>
<li><a href="#answer-98_151">Opción correcta</a><span> (<a href="#sa2b98_136">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-31">
<header class="nodeDecoration">
<h1 id="exenode_31_5Disparadores" class="nodeTitle">5.- Disparadores.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id99-31">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta99_66" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 132px;"><img src="BD06_CONT_R40_Clave.jpg" alt="Ilustración en la que se representa un chico rodeado de muchas columnas y una tira de papel con algún texto se extiende por entre todas las columnas." title="Clave." class="elemento_derecha" width="132" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Accede a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE (Loren)</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p><strong>Juan</strong> y <strong>María</strong> ya han hecho un paquete en el que tienen agrupadas las funciones más usuales que realizan sobre la base de datos de juegos <span lang="en">on-line</span>. Sin embargo, <strong>María</strong> ve que hay cosas que aún no pueden controlar. Por ejemplo, <strong>María</strong> quiere que la clave y el usuario de un jugador o jugadora no puedan ser la misma y eso no sabe cómo hacerlo. <strong>Juan</strong> le dice que para ese cometido están los disparadores y sin más dilaciones se pone a explicarle a <strong>María</strong> para qué sirven y cómo utilizarlos.</p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id102-31">
<div class="iDevice emphasis0">
<div id="ta102_73" class="block iDevice_content">
<p>En este apartado vamos a tratar una herramienta muy potente e importante proporcionada por PL/SQL para programar nuestra base de datos y mantener la integridad y seguridad que son los disparadores o <span lang="en">triggers</span> en inglés.</p>
<p>Pero, ¿qué es un disparador?</p>
<p>Un<strong> disparador</strong> no es más que un procedimiento que es ejecutado cuando se realiza alguna sentencia sobre la BD,  o sus tablas, y bajo unas circunstancias establecidas a la hora de definirlo.</p>
<p>Los disparadores pueden ser de tres tipos:</p>
<ul>
<li class="lista_verificacion"><strong>De tablas</strong></li>
<li class="lista_verificacion"><strong>De sustitución </strong></li>
<li class="lista_verificacion"><strong>De sistema</strong></li>
</ul>
<p>Un disparador puede ser lanzado antes o después de realizar la operación que lo lanza. Por lo que tendremos disparadores <code>BEFORE</code> y disparadores <code>AFTER</code>.</p>
<p><span style="text-decoration: underline;"><strong>Disparadores de Tablas</strong></span></p>
<p>Normalmente previenen transacciones erróneas o nos permiten implementar restricciones de integridad o seguridad, o automatizar procesos. Son los más utilizados. </p>
<p>Se ejecutan cuando se realiza alguna sentencia de manipulación de datos sobre una tabla dada. Puede ser lanzado al insertar, al actualizar o al borrar de una tabla, por lo que tendremos disparadores <code>INSERT</code>, <code>UPDATE</code> o <code>DELETE</code> (o mezclados).</p>
<p>Puede ser lanzado una vez por sentencia (<code><span>FOR STATEMENT</span></code>) o una vez por cada fila a la que afecta (<code><span>FOR EACH ROW</span></code>). Por lo que tendremos disparadores de sentencia y disparadores de fila.</p>
<p><span style="text-decoration: underline;"><strong>De sustitución</strong></span></p>
<p>No se ejecutan ni antes ni después, sino en lugar de (se conocen como triggers INSTEAD OF). Sólo se pueden asociar a vistas y a nivel de fila.</p>
<p><span style="text-decoration: underline;"><strong>De sistema</strong></span></p>
<p>Se ejecutan cuando se produce una determinada operación sobre la BD, se crea una tabla, se conecta un usuario, etc. Los eventos que se pueden detectar son por ejemplo: LOGON, LOGOFF, CREATE, DROP, etc y el momento puede ser tanto<span> </span><code>BEFORE</code><span> </span><span> </span>como<span> </span><code>AFTER</code>.</p>
<p></p>
<p>Un<strong> disparador</strong> no es más que un procedimiento y  puede ser usado para:</p>
<ul class="lista_verificacion">
<li>Llevar a cabo auditorías sobre la historia de los datos en nuestra base de datos.</li>
<li>Garantizar complejas reglas de integridad.</li>
<li>Automatizar la generación de valores derivados de columnas.</li>
<li>Etc.</li>
</ul>
<p>Cuando diseñamos un disparador debemos tener en cuenta que:</p>
<ul class="lista_verificacion">
<li>No debemos definir disparadores que dupliquen la funcionalidad que ya incorpora <span lang="en">Oracle</span>.</li>
<li>Debemos limitar el tamaño de nuestros disparadores, y si estos son muy grandes codificarlos por medio de subprogramas que sean llamados desde el disparador.</li>
<li>Cuidar la creación de disparadores recursivos.</li>
</ul>
<p></p>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id103-31">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-103_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion103_60" class="block question iDevice_content">
<strong>En PL/SQL sólo podemos definir disparadores de fila.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i103_63" class="sr-av"><a href="#answer-103_63">Opción 1</a></label><input type="radio" name="option103_60" id="i103_63" class="exe-radio-option exe-radio-option-0-2-103_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-103_63"><div id="taans103_63" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i103_155" class="sr-av"><a href="#answer-103_155">Opción 2</a></label><input type="radio" name="option103_60" id="i103_155" class="exe-radio-option exe-radio-option-1-2-103_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-103_155"><div id="taans103_155" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b103_60" class="feedback js-hidden">
<div id="taf103_63" class=" iDevice_content">
No, también podemos definir disparadores de sentencia.

</div>
</section>
<section id="sa1b103_60" class="feedback js-hidden">
<div id="taf103_155" class=" iDevice_content">
Efectivamente, ya que también podemos definir disparador de sentencia.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-103_63">Incorrecto</a><span> (<a href="#sa0b103_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-103_155">Opción correcta</a><span> (<a href="#sa1b103_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
<br/><section class="question">
<form name="multi-choice-form-103_158" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion103_158" class="block question iDevice_content">
<strong>La diferente entre un disparador de fila y uno de sentencia es que el de fila es lanzado una vez por fila a la que afecta la sentencia y el de sentencia es lanzado una sola vez.</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i103_161" class="sr-av"><a href="#answer-103_161">Opción 1</a></label><input type="radio" name="option103_158" id="i103_161" class="exe-radio-option exe-radio-option-0-2-103_158-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-103_161"><div id="taans103_161" class="block iDevice_content">
Verdadero.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i103_164" class="sr-av"><a href="#answer-103_164">Opción 2</a></label><input type="radio" name="option103_158" id="i103_164" class="exe-radio-option exe-radio-option-1-2-103_158-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-103_164"><div id="taans103_164" class="block iDevice_content">
Falso.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b103_158" class="feedback js-hidden">
<div id="taf103_161" class=" iDevice_content">
Muy bien, vas por buen camino.

</div>
</section>
<section id="sa1b103_158" class="feedback js-hidden">
<div id="taf103_164" class=" iDevice_content">
Incorrecto, creo que deberías repasar este apartado otra vez.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-103_161">Opción correcta</a><span> (<a href="#sa0b103_158">Retroalimentación</a>)</span></li>
<li><a href="#answer-103_164">Incorrecto</a><span> (<a href="#sa1b103_158">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-32">
<header class="nodeDecoration">
<h1 id="exenode_32_51DefinicindedisparadoresdeTablas" class="nodeTitle">5.1.- Definición de disparadores de Tablas</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id104-32">
<div class="iDevice emphasis0">
<div id="ta104_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 132px;"><img src="BD06_CONT_R41_Disparar.jpg" alt="Ilustración en la que se ven dos chicos, un cañón y se puede leer “Bang!”." title="Disparar." class="elemento_derecha" width="132" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Acceder a la eb de INTEF (se abre en una ventana nueva)" rel="noopener">ITE (Loren)</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><span>De los tres tipos de disparadores, veremos los asociados a tablas.</span></p>
<p>Por lo visto anteriormente, para definir un disparador deberemos indicar si será lanzado antes o después de la ejecución de la sentencia que lo lanza, si se lanzará una vez por sentencia o una vez por fila a la que afecta, y si será lanzado al insertar y/o al actualizar y/o al borrar.</p>
<p>La sintaxis que seguiremos para definir un disparador será la siguiente:</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE [OR REPLACE] TRIGGER nombre 
momento acontecimiento ON tabla
[[REFERENCING (old AS alias_old|new AS alias_new) 
FOR EACH ROW 
[WHEN condicion]]
bloque_PL/SQL;</code></pre>
</div>
</div>
<pre></pre>
</div>
<p>Donde nombre nos indica el <code>nombre</code> que le damos al disparador, <code>momento</code> nos dice cuando será lanzado el disparador (<code>BEFORE</code> o <code>AFTER</code>), <code>acontecimiento</code> será la acción que provoca el lanzamiento del disparador (<code>INSERT</code> y/o <code>DELETE</code> y/o <code>UPDATE</code>). <code>REFERENCING</code> y <code>WHEN</code> sólo podrán ser utilizados con disparadores para filas. <code>REFERENCING</code> nos permite asignar un alias a los valores <code>NEW</code> o/y <code>OLD</code> de las filas afectadas por la operación, y <code>WHEN</code> nos permite indicar al disparador que sólo sea lanzado cuando sea <code>TRUE</code> una cierta condición evaluada para cada fila afectada.</p>
<p>En un disparador de fila, podemos acceder a los valores antiguos y nuevos de la fila afectada por la operación, referenciados como <code>:old</code> y <code>:new</code> (de ahí que podamos utilizar la opción <code>REFERENCING</code> para asignar un alias). Si el disparador es lanzado al insertar, el valor antiguo no tendrá sentido y el valor nuevo será la fila que estamos insertando. Para un disparador lanzado al actualizar el valor antiguo contendrá la fila antes de actualizar y el valor nuevo contendrá la fila que vamos actualizar. Para un disparador lanzado al borrar sólo tendrá sentido el valor antiguo.</p>
<p>En el cuerpo de un disparador también podemos acceder a unos predicados que nos dicen qué tipo de operación se está llevando a cabo, que son: <code>INSERTING</code>, <code>UPDATING</code> y <code>DELETING</code>.</p>
<p>Un disparador de fila no puede acceder a la tabla asociada. Se dice que esa tabla está mutando. Si un disparador es lanzado en cascada por otro disparador, éste no podrá acceder a ninguna de las tablas asociadas, y así recursivamente.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE TRIGGER prueba BEFORE UPDATE ON agentes
FOR EACH ROW
BEGIN
     ...
     SELECT identificador FROM agentes WHERE ...     
/*devolvería el error ORA-04091: table AGENTES is mutating, trigger/function may not see it*/
     ...
END;
/</code></pre>
</div>
</div>
<pre></pre>
</div>
<p>Si tenemos varios tipos de disparadores sobre una misma tabla, el orden de ejecución será:</p>
<ul class="lista_verificacion">
<li><span lang="en">Triggers before</span> de sentencia.</li>
<li><span lang="en">Triggers before</span> de fila.</li>
<li><span lang="en">Triggers after</span> de fila.</li>
<li><span lang="en">Triggers after</span> de sentencia.</li>
</ul>
<p>Existe una vista del diccionario de datos con información sobre los disparadores: <code>USER_TRIGGERS</code>;</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>SQL&gt;DESC USER_TRIGGERS;
Name                            Null?    Type
------------------------------- -------- ----
TRIGGER_NAME                    NOT NULL VARCHAR2(30)
TRIGGER_TYPE                             VARCHAR2(16)
TRIGGERING_EVENT                         VARCHAR2(26)
TABLE_OWNER                     NOT NULL VARCHAR2(30)
TABLE_NAME                      NOT NULL VARCHAR2(30)
REFERENCING_NAMES                        VARCHAR2(87)
WHEN_CLAUSE                              VARCHAR2(4000)
STATUS                                   VARCHAR2(8)
DESCRIPTION                              VARCHAR2(4000)
TRIGGER_BODY                             LONG</code></pre>
</div>
</div>
<pre></pre>
</div>
</div>
</div>
</article>
</article>
<article class="node level-3-node" id="exe-node-33">
<header class="nodeDecoration">
<h1 id="exenode_33_52Ejemplosdedisparadores" class="nodeTitle">5.2.- Ejemplos de disparadores.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id105-33">
<div class="iDevice emphasis0">
<div id="ta105_73" class="block iDevice_content">
<p>Ya hemos visto qué son los disparadores, los tipos que existen, cómo definirlos y algunas consideraciones a tener en cuenta a la hora de trabajar con ellos.</p>
<p>Ahora vamos a ver algunos ejemplos de su utilización con los que podremos comprobar la potencia que éstos nos ofrecen.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id106-33">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta106_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b106" class="block iDevice_content">
<p>Como un agente debe pertenecer a una familia o una oficina pero no puede pertenecer a una familia y a una oficina a la vez, deberemos implementar un disparador para llevar a cabo esta restricción que <span lang="en">Oracle</span> no nos permite definir desde el DDL.</p>
</section>
<form name="feedback-form-quesFeedback0b106" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b106text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b106" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b106" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<p>Para este cometido definiremos un disparador de fila que saltará antes de que insertemos o actualicemos una fila en la tabla agentes, cuyo código podría ser el siguiente:</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE OR REPLACE TRIGGER integridad_agentes
BEFORE INSERT OR UPDATE ON agentes
FOR EACH ROW
BEGIN
     IF (:new.familia IS NULL and :new.oficina IS NULL) THEN -- Si los dos valores son nulos
          RAISE_APPLICATION_ERROR(-20201, 'Un agente no puede ser huérfano');-- Lanzauna excepción
     ELSIF (:new.familia IS NOT NULL and :new.oficina IS NOT NULL) THEN -- Si los dos tienen valores
          RAISE_APPLICATION_ERROR(-20202, 'Un agente no puede tener dos padres');
     END IF;
END;
/</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
<p> </p></section>
</form>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id107-33">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header" style="background-image:url(icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta107_48" class="block iDevice_content">
<p>En la siguiente presentación podrás ver la descripción de la tabla <code>USER_TRIGGERS</code>, cómo se almacena un disparador en la base de datos, cómo se consulta su código y cómo se lanza su ejecución. Pruébalo en tu máquina para comprobar su funcionamiento.</p>
<div class="elemento_centrado">
<div class="elemento_centrado"><a href="BD06_CONT_R43_Disparadores.odp" title="Presentación sobre disparadores [odp - 296,81 KB]">Presentación sobre disparadores. Creación,  consulta de su código y lanzamiento con una sentencia insert</a><span class="exe-link-data file-size"> (odp - 296,81 <abbr title="KiloBytes" lang="en">KB</abbr>)</span></div>
<div class="credenciales elemento_centrado"><a href="BD06_Descripcion_Presentacion_Disparadores.html" title="Resumen textual alternativo para &quot;disparadores&quot;.">Resumen textual alternativo</a></div>
</div>
<p> </p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id108-33">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta108_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b108" class="block iDevice_content">
Supongamos que tenemos una tabla de históricos para agentes que nos permita auditar las familias y oficinas por la que ha ido pasando un agente. La tabla tiene la fecha de inicio y la fecha de finalización del agente en esa familia u oficina, el identificador del agente, el nombre del agente, el nombre de la familia y el nombre de la oficina. Queremos hacer un disparador que inserte en esa tabla.

</section>
<form name="feedback-form-quesFeedback0b108" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b108text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b108" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b108" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<p>Para llevar a cabo esta tarea definiremos un disparador de fila que saltará después de insertar, actualizar o borrar una fila en la tabla agentes, cuyo código podría ser el siguiente:</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE OR REPLACE TRIGGER historico_agentes
AFTER INSERT OR UPDATE OR DELETE ON agentes
FOR EACH ROW
DECLARE
     oficina VARCHAR2(40);
     familia VARCHAR2(40);
     ahora DATE := sysdate;
BEGIN
     IF INSERTING THEN
          IF (:new.familia IS NOT NULL) THEN
               SELECT nombre INTO familia FROM familias WHERE identificador = :new.familia;
               oficina := NULL;
          ELSIF
               SELECT nombre INTO oficina FROM oficinas WHERE identificador = :new.oficina;
               familia := NULL;
          END IF;
          INSERT INTO histagentes VALUES (ahora, NULL, :new.identificador, :new.nombre, familia, oficina);
          COMMIT;
     ELSIF UPDATING THEN
          UPDATE histagentes SET fecha_hasta = ahora WHERE identificador = :old.identificador and fecha_hasta IS NULL;
          IF (:new.familia IS NOT NULL) THEN
               SELECT nombre INTO familia FROM familias WHERE identificador = :new.familia;
               oficina := NULL;
          ELSE
               SELECT nombre INTO oficina FROM oficinas WHERE identificador = :new.oficina;
               familia := NULL;
          END IF;
          INSERT INTO histagentes VALUES (ahora, NULL, :new.identificador, :new.identificador, familia, oficina);
          COMMIT;
     ELSE
          UPDATE histagentes SET fecha_hasta = ahora WHERE identificador = :old.identificador and fecha_hasta IS NULL;
          COMMIT;
     END IF;
END;
/</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
<p> </p></section>
</form>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id109-33">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio resuelto</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta109_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b109" class="block iDevice_content">
Queremos realizar un disparador que no nos permita llevar a cabo operaciones con familias si no estamos en la jornada laboral.

</section>
<form name="feedback-form-quesFeedback0b109" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b109text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b109" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b109" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE OR REPLACE TRIGGER jornada_familias
BEFORE INSERT OR DELETE OR UPDATE ON familias
DECLARE
     ahora DATE := sysdate;
BEGIN
     IF (TO_CHAR(ahora, 'DY') = 'SAT' OR TO_CHAR(ahora, 'DY') = 'SUN') THEN
          RAISE_APPLICATION_ERROR(-20301, 'No podemos manipular familias en fines de semana');
     END IF;
     IF (TO_CHAR(ahora, 'HH24') &lt; 8 OR TO_CHAR(ahora, 'HH24') &gt; 18) THEN
          RAISE_APPLICATION_ERROR(-20302, 'No podemos manipular familias fuera del horario de trabajo');
     END IF;
END;
/</code></pre>
</div>
</div>
<pre><br /><br /></pre></section>
</form>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-34">
<header class="nodeDecoration">
<h1 id="exenode_34_6Interfacesdeprogramacindeaplicacionesparalenguajesexternos" class="nodeTitle">6.- Interfaces de programación de aplicaciones para lenguajes externos.</h1>
</header>
<article class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id110-34">
<div class="iDevice emphasis_casopracticofpd" >
<header class="iDevice_header" style="background-image:url(icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta110_66" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-custom" style="width: 136px;"><img src="BD06_CONT_R44_Duda.jpg" alt="Dibujo en el que se representa un chico con un bocadillo en el que se puede leer un signo de interrogación." title="Duda." class="elemento_derecha" width="136" height="200" />
<figcaption class="figcaption"><a href="https://intef.es/" target="_blank" class="author" title="Acceder a la web de INTEF (se abre en una ventana nueva)" rel="noopener">ITE (Abraham Pérez Pérez)</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
<p><br /><br /></p>
<p><strong>Juan</strong> y <strong>María</strong> tienen la base de datos de juegos <span lang="en">on-line</span> lista, pero no tienen claro si todo lo que han hecho lo tienen que utilizar desde dentro de la base de datos o si pueden reutilizar todo ese trabajo desde otro lenguaje de programación desde el que están creando la interfaz web desde la que los jugadores y jugadoras se conectarán para jugar y desde la que también se conectará la administradora para gestionar la base de datos de una forma más amigable.</p>
<p>En ese momento pasa <strong>Ada</strong> al lado y ambos la asaltan con su gran duda. <strong>Ada</strong>, muy segura, les responde que para eso existen las interfaces de programación de aplicaciones o <acronym lang="en" title="Application Programming Interface."><a href="#t35c0310c-49a5-8a05-e39c-6b1f40bb3970" id="link35c0310c-49a5-8a05-e39c-6b1f40bb3970" class="exe-tooltip definition-tt titled-tt blue-tt" title=" API | ">API</a>s</acronym>, que les permiten acceder desde otros lenguajes de programación a la base de datos.</p>
<div id="t35c0310c-49a5-8a05-e39c-6b1f40bb3970" class="exe-tooltip-text">
<p>La interfaz de programación de aplicaciones, conocida también por la sigla API, en inglés, application programming interface,1​ es un conjunto de subrutinas, funciones y procedimientos (o métodos, en la programación orientada a objetos) que ofrece cierta biblioteca para ser utilizado por otro software como una capa de abstracción.</p>
</div>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id111-34">
<div class="iDevice emphasis0">
<div id="ta111_73" class="block iDevice_content">
<p>
Llegados a este punto ya sabemos programar nuestra base de datos, pero al igual que a <strong>Juan</strong> y <strong>María</strong> te surgirá la duda de si todo lo que has hecho puedes aprovecharlo desde cualquier otro lenguaje de programación. La respuesta es la misma que dio <strong>Ada</strong>: SÍ.
</p>
<p>
En este apartado te vamos a dar algunas referencias sobre las APIs para acceder a las bases de datos desde un lenguaje de programación externo. No vamos a ser exhaustivos ya que eso queda fuera del alcance de esta unidad e incluso de este módulo. Todo ello lo vas a estudiar con mucha más profundidad en otros módulos de este ciclo (o incluso ya lo conoces). Aquí sólo pretendemos que sepas que existen y que las puedes utilizar.
</p>
<p>
Las primeras APIs utilizadas para acceder a bases de datos <span lang="en">Oracle</span> fueron las que el mismo <span lang="en">Oracle</span> proporcionaba: <span lang="en">Pro*C</span>, <span lang="en">Pro*Fortran</span> y <span lang="en">Pro*Cobol</span>. Todas permitían embeber llamadas a la base de datos en nuestro programa y a la hora de compilarlo, primero debíamos pasar el precompilador adecuado que trasladaba esas llamadas embebidas en llamadas a una librería utilizada en tiempo de ejecución. Sin duda, el más utilizado fue <span lang="en">Pro*C</span>, ya que el lenguaje C y C++ tuvieron un gran auge.
</p>

</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id112-34">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta112_47" class="block iDevice_content">
<p>
En los siguientes enlaces podrás obtener más información sobre <span lang="en">Pro*C</span> y cómo crear un programa para acceder a nuestra base de datos.
</p>
<p class="enlace_centrado">
<a href="http://infolab.stanford.edu/~ullman/fcdb/oracle/or-proc.html" title="Acceder a un artículo en el que se introduce Pro*C." target="_self">Introducción a <span lang="en">Pro*C</span>.</a>
</p>
<p class="enlace_centrado">
<a href="http://www.helloworldexample.net/pro-c-hello-world-example.html" title="Acceder a un artículo que muestra un ejemplo de programa utilizando Pro*C." target="_self">Ejemplo de programa en <span lang="en">Pro*C</span>.</a>
</p>

</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id113-34">
<div class="iDevice emphasis0">
<div id="ta113_73" class="block iDevice_content">
Hoy día existen muchas más APIs para acceder a las bases de datos ya que tanto los lenguajes de programación como las tecnologías han evolucionado mucho. Antes la programación para la web casi no existía y por eso todos los programas que accedían a bases de datos lo hacían bien en local o bien a través de una red local. Hoy día eso sería impensable, de ahí que las APIs también hayan evolucionado mucho y tengamos una gran oferta a nuestro alcance para elegir la que más se adecue a nuestra necesidades.

</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id114-34">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header" style="background-image:url(icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta114_47" class="block iDevice_content">
<p>En los siguientes enlaces podrás ampliar información sobre algunas APIs muy comunes para acceder a bases de datos.</p>
<p class="enlace_centrado"><a href="http://www.oracle.com/technetwork/java/javase/tech/index-jsp-136101.html" title="Acceder a un artículo sobre las tecnologías que nos ofrece Oracle para acceder a bases de datos desde Java (en inglés)." target="_self">Tecnologías Java para acceder a bases de datos.</a></p>
<p class="enlace_centrado"><a href="http://en.wikipedia.org/wiki/ODBC" title="Acceder a un artículo que explica qué es ODBC (en inglés)." target="_self">Conectividad abierta de bases de datos. (ODBC)</a></p>
<p class="enlace_centrado"></p>
</div>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-35">
<header class="nodeDecoration">
<h1 id="exenode_35_AnexoICasodeestudio" class="nodeTitle">Anexo I.- Caso de estudio.</h1>
</header>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id4-35">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta4_70" class="block iDevice_content">
<p><a name="anexo_i_caso_de_estudio.html" title="anexo_i_caso_de_estudio.html"></a></p>
<p>Una empresa de telefonía tiene sus centros de llamadas distribuidos por la geografía española en diferentes oficinas. Estas oficinas están jerarquizadas en familias de agentes telefónicos. Cada familia, por tanto, podrá contener agentes u otras familias. Los agentes telefónicos, según su categoría, además se encargarán de supervisar el trabajo de todos los agentes de una oficina o de coordinar el trabajo de los agentes de una familia dada. El único agente que pertenecerá directamente a una oficina y que no formará parte de ninguna familia será el supervisor de dicha oficina, cuya categoría es la 2. Los coordinadores de las familias deben pertenecer a dicha familia y su categoría será 1 (no todas las familias tienen por qué tener un coordinador y dependerá del tamaño de la oficina, ya que de ese trabajo también se puede encargar el supervisor de la oficina). Los demás agentes deberán pertenecer a una familia, su categoría será 0 y serán los que principalmente se ocupen de atender las llamadas.</p>
<ul class="lista_verificacion">
<li>De los agentes queremos conocer su nombre, su clave y contraseña para entrar al sistema, su categoría y su habilidad que será un número entre 0 y 9 indicando su habilidad para atender llamadas.</li>
<li>Para las familias sólo nos interesa conocer su nombre.</li>
<li>Finalmente, para las oficinas queremos saber su nombre, domicilio, localidad y código postal de la misma.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id5-35">
<div class="iDevice emphasis0">
<div id="ta5_73" class="block iDevice_content">
<p>Un posible modelo entidad-relación para el problema expuesto podría ser el siguiente:</p>
<div class="elemento_centrado">
<div class="elemento_centrado">
<figure class="exe-figure exe-image position-center license-custom" style="width: 300px;"><a href="BD06_AUXR01_R01_ER_CallCenter_new.jpeg" title="Ampliar imagen." rel="lightbox"><img src="BD06_AUXR01_R01_ER_CallCenter_new.jpeg" alt="Modelo Entidad-relación del caso de estudio en el que se puede ver que hay tres entidades (con sus atributos): Oficinas (identificador que es clave primaria, nombre, dirección, código postal y localidad), Agentes (identificador que es clave primaria, nombre, clave, usuario, habilidad y categoría) y Familias (identificador que es clave primaria y nombre). Las oficinas está relacionadas con una relación de 1 a n con agentes y familias. Las familias están también relacionadas con una relación de 1 a n con agentes y con familias." title="Modelo Entidad-relación del caso de estudio. Pulsar para ampliar" class="imagen_ampliable" width="300" height="169" style="width: 200px; height: 132px;" /></a>
<figcaption class="figcaption"><a href="https://www.educacionyfp.gob.es/portada.html" target="_blank" class="author" title="Acceder a la Web del Ministerio de Educación y FP (se abre en una ventana nueva)" rel="noopener">Ministerio de Educación</a> <span class="license"><span class="sep">(</span><span class="custom-license">Uso educativo nc</span><span class="sep">)</span></span></figcaption>
</figure>
</div>
</div>
<p id="yui_3_17_2_1_1597827085286_131">El<span> </span><span><strong>Modelo Relacional</strong> </span>resultante sería:</p>
<p>OFICINAS (<span style="text-decoration: underline;">identificador</span>, nombre, domicilio, localidad, codigo_postal)</p>
<p>FAMILIAS (<span style="text-decoration: underline;">identificador</span>, nombre, familia (fk), oficina (fk))</p>
<p>AGENTES (<span style="text-decoration: underline;">identificador</span>, nombre, usuario, clave, habilidad, categoría, familia (fk), oficina (fk))</p>
<p>De este modelo de datos surgen tres tablas, que puedes crear en <span lang="en">Oracle</span> con el script del siguiente enlace</p>
<p style="text-align: center;"><a href="CreaCasoEstudio.zip" title="Descarga ZIP con script sql para crear usuario, tablas y cargar datos [zip - 1,62 KB]">Script CreaCasoEstudio.zip</a><span class="exe-link-data file-size"> (zip - 1,62 <abbr title="KiloBytes" lang="en">KB</abbr>)</span></p>
<p>El script crea un usuario llamado c##agencia con clave agencia. Para que puedas ejecutarlo y comenzar de cero, cuantas veces quieras, el script elimina el usuario c##agencia y sus tablas antes de volver a crearlo.</p>
<p>Conecta como administrador con SYS as SYSDBA y ejecútalo anteponiendo el símbolo @ o la palabra start antes del nombre del script.</p>
<figure class="exe-figure exe-image position-center license-copyright" style="width: 300px;"><a href="BD06_ANEXOI_EJECUSCRIPT.JPG" rel="lightbox" title="Ejecución script ampliado"><img src="BD06_ANEXOI_EJECUSCRIPT.JPG" alt="Captura de pantalla de ejecución del script desde SQLPLus" title="Ejecución script en SQLPlus. Pulsar para ampliar" width="300" height="298" /></a>
<figcaption class="figcaption"><a href="https://www.oracle.com/es/index.html" target="_blank" class="author" rel="noopener">Oracle Corporation</a> <span class="license"><span class="sep">(</span><span>Todos los derechos reservados</span><span class="sep">)</span></span></figcaption>
</figure>
<h6><span><span 0="" face="quot" 9375rem=""><span size="6"><b><span color="#2a3744">Habilitando la Salida/OUTPUT en Bloques PL/SQL.</span></b></span></span></span></h6>
<p align="justify"><span><span 0="" face="quot" 9375rem=""><span color="#2a3744"><i><b> PL/SQL</b></i> no proporciona funcionalidad de entrada o salida directamente siendo necesario utilizar paquetes predefinidos de <i><b>Oracle </b></i>para tales fines. Para generar una salida debes realizar lo siguiente :</span></span></span></p>
<p align="justify"><span><span face="quot"><span color="#2a3744"><i><b>1. </b></i>Ejecutar el siguiente comando tanto en <i><b>SQL*Plus </b></i>como en cualquier otro entorno</span></span></span></p>
<p align="justify"><span><span face="quot"><span color="#2a3744"><span color="#0000ff"><i><b>                       </b></i></span></span></span></span><span><code class="western"><span color="#dd1144"><span face="Monaco, Menlo, Consolas, quot"><span size="2"><b><span color="#2a3744">SET </span></b></span></span></span></code><span color="#dd1144"><code class="western"><span face="Monaco, Menlo, Consolas, quot"><span size="2">SERVEROUTPUT </span></span></code><code class="western"><span face="Monaco, Menlo, Consolas, quot"><span size="2"><b>ON</b></span></span></code></span></span></p>
<p align="justify"><span><span face="quot"><span color="#2a3744"><i><b>2.</b></i> En el bloque <i><b>PL/SQL</b></i>, hay que utilizar el procedimiento <i><code>PUT_LINE</code> </i>del paquete <i><code>DBMS_OUTPUT</code> </i>para mostrar la salida. El valor a mostrar en pantalla se pasará como argumento del procedimiento.</span></span></span></p>
<p align="justify"><span><span face="quot"><span color="#2a3744">Ejecuta el siguiente código desde SQLPlus y desde SQLDeveloper para comprobar su funcionamiento.</span></span></span></p>
<div class="highlighted-code code-style-2 language-pascal">
<div>
<pre><code>SET SERVEROUTPUT ON
BEGIN
    DBMS_OUTPUT.PUT_LINE('Hola mundo');
END;
</code></pre>
</div>
</div>
<p align="justify"><span><span face="arial, helvetica, sans-serif"><span size="4"><code class="western"><span color="#dd1144"><span face="Monaco, Menlo, Consolas, quot"><span size="2"><span color="#dc143c"> </span></span></span></span></code></span></span></span></p>
<p style="text-align: justify;"></p>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-36">
<header class="nodeDecoration">
<h1 id="exenode_36_AnexoIIExcepcionespredefinidasenOracle" class="nodeTitle">Anexo II.- Excepciones predefinidas en Oracle.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id35-36">
<div class="iDevice emphasis0">
<div id="ta35_73" class="block iDevice_content">
<a name="anexo_ii_excepciones_predefinidas_en_oracle.html" title="anexo_ii_excepciones_predefinidas_en_oracle.html"></a>
<p>
Las excepciones predefinidas son:
</p>
<table class="tabla" summary="Tabla en la que se muestran los nombres de las distintas excepciones definidas en Oracle, junto a su código de error y  una explicación de cuándo son lanzadas. Primera columna: excepción, segunda columna: código de error, tercera columna: cuando se lanza.">
	<caption>Excepciones predefinidas en <span lang="en">Oracle</span>.</caption>
	<thead>
		<tr>
			<th scope="col">Excepción.</th>
			<th scope="col"><code>SQLCODE</code></th>
			<th scope="col">Lanzada cuando ...</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td><code>ACCES_INTO_NULL</code></td>
			<td>-6530
			</td>   
			<td>Intentamos asignar valor a atributos de objetos no inicializados.</td>   
		</tr>
		<tr>
			<td><code>COLECTION_IS_NULL</code></td>
			<td>-6531
			</td>   
			<td>Intentamos asignar valor a elementos de colecciones no inicializadas, o acceder a métodos distintos de <code>EXISTS</code>.</td>   
		</tr>
		<tr>
			<td><code>CURSOR_ALREADY_OPEN</code></td>
			<td>-6511</td>   
			<td>Intentamos abrir un cursor ya abierto.</td>   
		</tr>
		<tr>
			<td><code>DUP_VAL_ON_INDEX</code></td>
			<td>-1</td>   
			<td>Índice único violado.</td>   
		</tr>
		<tr>
			<td><code>INVALID_CURSOR</code></td>
			<td>-1001</td>   
			<td>Intentamos hacer una operación con un cursor que no está abierto.</td>   
		</tr>
		<tr>
			<td><code>INVALID_NUMBER</code></td>
			<td>-1722</td>   
			<td>Conversión de cadena a número falla.</td>   
		</tr>
		<tr>
			<td><code>LOGIN_DENIED</code></td>
			<td>-1403</td>   
			<td>El usuario y/o contraseña para conectarnos a <span lang="en">Oracle</span> no es válido.</td>   
		</tr>
		<tr>
			<td><code>NO_DATA_FOUND</code></td>
			<td>+100</td>   
			<td>Una sentencia <code>SELECT</code> no devuelve valores, o intentamos acceder a un elemento borrado de una tabla anidada.</td>   
		</tr>
		<tr>
			<td><code>NOT_LOGGED_ON</code></td>
			<td>-1012</td>   
			<td>No estamos conectados a <span lang="en">Oracle</span>.</td>   
		</tr>
		<tr>
			<td><code>PROGRAM_ERROR</code></td>
			<td>-6501</td>   
			<td>Ha ocurrido un error interno en PL/SQL.</td>   
		</tr>
		<tr>
			<td><code>ROWTYPE_MISMATCH</code></td>
			<td>-6504</td>   
			<td>Diferentes tipos en la asignación de 2 cursores.</td>   
		</tr>
		<tr>
			<td><code>STORAGE_ERROR</code></td>
			<td>-6500</td>   
			<td>Memoria corrupta.</td>   
		</tr>
		<tr>
			<td><code>SUBSCRIPT_BEYOND_COUNT</code></td>
			<td>-6533</td>   
			<td>El índice al que intentamos acceder en una colección sobrepasa su límite superior.</td>   
		</tr>
		<tr>
			<td><code>SUBSCRIPT_OUTSIDE_LIMIT</code></td>
			<td>-6532</td>   
			<td>Intentamos acceder a un rango no válido dentro de una colección (-1 por ejemplo).</td>   
		</tr>
		<tr>
			<td><code>TIMEOUT_ON_RESOURCE</code></td>
			<td>-51</td>   
			<td>Un <span lang="en">timeout</span> ocurre mientras Oracle espera por un recurso.
			</td>   
		</tr>
		<tr>
			<td><code>TOO_MANY_ROWS</code></td>
			<td>-1422</td>   
			<td>Una sentencia <code>SELECT...INTO...</code> devuelve más de una fila.
			</td>   
		</tr>
		<tr>
			<td><code>VALUE_ERROR</code></td>
			<td>-6502</td>   
			<td>Ocurre un error de conversión, aritmético, de truncado o de restricción de tamaño.</td>   
		</tr>
		<tr>
			<td><code>ZERO_DIVIDE</code></td>
			<td>-1476
			</td>   
			<td>Intentamos dividir un número por 0.
			</td>   
		</tr>
	</tbody>
</table>

</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-37">
<header class="nodeDecoration">
<h1 id="exenode_37_AnexoIIIEvaluacindelosatributosdeuncursorexplcito" class="nodeTitle">Anexo III.- Evaluación de los atributos de un cursor explícito.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id60-37">
<div class="iDevice emphasis0">
<div id="ta60_73" class="block iDevice_content">
<a name="anexo_iii_evaluacin_de_los_atributos_de_un_cursor_explcito.html" title="anexo_iii_evaluacin_de_los_atributos_de_un_cursor_explcito.html"></a>
<table class="tabla" summary="Tabla en la que se muestra el valor de cada atributo de un cursor explícito según las operaciones que hayamos realizado con él.">
	<caption>Evaluación de los atributos de un cursor explícito según las operaciones realizadas con él.</caption>
	<thead>
		<tr>
			<th scope="col">Operación realizada.</th>
			<th scope="col"><code>%FOUND</code></th>
			<th scope="col"><code>%NOTFOUND</code></th>
			<th scope="col"><code>%ISOPEN</code></th>
			<th scope="col"><code>%ROWCOUNT</code></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Antes del <code>OPEN</code></td>
			<td>Excepción.</td>   
			<td>Excepción.</td>   
			<td><code>FALSE</code></td>
			<td>Excepción.</td>    
		</tr>
		<tr>
			<td>Después del <code>OPEN</code></td>
			<td><code>NULL</code>
			</td>   
			<td><code>NULL</code></td>   
			<td><code>TRUE</code></td>
			<td>0</td>    
		</tr>
		<tr>
			<td>Antes del primer <code>FETCH</code></td>
			<td><code>NULL</code></td>   
			<td><code>NULL</code></td>   
			<td><code>TRUE</code></td>
			<td>0</td>    
		</tr>
		<tr>
			<td>Después del primer <code>FETCH</code></td>
			<td><code>TRUE</code></td>   
			<td><code>FALSE</code></td>   
			<td><code>TRUE</code></td>
			<td>1</td>    
		</tr>
		<tr>
			<td>Antes de los siguientes <code>FETCH</code></td>
			<td><code>TRUE</code></td>   
			<td><code>FALSE</code></td>   
			<td><code>TRUE</code></td>
			<td>1</td>    
		</tr>
		<tr>
			<td>Después de los siguientes <code>FETCH</code></td>
			<td><code>TRUE</code></td>   
			<td><code>FALSE</code></td>   
			<td><code>TRUE</code></td>
			<td>Depende datos.</td>    
		</tr>
		<tr>
			<td>Antes del último <code>FETCH</code></td>
			<td><code>TRUE</code></td>   
			<td><code>FALSE</code></td>   
			<td><code>TRUE</code></td>
			<td>Depende datos.</td>    
		</tr>
		<tr>
			<td>Después del último <code>FETCH</code></td>
			<td><code>FALSE</code></td>   
			<td><code>TRUE</code></td>   
			<td><code>TRUE</code></td>
			<td>Depende datos.</td>    
		</tr>
		<tr>
			<td>Antes del <code>CLOSE</code></td>
			<td><code>FALSE</code></td>   
			<td><code>TRUE</code></td>   
			<td><code>TRUE</code></td>
			<td>Depende datos.</td>    
		</tr>
		<tr>
			<td>Después del <code>CLOSE</code></td>
			<td>Excepción.</td>   
			<td>Excepción.</td>   
			<td><code>FALSE</code></td>
			<td>Excepción.</td>    
		</tr>
	</tbody>
</table>

</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-38">
<header class="nodeDecoration">
<h1 id="exenode_38_AnexoIVPasodeparmetrosasubprogramas" class="nodeTitle">Anexo IV.- Paso de parámetros a subprogramas.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id79-38">
<div class="iDevice emphasis0">
<div id="ta79_73" class="block iDevice_content">
<p><a name="anexo_iv_paso_de_parmetros_a_subprogramas.html" title="anexo_iv_paso_de_parmetros_a_subprogramas.html"></a></p>
<p>Veamos algunos ejemplos del paso de parámetros a subprogramas:</p>
<ul class="lista_verificacion">
<li style="margin-bottom: 20px;">Notación mixta.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>DECLARE
     PROCEDURE prueba( formal1 NUMBER, formal2 VARCHAR2) IS
     BEGIN
          ...
     END;
     actual1 NUMBER;
     actual2 VARCHAR2;
BEGIN
     ...
     prueba(actual1, actual2);               --posicional
     prueba(formal2=&gt;actual2,formal1=&gt;actual1);     --nombrada
     prueba(actual1, formal2=&gt;actual2);          --mixta
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Parámetros de entrada.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>FUNCTION categoria( id_agente IN NUMBER ) 
RETURN NUMBER IS
     cat NUMBER;
BEGIN
     ...
     SELECT categoria INTO cat FROM agentes 
WHERE identificador = id_agente;
RETURN cat;
EXCEPTION
     WHEN NO_DATA_FOUND THEN
          id_agente := -1; --ilegal, parámetro de entrada
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
<li style="margin-bottom: 20px;">Parámetros de salida.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>PROCEDURE nombre( id_agente NUMBER, nombre OUT VARCHAR2) IS
BEGIN
     IF (nombre = 'LUIS') THEN     --error de sintaxis
     END IF;
     ...
END;</code></pre>
</div>
</div>
<pre></pre>
</div>
</li>
<li>Parámetros con valor por defecto de los que podemos prescindir.
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>DECLARE 
     SUBTYPE familia IS familias%ROWTYPE;
     SUBTYPE agente IS agentes%ROWTYPE;
     SUBTYPE tabla_agentes IS TABLE OF agente;
     familia1 familia;
     familia2 familia;
     hijos_fam tabla_agentes;
     FUNCTION inserta_familia( mi_familia familia, 
          mis_agentes tabla_agentes := tabla_agentes() ) 
RETURN NUMBER IS
     BEGIN
          INSERT INTO familias VALUES (mi_familia);
          FOR i IN 1..mis_agentes.COUNT LOOP
               IF (mis_agentes(i).oficina IS NOT NULL) or (mis_agentes(i).familia ¡= mi_familia.identificador) THEN
                    ROLLBACK;
                    RETURN –1;
               END IF;
               INSERT INTO agentes VALUES (mis_agentes(i));
          END LOOP;
          COMMIT;
          RETURN 0;
     EXCEPTION
          WHEN DUP_VAL_ON_INDEX THEN
               ROLLABACK;
               RETURN –1;
          WHEN OTHERS THEN
               ROLLBACK;
               RETURN SQLCODE;
     END inserta_familia;
BEGIN
     ...
     resultado := inserta_familia( familia1 );
     ...
     resultado := inserta_familia( familia2, hijos_fam2 );
     ...
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</li>
</ul>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-39">
<header class="nodeDecoration">
<h1 id="exenode_39_AnexoVSobrecargadesubprogramas" class="nodeTitle">Anexo V.- Sobrecarga de subprogramas.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id83-39">
<div class="iDevice emphasis0">
<div id="ta83_73" class="block iDevice_content">
<p><a name="anexo_v_sobrecarga_de_subprogramas.html" title="anexo_v_sobrecarga_de_subprogramas.html"></a></p>
<p>Veamos un ejemplo de sobrecarga de subprogramas en el que una misma función es sobrecargada tres veces para diferentes tipos de parámetros.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>DECLARE
     TYPE agente IS agentes%ROWTYPE;
     TYPE familia IS familias%ROWTYPE;
     TYPE tAgentes IS TABLE OF agente;
     TYPE tFamilias IS TABLE OF familia;
     
     FUNCTION inserta_familia( mi_familia familia ) 
     RETURN NUMBER IS
     BEGIN
          INSERT INTO familias VALUES (mi_familia.identificador, mi_familia.nombre, mi_familia.familia, mi_familia.oficina );
          COMMIT;
          RETURN 0;
     EXCEPTION
          WHEN DUP_VAL_ON_INDEX THEN
               ROLLBACK;
               RETURN –1;
          WHEN OTHERS THEN
               ROLLBACK;
               RETURN SQLCODE;
     END inserta_familia;
     
     FUNCTION inserta_familia( mi_familia familia, hijas tFamilias )
     RETURN NUMBER IS
     BEGIN
          INSERT INTO familias VALUES (mi_famila.identificador, mi_familia.nombre, mi_familia.familia, mi_familia.oficina );
          IF (hijas IS NOT NULL) THEN
               FOR i IN 1..hijas.COUNT LOOP
                    IF (hijas(i).oficina IS NOT NULL) or (hijas(i).familia ¡= mi_familia.identificador) THEN
                         ROLLBACK;
                         RETURN –1;
                    END IF;
                    INSERT INTO familias VALUES (hijas(i).identificador, hijas(i).nombre, hijas(i).familia, hijas(i).oficina );
               END LOOP;
          END IF;
          COMMIT;
          RETURN 0;
     EXCEPTION
          WHEN DUP_VAL_ON_INDEX THEN
               ROLLBACK;
               RETURN –1;
          WHEN OTHERS THEN
               ROLLBACK;
               RETURN –1;
     END inserta_familia;
     
     FUNCTION inserta_familia( mi_familia familia, hijos tAgentes )
     RETURN NUMBER IS
     BEGIN
          INSERT INTO familias VALUES (mi_familia.identificador, mi_familia.nombre, mi_familia.familia, mi_familia.oficina );
          IF (hijos IS NOT NULL) THEN
               FOR i IN 1..hijos.COUNT LOOP
                    IF (hijos(i).oficina IS NOT NULL) or (hijos(i).familia ¡= mi_familia.identificador) THEN
                         ROLLBACK;
                         RETURN –1;
                    END IF;
                    INSERT INTO agentes VALUES (hijos(i).identificador, hijos(i).nombre, hijos(i).usuario, hijos(i).clave, hijos(i).habilidad, hijos(i).categoria, hijos(i).familia, hijos(i).oficina );
               END LOOP;
          END IF;
          COMMIT;
          RETURN 0;
     EXCEPTION
          WHEN DUP_VAL_ON_INDEX THEN
               ROLLBACK;
               RETURN –1;
          WHEN OTHERS THEN
               ROLLBACK;
               RETURN –1;
     END inserta_familias;
     
     mi_familia familia;
     mi_familia1 familia;
     familias_hijas tFamilias;
     mi_familia2 familia;
     hijos tAgentes;
BEGIN
     ...
     resultado := inserta_familia(mi_familia);
     ...
     resultado := inserta_familia(mi_familia1, familias_hijas);
     ...
     resultado := inserta_familia(mi_familia2, hijos);
     ...
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-40">
<header class="nodeDecoration">
<h1 id="exenode_40_AnexoVIEjemploderecursividad" class="nodeTitle">Anexo VI.- Ejemplo de recursividad.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id86-40">
<div class="iDevice emphasis0">
<div id="ta86_73" class="block iDevice_content">
<p><a name="anexo_vi_ejemplo_de_recursividad.html" title="anexo_vi_ejemplo_de_recursividad.html"></a></p>
<p>Aquí tienes un ejemplo del uso de la recursividad en nuestros subprogramas.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>DECLARE
     TYPE agente IS agentes%ROWTYPE;
     TYPE tAgentes IS TABLE OF agente;
     hijos10 tAgentes;
     PROCEDURE dame_hijos( id_familia NUMBER,
                    hijos IN OUT tAgentes ) IS
          CURSOR hijas IS SELECT identificador FROM familias WHERE familia = id_familia;
hija NUMBER;
     CURSOR cHijos IS SELECT * FROM agentes WHERE familia = id_familia;
hijo agente;
     BEGIN
          --Si la tabla no está inicializada -&gt; la inicializamos
          IF hijos IS NULL THEN
               hijos = tAgentes();
          END IF;
          --Metemos en la tabla los hijos directos de esta familia
          OPEN cHijos;
          LOOP
               FETCH cHijos INTO hijo;
               EXIT WHEN cHijos%NOTFOUND;
               hijos.EXTEND;
               hijos(hijos.LAST) := hijo;
          END LOOP;
          CLOSE cHijos;
          --Hacemos lo mismo para todas las familias hijas de la actual
          OPEN hijas;
          LOOP
               FETCH hijas INTO hija;
               EXIT WHEN hijas%NOTFOUND;
               dame_hijos( hija, hijos );
          END LOOP;
          CLOSE hijas;
     END dame_hijos;
BEGIN
     ...
     dame_hijos( 10, hijos10 );
     ...
END;</code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</div>
</div>
</article>
</article>
<article class="node level-2-node" id="exe-node-41">
<header class="nodeDecoration">
<h1 id="exenode_41_AnexoVIIEjemplodepaquete" class="nodeTitle">Anexo VII.- Ejemplo de paquete.</h1>
</header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id90-41">
<div class="iDevice emphasis0">
<div id="ta90_73" class="block iDevice_content">
<p><a name="anexo_vii_ejemplo_de_paquete.html" title="anexo_vii_ejemplo_de_paquete.html"></a></p>
<p>Aquí puedes ver un ejemplo de un paquete que agrupa las principales tareas que llevamos a cabo con la base de datos de ejemplo.</p>
<div>
<div class="highlighted-code code-style-2 language-sql">
<div>
<pre><code>CREATE OR REPLACE PACKAGE call_center AS     --inicialización 
     --Definimos los tipos que utilizaremos 
     SUBTYPE agente IS agentes%ROWTYPE; 
     SUBTYPE familia IS familias%ROWTYPE; 
     SUBTYPE oficina IS oficinas%ROWTYPE; 
     TYPE tAgentes IS TABLE OF agente; 
     TYPE tFamilias IS TABLE OF familia; 
     TYPE tOficinas IS TABLE OF oficina; 
     
     --Definimos las excepciones propias 
     referencia_no_encontrada exception; 
     referencia_encontrada exception; 
     no_null exception; 
     PRAGMA EXCEPTION_INIT(referencia_no_encontrada, -2291); 
     PRAGMA EXCEPTION_INIT(referencia_encontrada, -2292); 
     PRAGMA EXCEPTION_INIT(no_null, -1400); 
     
     --Definimos los errores que vamos a tratar 
     todo_bien                CONSTANT NUMBER := 0; 
     elemento_existente           CONSTANT NUMBER:= -1; 
     elemento_inexistente           CONSTANT NUMBER:= -2; 
     padre_existente          CONSTANT NUMBER:= -3; 
     padre_inexistente          CONSTANT NUMBER:= -4; 
     no_null_violado          CONSTANT NUMBER:= -5; 
     operacion_no_permitida          CONSTANT NUMBER:= -6; 
     
     --Definimos los subprogramas públicos 
     --Nos devuelve la oficina padre de un agente 
     PROCEDURE oficina_padre( mi_agente agente, padre OUT oficina ); 
     
     --Nos devuelve la oficina padre de una familia 
     PROCEDURE oficina_padre( mi_familia familia, padre OUT oficina ); 
     
     --Nos da los hijos de una familia 
     PROCEDURE dame_hijos( mi_familia familia, hijos IN OUT tAgentes ); 
     
     --Nos da los hijos de una oficina 
     PROCEDURE dame_hijos( mi_oficina oficina, hijos IN OUT tAgentes ); 
     
     --Inserta un agente 
     FUNCTION inserta_agente ( mi_agente agente ) 
     RETURN NUMBER; 
     
     --Inserta una familia 
     FUNCTION inserta_familia( mi_familia familia ) 
     RETURN NUMBER; 
     
     --Inserta una oficina 
     FUNCTION inserta_oficina ( mi_oficina oficina ) 
     RETURN NUMBER; 
     
     --Borramos una oficina 
     FUNCTION borra_oficina( id_oficina NUMBER ) 
     RETURN NUMBER; 
     
     --Borramos una familia 
     FUNCTION borra_familia( id_familia NUMBER ) 
     RETURN NUMBER; 
     
     --Borramos un agente 
     FUNCTION borra_agente( id_agente NUMBER ) 
     RETURN NUMBER; 
END call_center; 
/ 
CREATE OR REPLACE PACKAGE BODY call_center AS          --cuerpo 
     --Implemento las funciones definidas en la especificación 
     
     --Nos devuelve la oficina padre de un agente 
     PROCEDURE oficina_padre( mi_agente agente, padre OUT oficina ) IS 
          mi_familia familia; 
     BEGIN 
          IF (mi_agente.oficina IS NOT NULL) THEN 
               SELECT * INTO padre FROM oficinas 
               WHERE identificador = mi_agente.oficina; 
          ELSE 
               SELECT * INTO mi_familia FROM familias 
               WHERE identificador = mi_agente.familia; 
               oficina_padre( mi_familia, padre ); 
          END IF; 
     EXCEPTION 
          WHEN OTHERS THEN 
               padre := NULL; 
     END oficina_padre; 
     
     --Nos devuelve la oficina padre de una familia 
     PROCEDURE oficina_padre( mi_familia familia, padre OUT oficina ) IS 
          madre familia; 
     BEGIN 
          IF (mi_familia.oficina IS NOT NULL) THEN 
               SELECT * INTO padre FROM oficinas 
               WHERE identificador = mi_familia.oficina; 
          ELSE 
               SELECT * INTO madre FROM familias 
               WHERE identificador = mi_familia.familia; 
               oficina_padre( madre, padre ); 
          END IF; 
     EXCEPTION 
          WHEN OTHERS THEN 
               padre := NULL; 
     END oficina_padre; 
     
     --Nos da los hijos de una familia 
     PROCEDURE dame_hijos( mi_familia familia, hijos IN OUT tAgentes ) IS 
          CURSOR cHijos IS SELECT * FROM agentes 
          WHERE familia = mi_familia.identificador; 
          CURSOR cHijas IS SELECT * FROM familias 
          WHERE familia = mi_familia.identificador; 
          hijo agente; 
          hija familia; 
     BEGIN 
          --inicializamos la tabla si no lo está 
          if (hijos IS NULL) THEN 
               hijos := tAgentes(); 
          END IF; 
          --metemos en la tabla los hijos directos 
          OPEN cHijos; 
          LOOP 
               FETCH cHijos INTO hijo; 
               EXIT WHEN cHijos%NOTFOUND; 
               hijos.EXTEND; 
               hijos(hijos.LAST) := hijo; 
          END LOOP; 
          CLOSE cHijos; 
          --hacemos lo mismo para las familias hijas 
          OPEN cHijas; 
          LOOP 
               FETCH cHijas INTO hija; 
               EXIT WHEN cHijas%NOTFOUND; 
               dame_hijos( hija, hijos ); 
          END LOOP; 
          CLOSE cHijas; 
     EXCEPTION 
          WHEN OTHERS THEN 
               hijos := tAgentes(); 
     END dame_hijos; 
     
     --Nos da los hijos de una oficina 
     PROCEDURE dame_hijos( mi_oficina oficina, hijos IN OUT tAgentes ) IS 
          CURSOR cHijos IS SELECT * FROM agentes 
          WHERE oficina = mi_oficina.identificador; 
          CURSOR cHijas IS SELECT * FROM familias 
          WHERE oficina = mi_oficina.identificador; 
          hijo agente; 
          hija familia; 
     BEGIN 
          --inicializamos la tabla si no lo está 
          if (hijos IS NULL) THEN 
               hijos := tAgentes(); 
          END IF; 
          --metemos en la tabla los hijos directos 
          OPEN cHijos; 
          LOOP 
               FETCH cHijos INTO hijo; 
               EXIT WHEN cHijos%NOTFOUND; 
               hijos.EXTEND; 
               hijos(hijos.LAST) := hijo; 
          END LOOP; 
          CLOSE cHijos; 
          --hacemos lo mismo para las familias hijas 
          OPEN cHijas; 
          LOOP 
               FETCH cHijas INTO hija; 
               EXIT WHEN cHijas%NOTFOUND; 
               dame_hijos( hija, hijos ); 
          END LOOP; 
          CLOSE cHijas; 
     EXCEPTION 
          WHEN OTHERS THEN 
               hijos := tAgentes(); 
     END dame_hijos; 
     
     --Inserta un agente 
     FUNCTION inserta_agente ( mi_agente agente ) 
     RETURN NUMBER IS 
     BEGIN 
          IF (mi_agente.familia IS NULL and mi_agente.oficina IS NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          IF (mi_agente.familia IS NOT NULL and mi_agente.oficina IS NOT NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          INSERT INTO agentes VALUES (mi_agente.identificador, mi_agente.nombre, mi_agente.usuario, mi_agente.clave, mi_agente.habilidad, mi_agente.categoria, mi_agente.familia, mi_agente.oficina ); 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN referencia_no_encontrada THEN 
               ROLLBACK; 
               RETURN padre_inexistente; 
          WHEN no_null THEN 
               ROLLBACK; 
               RETURN no_null_violado; 
          WHEN DUP_VAL_ON_INDEX THEN 
               ROLLBACK; 
               RETURN elemento_existente; 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END inserta_agente; 
     
     --Inserta una familia 
     FUNCTION inserta_familia( mi_familia familia ) 
     RETURN NUMBER IS 
     BEGIN 
          IF (mi_familia.familia IS NULL and mi_familia.oficina IS NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          IF (mi_familia.familia IS NOT NULL and mi_familia.oficina IS NOT NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          INSERT INTO familias VALUES ( mi_familia.identificador, mi_familia.nombre, mi_familia.familia, mi_familia.oficina ); 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN referencia_no_encontrada THEN 
               ROLLBACK; 
               RETURN padre_inexistente; 
          WHEN no_null THEN 
               ROLLBACK; 
               RETURN no_null_violado; 
           WHEN DUP_VAL_ON_INDEX THEN 
               ROLLBACK; 
               RETURN elemento_existente; 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END inserta_familia; 
     
     --Inserta una oficina 
     FUNCTION inserta_oficina ( mi_oficina oficina ) 
     RETURN NUMBER IS 
     BEGIN 
          INSERT INTO oficinas VALUES (mi_oficina.identificador, mi_oficina.nombre, mi_oficina.domicilio, mi_oficina.localidad, mi_oficina.codigo_postal ); 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN no_null THEN 
               ROLLBACK; 
               RETURN no_null_violado; 
          WHEN DUP_VAL_ON_INDEX THEN 
               ROLLBACK; 
               RETURN elemento_existente; 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END inserta_oficina; 
     
     --Borramos una oficina 
     FUNCTION borra_oficina( id_oficina NUMBER ) 
     RETURN NUMBER IS 
          num_ofi NUMBER; 
     BEGIN 
          SELECT COUNT(*) INTO num_ofi FROM oficinas 
          WHERE identificador = id_oficina; 
          IF (num_ofi = 0) THEN 
               RETURN elemento_inexistente; 
          END IF; 
          DELETE oficinas WHERE identificador = id_oficina; 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END borra_oficina; 
     
     --Borramos una familia 
     FUNCTION borra_familia( id_familia NUMBER ) 
     RETURN NUMBER IS 
          num_fam NUMBER; 
     BEGIN 
          SELECT COUNT(*) INTO num_fam FROM familias 
          WHERE identificador = id_familia; 
          IF (num_fam = 0) THEN 
               RETURN elemento_inexistente; 
          END IF; 
          DELETE familias WHERE identificador = id_familia; 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END borra_familia; 
      
     --Borramos un agente 
     FUNCTION borra_agente( id_agente NUMBER ) 
     RETURN NUMBER IS 
          num_ag NUMBER; 
     BEGIN 
          SELECT COUNT(*) INTO num_ag FROM agentes 
          WHERE identificador = id_agente; 
          IF (num_ag = 0) THEN 
               RETURN elemento_inexistente; 
          END IF; 
          DELETE agentes WHERE identificador = id_agente; 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END borra_agente; 
END call_center; 
/ </code></pre>
</div>
</div>
<pre><br /><br /></pre>
</div>
</div>
</div>
</article>
</article>
</section>


</div>
<script type="text/javascript" src="_fpd_js.js"></script></body>
</html>